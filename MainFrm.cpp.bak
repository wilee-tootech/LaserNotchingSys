     // MainFrm.cpp : implementation of the CMainFrame class
//

#include "stdafx.h"
#include "BeamEditor6.h"
#include "MainFrm.h"
#include "BeamEditor6Doc.h"
#include "BeamEditor6View.h"

#include "InitialTable.h" /* Loading InitialTable */
#include "Splash.h" /* Loading Start Image */
#include "Language.h" /* Language Setting */
#include "PointerManager.h"
#include "DlgTTF.h" /* TTF */
#include "DlgMark.h"
#include "DlgBin.h"
#include "DlgFieldParameter.h"
#include "DlgParameter.h"
#include "TransUnit.h"
#include "InfomationView.h"
#include "Spectron.h"
#include "Rofin.h"
#include "Quantronix.h"
#include "HanaLaser.h"
#include "FiberLaser.h"
//#include "HANA_DPSSL_CONTROLDlg.h"
#include "HanaLaser_DLG.h"

#include "DlgChangeLevel.h"
#include "DlgChangePWD.h"
#include "DlgChangeAuthority.h"
#include "DlgHpgl.h"
#include "FilePath.h"
#include "CommunicateTable.h"
#include "MKTTFObject.h"
#include "DlgDevice.h"
#include "BGGridDisplay.h"
#include "BGAfterImage.h"
#include "MKObjectHandler.h"
#include "Dsp.h"
#include "ObjectCreateFactory.h"
#include "CommandManager.h"
#include "CommandCreateFactory.h"
#include "Command.h"
#include "UserCheck.h"
#include "MKCompositeObject.h"
#include "DlgImg.h"
#include "DlgBar.h"
#include "DlgRectSet.h"

////////////////////////////¿Œ≈¨∑ÁµÂ Ω√¿€.
#include "MKObjectApproacher.h"
#include "MKObjectManager.h"
#include "PointerContainer.h"
#include "NormalDisplay.h"
#include "Display.h"
#include "BGDeviceDisplay.h"
#include "RectDisplay.h"
#include "Device.h"
//////////////////////////////////////≥°
#include "Parameter.h"
#include "LaserControl.h"
#include "UserInterface.h"
#include "UserNormalState.h"
#include "MKStdFile.h"

// §—§—;;
#include "Command.h"
#include "DlgSerial.h"

#include "FGRulerDisplay.h"
#include "DisplayObject.h"
//#include "DlgDspTest.h"//   ≈◊Ω∫∆Æ
#include "TimeChecker.h"
#include "FGFlagDisplay.h"
#include "NormalRectDisplay.h"
#include "GripPointDisplay.h"
#include "UserSelectZoomState.h"
#include "FileDialog_ReadOnly.h"

#include "DlgUserLogIn.h"
#include "UserCheck.h"
#include "RS232.h"
#include "EOLASERCON.h"//csy050922
#include "ODBCINST.H"
#include "DlgShutterDelay.h"

#include "DlgOperatorMode.h"	
#include "DlgPassword.h"	
#include "DlgLotCompTime.h"	

// 2007.01.12  
#include "WriteLog.h"
#include "DlgCustomerCode.h"

// 2011.04.04 syhun START - Laser control √ﬂ∞°.
//#include "DlgLaservallAD.h"
#include "DlgFiberSpi.h"
#include "DlgBicronixLaser.h"
#include "DlgLaserJDSU.h"
#include "DlgBavarian.h"
// syhun END.

#include "Psc140p.h"	//psc
#include "Dsp.h"
#include "DlgHardwareTest.h"
#include <Olectl.h>

#include "GraphView.h"

#include "DlgKoemData.h"
#include "DlgRTC.h"
#include "MathUtil.h"

#include <afx.h>
#include <psapi.h>
#include "infomationview.h"
#include "FieldParameter.h"

#include <NX_NOTIFY/GuiAlarm.h>
#include <NX_NOTIFY/GuiError.h>
#include "TabStandardPara.h"

#ifdef _DEBUG
#define new DEBUG_NEW
#undef THIS_FILE
static char THIS_FILE[] = __FILE__;
#endif

#define S_MS_ACCESS_DRIRVER     "Microsoft Access Driver (*.mdb)"


typedef BOOL (WINAPI *P_GDFSE)(LPCTSTR, PULARGE_INTEGER, 
							   PULARGE_INTEGER, PULARGE_INTEGER);

/////////////////////////////////////////////////////////////////////////////
// CMainFrame

IMPLEMENT_DYNCREATE(CMainFrame, CFrameWnd)

BEGIN_MESSAGE_MAP(CMainFrame, CFrameWnd)
	//{{AFX_MSG_MAP(CMainFrame)
	ON_WM_CREATE()
	ON_COMMAND(ID_NEW_TTF, OnNewTtf)
	ON_COMMAND(ID_LASER_CTR, OnLaserCtr)
	ON_COMMAND(ID_COMM_SETTING, OnCommSetting)
	ON_COMMAND(IDC_MARK_FRAME, OnMarkFrame)
	ON_WM_SYSCOMMAND()
	ON_COMMAND(ID_BIN_SETTING, OnBinSetting)
	ON_COMMAND(ID_SET_FIELD_SIZE, OnSetFieldSize)
	ON_COMMAND(ID_VIEW_ALIGN, OnViewAlign)
	ON_COMMAND(ID_VIEW_EDIT, OnViewEdit)
	ON_UPDATE_COMMAND_UI(ID_VIEW_ALIGN, OnUpdateViewAlign)
	ON_UPDATE_COMMAND_UI(ID_VIEW_EDIT, OnUpdateViewEdit)
	ON_COMMAND(ID_VIEW_HELP, OnViewHelp)
	ON_UPDATE_COMMAND_UI(ID_VIEW_HELP, OnUpdateViewHelp)
	ON_COMMAND(ID_VIEW_MARKORDER, OnViewMarkorder)
	ON_UPDATE_COMMAND_UI(ID_VIEW_MARKORDER, OnUpdateViewMarkorder)
	ON_COMMAND(ID_VIEW_STANDARD, OnViewStandard)
	ON_UPDATE_COMMAND_UI(ID_VIEW_STANDARD, OnUpdateViewStandard)
	ON_COMMAND(IDC_EDIT_PARAMETER, OnEditParameter)
	ON_COMMAND(ID_MARK_FILE_SAVE, OnFileSave)
	ON_COMMAND(ID_FILE_OPEN, OnFileOpen)
	ON_COMMAND(ID_CHANGE_USER_LEVEL, OnChangeUserLevel)
	ON_COMMAND(ID_CHANGE_PASSWORD, OnChangePassword)
	ON_COMMAND(ID_SET_AUTHORITY, OnSetAuthority)
	ON_COMMAND(ID_NEW_HPGL, OnNewHpgl)
	ON_COMMAND(IDC_EDIT_DEVICE_MENU, OnEditDevice)
	ON_COMMAND(ID_NEW_TEXT, OnNewText)
	ON_COMMAND(ID_NEW_ARC, OnNewArc)
	ON_COMMAND(ID_NEW_LINE, OnNewLine)


	ON_UPDATE_COMMAND_UI(ID_NEW_ARC, OnUpdateDrawArc)
	ON_COMMAND(IDC_EDIT_OBJ_FRAME, OnEditObjFrame)
	ON_COMMAND(ID_UNDO, OnUndo)
	ON_COMMAND(ID_REDO, OnRedo)
	ON_UPDATE_COMMAND_UI(ID_UNDO, OnUpdateUndo)
	ON_UPDATE_COMMAND_UI(ID_REDO, OnUpdateRedo)
	ON_COMMAND(ID_EDIT_COPY, OnEditCopy)
	ON_COMMAND(IDC_OBJ_COPY_FRAME, OnObjCopyFrame)
	ON_COMMAND(ID_ALIGN_BOTTOM, OnAlignBottom)
	ON_COMMAND(ID_ALIGN_TOP, OnAlignTop)
	ON_COMMAND(ID_ALIGN_RIGHT, OnAlignRight)
	ON_COMMAND(ID_ALIGN_LEFT, OnAlignLeft)
	ON_COMMAND(IDC_OBJ_ERASE_FRAME, OnObjEraseFrame)
	ON_COMMAND(ID_ORDER_UP, OnOrderUp)
	ON_COMMAND(ID_ORDER_DOWN, OnOrderDown)
	ON_COMMAND(ID_ALIGN_HCENTER, OnAlignHcenter)
	ON_COMMAND(ID_ALIGN_VCENTER, OnAlignVcenter)
	ON_COMMAND(ID_ALIGN_OBJ_LEFT, OnAlignObjLeft)
	ON_COMMAND(ID_ALIGN_OBJ_TOP, OnAlighObjTop)
	ON_COMMAND(ID_ALIGN_OBJ_BOTTOM, OnAlignObjBottom)
	ON_COMMAND(ID_ALIGN_OBJ_RIGHT, OnAlignObjRight)
	ON_COMMAND(ID_SAME_WIDTH, OnSameWidth)
	ON_COMMAND(ID_SAME_HEIGHT, OnSameHeight)
	ON_COMMAND(ID_SAME_BOTH, OnSameBoth)
	ON_COMMAND(ID_ORDER_FIRST, OnOrderFirst)
	ON_COMMAND(ID_ORDER_LAST, OnOrderLast)
	ON_COMMAND(ID_NEW_IMG, OnNewImg)
	ON_COMMAND(ID_NEW_BAR, OnNewBar)
	ON_COMMAND(IDC_OBJECT_FIX, OnObjectFix)
	ON_COMMAND(IDC_MAIN_ZOOM_IN2, OnMainZoomIn2)
	ON_COMMAND(IDC_MAIN_ZOOM_OUT, OnMainZoomOut)
	ON_COMMAND(IDC_SELECT_ZOOM, OnSelectZoom)
	ON_COMMAND(IDC_SCREEN_ZOOM_ORG, OnScreenZoomOrg)
	ON_COMMAND(IDC_SCREEN_ZOOM_ORG_FRAME, OnScreenZoomOrgFrame)
	ON_UPDATE_COMMAND_UI(IDC_EDIT_PARAMETER, OnUpdateEditParameter)
	ON_COMMAND(ID_2DBARCODE, On2dbarcode)
	ON_WM_SETCURSOR()
	ON_UPDATE_COMMAND_UI(IDC_OBJECT_FIX, OnUpdateObjectFix)
	ON_UPDATE_COMMAND_UI(ID_ALIGN_OBJ_BOTTOM, OnUpdateAlignObjBottom)
	ON_UPDATE_COMMAND_UI(ID_ALIGN_OBJ_LEFT, OnUpdateAlignObjLeft)
	ON_UPDATE_COMMAND_UI(ID_ALIGN_OBJ_RIGHT, OnUpdateAlignObjRight)
	ON_UPDATE_COMMAND_UI(ID_ALIGN_OBJ_TOP, OnUpdateAlignObjTop)
	ON_UPDATE_COMMAND_UI(ID_SAME_BOTH, OnUpdateSameBoth)
	ON_UPDATE_COMMAND_UI(ID_SAME_HEIGHT, OnUpdateSameHeight)
	ON_UPDATE_COMMAND_UI(ID_SAME_WIDTH, OnUpdateSameWidth)
	ON_UPDATE_COMMAND_UI(ID_ALIGN_BOTTOM, OnUpdateAlignBottom)
	ON_UPDATE_COMMAND_UI(ID_ALIGN_HCENTER, OnUpdateAlignHcenter)
	ON_UPDATE_COMMAND_UI(ID_ALIGN_RIGHT, OnUpdateAlignRight)
	ON_UPDATE_COMMAND_UI(ID_ALIGN_LEFT, OnUpdateAlignLeft)
	ON_UPDATE_COMMAND_UI(ID_ALIGN_TOP, OnUpdateAlignTop)
	ON_UPDATE_COMMAND_UI(ID_ALIGN_VCENTER, OnUpdateAlignVcenter)
	ON_UPDATE_COMMAND_UI(ID_ORDER_UP, OnUpdateOrderUp)
	ON_UPDATE_COMMAND_UI(ID_ORDER_LAST, OnUpdateOrderLast)
	ON_UPDATE_COMMAND_UI(ID_ORDER_FIRST, OnUpdateOrderFirst)
	ON_UPDATE_COMMAND_UI(ID_ORDER_DOWN, OnUpdateOrderDown)
	ON_COMMAND(ID_MARK_FILE_SAVE_AS, OnFileSaveAs)
	ON_COMMAND(IDC_VIEW_GRID, OnViewGrid)
	ON_UPDATE_COMMAND_UI(IDC_VIEW_GRID, OnUpdateViewGrid)
	ON_COMMAND(IDC_VIEW_RULER, OnViewRuler)
	ON_UPDATE_COMMAND_UI(IDC_VIEW_RULER, OnUpdateViewRuler)
	ON_COMMAND(IDC_VIEW_ONLYMARK, OnViewOnlymark)
	ON_UPDATE_COMMAND_UI(IDC_VIEW_ONLYMARK, OnUpdateViewOnlymark)
	ON_COMMAND(ID_VIEW_FIGURE, OnViewFigure)
	ON_UPDATE_COMMAND_UI(ID_VIEW_FIGURE, OnUpdateViewFigure)
	ON_COMMAND(IDC_CHANGE_MARKORDER, OnChangeMarkorder)
	ON_COMMAND(ID_MENU_AMKOR, OnMenuAmkor)
	ON_COMMAND(IDC_SAMPLEDB_MENU, OnSampledbMenu)
	ON_COMMAND(ID_RE_LOGIN, OnReLogin)
	ON_COMMAND(ID_SEMFILE_SAVE, OnSemfileSave)
	ON_COMMAND(ID_RSCFILE_SAVE, OnRscfileSave)
	ON_COMMAND(ID_SHUTTER_DELAY, OnShutterDelay)
	ON_COMMAND(ID_CUSTOMER_CODE, OnCustomerCode)
	ON_WM_TIMER()
	ON_COMMAND(ID_OPERATOR_MODE, OnOperatorMode)
	ON_UPDATE_COMMAND_UI(ID_FILE_OPEN, OnUpdateFileOpen)
	ON_UPDATE_COMMAND_UI(ID_NEW_TEXT, OnUpdateNewText)
	ON_UPDATE_COMMAND_UI(ID_LASER_CTR, OnUpdateLaserCtr)
	ON_UPDATE_COMMAND_UI(ID_FILE_NEW, OnUpdateFileNew)
	ON_UPDATE_COMMAND_UI(ID_NEW_HPGL, OnUpdateNewHpgl)
	

	ON_UPDATE_COMMAND_UI(ID_MARK_FILE_SAVE, OnUpdateMarkFileSave)
	ON_COMMAND(ID_LOT_COMP_TIME, OnLotCompTime)
	ON_UPDATE_COMMAND_UI(IDC_OBJ_COPY_FRAME, OnUpdateObjCopyFrame)
	ON_UPDATE_COMMAND_UI(IDC_OBJ_ERASE_FRAME, OnUpdateObjEraseFrame)
	ON_UPDATE_COMMAND_UI(IDC_SELECT_ALL, OnUpdateSelectAll)
	ON_UPDATE_COMMAND_UI(IDC_UNSELECT_ALL_FRAME, OnUpdateUnselectAllFrame)
	ON_UPDATE_COMMAND_UI(IDC_MAIN_ZOOM_IN2, OnUpdateMainZoomIn2)
	ON_UPDATE_COMMAND_UI(IDC_MAIN_ZOOM_OUT, OnUpdateMainZoomOut)
	ON_UPDATE_COMMAND_UI(IDC_SCREEN_ZOOM, OnUpdateScreenZoom)
	ON_UPDATE_COMMAND_UI(IDC_SCREEN_ZOOM_ORG, OnUpdateScreenZoomOrg)
	ON_UPDATE_COMMAND_UI(ID_NEW_IMG, OnUpdateNewImg)
	ON_UPDATE_COMMAND_UI(ID_NEW_BAR, OnUpdateNewBar)
	ON_UPDATE_COMMAND_UI(ID_2DBARCODE, OnUpdate2dbarcode)
	ON_UPDATE_COMMAND_UI(ID_NEW_TTF, OnUpdateNewTtf)
	ON_COMMAND(ID_NEW_DXF, OnNewDxf)
	ON_WM_PAINT()
	ON_UPDATE_COMMAND_UI(ID_NEW_DXF, OnUpdateNewDxf)
	ON_COMMAND(ID_HARDWARE_TEST, OnHardwareTest)
	ON_COMMAND(ID_FILE_NEW, OnFileNew)
	ON_COMMAND(IDC_SELECT_ALL, OnSelectAll)
	ON_COMMAND(IDC_UNSELECT_ALL_FRAME, OnUnselectAllFrame)
	ON_COMMAND(ID_NEW_SEM, OnNewSem)
	ON_COMMAND(ID_FILE_SAVE, OnFileSave)
	ON_COMMAND(ID_MENU_FONTCAD, OnMenuFontcad)
	//ON_COMMAND(ID_Menu_IO, OnMenuIo)
	//}}AFX_MSG_MAP
	ON_WM_SIZE()
	ON_COMMAND(ID_NEW_DATA, &CMainFrame::OnNewData)
	ON_UPDATE_COMMAND_UI(ID_NEW_DATA, &CMainFrame::OnUpdateNewData)
	
	ON_COMMAND(ID_Menu_IO, &CMainFrame::OnMenuIo)
	ON_UPDATE_COMMAND_UI(ID_SET_FIELD_SIZE, &CMainFrame::OnUpdateSetFieldSize)
	ON_UPDATE_COMMAND_UI(ID_SET_AUTHORITY, &CMainFrame::OnUpdateSetAuthority)
	END_MESSAGE_MAP()

static UINT indicators[] =
{
	ID_SEPARATOR,           // status line indicator
	ID_INDICATOR_CAPS,
	ID_INDICATOR_NUM,
	ID_INDICATOR_SCRL,
};

/////////////////////////////////////////////////////////////////////////////
// CMainFrame construction/destruction

CMainFrame::CMainFrame()
{
	// TODO: add member initialization code here
	/* Separated Toolbar */
	m_bExitFlag = FALSE;
	dlgMsg = NULL;
	m_bShowStandard = TRUE;
	m_bShowEdit = TRUE;
	m_bShowAlign = TRUE;
	m_bShowMarkOrder = TRUE;
	m_bShowHelp = TRUE;
	m_bShowFigure = TRUE;
	m_OrgScaleFlag = TRUE;
	m_pCommunicate = NULL;
	
	m_nOperatorTime = 300000;	
	
	m_bNoClose = FALSE;  //¡æ∑· ∏¯«œ∞‘ «œ¥¬ ∫Øºˆ 

	// LaserControl Dialog √ ±‚»≠ */
	m_pDlgLaserControl = NULL;
	FirstLogFlag = TRUE;

	/* ø©±‚º≠ »£√‚«œ¥¬ ¿Ã¿Ø¥¬ Main∞˙ øœ¿¸»˜ ∫–∏Æ«œ±‚ ¿ß«ÿº≠ */
	

	/* Comport Open */
	/*if (m_pCommunicate == NULL || m_pCommunicate->GetIsConnect() == FALSE)
	{
		m_pCommunicate = new CRS232("Power Adjustment", this);
		int portnum = 0;
        portnum = (int)m_pCommunicate->StartCommunicate();
		
		if (portnum < 0)
			return;
		//m_PowerMeasermentComport = portnum;
		m_pCommunicate->SetIsConnect(TRUE);
	}
	*/
	/* Parameter List¿« ª˝º∫∞˙ √ ±‚»≠ */
	CPointerManager *pPointerManager = pPointerManager->GetInstance();
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	pPointerManager->SetParameterList(new CItemList<CParameter *>(MAX_PARAMETER));
	pFieldParameter->SetSelectAllFlag(FALSE); 
	InitItemList();

	InitDefaultObject();
	pFieldParameter->SetSetedPowerValue(10);
	
	
	
	CBeamEditor6Doc *pDoc;
	pDoc = (CBeamEditor6Doc*)GetActiveDocument();
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
	
	
//---------------------------- Device Index reading -------------
    Load_DeviceIndex();

	//psc -------------------------------------------------------
	CInitialTable *pInitialTable = pInitialTable->GetInstance();
	if(pInitialTable->GetKindOfRtcBoard() == 1) 
		InitPsc();	//psc	
	else	//---------------------------------------------------
	{
		CWriteLog *log= NULL;;
		
		if(InitRTC() != TRUE)
		{
			////log->WriteString("InitRTC() ¥ŸΩ√ Ω√µµ ");
			//if(InitRTC() != TRUE)	//scanlab
			{
				log->WriteString("BeamEditor6.exe «¡∑Œ±◊∑•¿ª ¥ŸΩ√ Ω√¿€«ÿ ¡÷Ω Ω√ø¿.");
			//	AfxMessageBox("BeamEditor6.exe «¡∑Œ±◊∑•¿ª ¥ŸΩ√ Ω√¿€«ÿ ¡÷Ω Ω√ø¿.");
			//	m_bExitFlag = TRUE;
				//ExitApp();
			}
		}
	}

	CreateLaserControl();
	//OnLaserCtr();
	CreateProgressBar();

	GuiAlarm = new CGuiAlarm;
	GuiAlarm->Create(this);


	GuiError = new CGuiError;
	GuiError->Create(this);
	
//	m_pDlg.Create(IDD_DLG_QUANTRONIX,this);
}

void CMainFrame::InitDefaultObject()
{
	CDisplay *pDisp;
	CMKObjectApproacher *pApproacher;
	CMKObjectManager *pObjectManager;
	CommandManager *pCommandManager;
	

	
	pDisp = new CNormalDisplay;  //±‚∫ª µΩ∫«√∑π¿Ã ª˝º∫
	pApproacher = new CMKStdObjectApproacher; //±‚∫ª ø¿∫Í¡ß∆Æ ¡¢±Ÿ¿⁄ ª˝º∫
	pObjectManager = CMKObjectManager::Instance();    //ΩÃ±€≈Ê
	
	pCommandManager = new StdCommandManager;
	
	
	CPointerContainer::SetApproacher(pApproacher); //∆˜¿Œ≈Õ∏¶ µÓ∑œ«ÿ ≥ı¥¬¥Ÿ.
	CPointerContainer::SetDisplay(pDisp);          //ø™Ω√ Displayµµ µÓ∑œ«ÿ≥ı¥¬¥Ÿ.

	pObjectManager->SetApproacher(pApproacher); 
	
	CPointerContainer::SetCommandManager(pCommandManager); //ƒø∏«µÂ ∞¸∏Æ¿⁄ µÓ∑œ«ÿ≥ı¥¬¥Ÿ.
	CPointerContainer::SetMKFile(new CMKStdFile);



	
	CBGDeviceDisplay *pDevice =new CBGDeviceDisplay;  // ≥◊∏ªÛ¿⁄ (µπŸ¿ÃΩ∫)
	CBGGridDisplay *pGrid = new CBGGridDisplay;
	CRectDisplay *pRDisp = new CRectDisplay;          // º±≈√Ω√ ∂ﬂ¥¬ 9∞≥¡°¿Ã¿÷¥¬ ∏æÁ¿« π⁄Ω∫
	// æ»
	CNormalRectDisplay *pNRDisp = new CNormalRectDisplay;          // º±≈√Ω√ ∂ﬂ¥¬ 9∞≥¡°¿Ã¿÷¥¬ ∏æÁ¿« π⁄Ω∫

	CBGAfterImage *pBGAfter = CBGAfterImage::Instance();
	
	CInitialTable *pInitialTable = CInitialTable::GetInstance();
	pGrid->SetEnable(pInitialTable->GetViewGrid());
	
	CGripPointDisplay *pGPDisp = new CGripPointDisplay;
	


	pDisp->AddBG(pDevice);    //πË∞Ê»≠∏È µÓ∑œ
	pDisp->AddBG(pGrid);
	pDisp->AddBG(pBGAfter);	
	pDisp->AddFG(pRDisp);  //¿¸∞Ê»≠∏È µÓ∑œ
	pDisp->AddFG(pGPDisp);

	// æ»
	pDisp->AddFG(pNRDisp);

	CFGFlagDisplay *pFGFlag = new CFGFlagDisplay;
	pDisp->AddFG(pFGFlag);
	
	// 2004.03.12 ∑Í∑Ø ≥÷±‚
	CFGRulerDisplay *pFGRuler = new CFGRulerDisplay;
	int iRulerSize = CInitialTable::GetInstance()->GetRulerSize();
	CPoint ptTemp; 
	ptTemp.x = iRulerSize;     ptTemp.y = iRulerSize;
	
	pFGRuler->SetRulerSize(ptTemp);
	pFGRuler->SetInterval(CInitialTable::GetInstance()->GetRulerScale());
	pFGRuler->SetFontSize(CInitialTable::GetInstance()->GetRulerFontSize());
	pDisp->AddFG(pFGRuler);

	
	BOOL bRes = pInitialTable->GetViewRuler();
	if( bRes ==TRUE) 
	{
		pDisp->SetShiftScreen(RULER_SIZE, RULER_SIZE);
		pFGRuler->SetEnable(TRUE);
	}
	else
	{
		pDisp->SetShiftScreen(0,0);
		pFGRuler->SetEnable(FALSE);
	}

	// ±‚∫ª µπŸ¿ÃΩ∫ ≈©±‚ º≥¡§
//	CDeviceManager *pDevManager =  CDeviceManager::Instance();
//	CDeviceData *pDevData = pDevManager->GetDeviceData();
//	pDevData->SetChipWidth(5000);
//	pDevData->SetChipHeight(5000);
}


CMainFrame::~CMainFrame()
{
	m_pDlg.StopMarkThread();
	/* 2004.02.25 ¡æ∑· ¿¸ ¿˙¿Â */
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp();
	CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
//	pUserCheckMng->Save("c:\\AUTHORITY.usr");	

	
    CInitialTable *pInitialTable = pInitialTable->GetInstance();
	//psc -------------------------------------
	CPsc140p* pPsc = CPsc140p::GetInstance();
	if(pInitialTable->GetKindOfRtcBoard() == 1)
		pPsc->PscEnableLaser(0,0,0);
	//-----------------------------------------
// 	int result = pInitialTable->SaveInitialFile("c:\\Options.ini");	

//	if (CDlgMark::GetInstance() != NULL)
//		delete CDlgMark::GetInstance();
		//CDlgMark::Destructor();
	/* Memory Leaks ºˆ¡§ */

	if(dlgMsg != NULL) delete dlgMsg;
//	delete CPointerManager::GetInstance();
	delete CInitialTable::GetInstance();
	delete CFilePath::GetInstance();
	delete CCommunicateTable::GetInstance();
	m_pDlgLaserControl = NULL;
//	if( m_pDlgLaserControl != NULL)
//		delete m_pDlgLaserControl;
//	delete CPointerManager::GetParameterList(); //   2004.01.12  ¡ﬂ∫πµ«¥¬∞Õ ∞∞æ∆º≠ ¡÷ºÆ√≥∏Æ 
	delete CLanguage::GetInstance();
//	delete CDlgParameter::GetInstance();
//	delete CFieldParameter::GetInstance();
	delete CTransUnit::GetInstance();
//	delete CDsp::GetInstance();
	delete CMarking::GetInstance();
	delete CBin::GetInstance();

	//   √ﬂ∞° //
	delete CPointerContainer::GetDisplay();
	CDeviceManager::Remove();
	CMKObjectManager::RemoveInstance();
	delete CPointerContainer::GetApproacher();
	//CMKObjectHandler::Remove();
	delete CPointerContainer::GetCommandManager();
	delete CPointerContainer::GetMKFile();
	delete CUserCheckMng::Instance();

	m_menu.DestroyMenu();
}

/* Separated Toolbar Start */
void EkDockBarNextTo(	CControlBar* pNewBar,
						CControlBar* pDockedBar,
						UINT nDockBarID = AFX_IDW_DOCKBAR_TOP )
{
	ASSERT_VALID( pDockedBar );
	ASSERT_VALID( pNewBar );

	// 1 - Find the frame where we will dock
	CFrameWnd* pFrame = pDockedBar->GetDockingFrame();

	// 2 - Force MFC to compute the positions
	// of the docked control bar(s)
	pFrame->RecalcLayout();

	// 3 - Compute rectangle of already "docked" bar
	CRect rect;
	pDockedBar->GetWindowRect( &rect );

	// 4 - Offset the rectangle slightly to the bottom right
	// so that the new bar will dock either to the right or
	// to the bottom of the existing bar (depending on the
	// side where this last bar is already docked)
	rect.OffsetRect(1,1);

	// 5 - Dock new bar to specified position
	pFrame->DockControlBar( pNewBar, nDockBarID, &rect );
}
/* Separated Toolbar End */

int CMainFrame::OnCreate(LPCREATESTRUCT lpCreateStruct)
{
	if (CFrameWnd::OnCreate(lpCreateStruct) == -1)
		return -1;

	/* Window Maximize */
	CFrameWnd::ShowWindow(SW_MAXIMIZE);
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 

	/* Loading Toolbar */
	LoadToolbar();

	/* ToolBar Check Show/Hide */
	//OnViewStandard();
	//OnViewEdit();
	//OnViewAlign();
	//OnViewHelp();
	//OnViewMarkorder();
	//OnViewFigure();

	if (!m_wndStatusBar.Create(this) ||
		!m_wndStatusBar.SetIndicators(indicators,
		  sizeof(indicators)/sizeof(UINT)))
	{
		TRACE0("Failed to create status bar\n");
	
		return -1;      // fail to create
	}

	// TODO: Delete these three lines if you don't want the toolbar to
	/* ∑Œµ˘ ¿ÃπÃ¡ˆ ∑Œµ˘ ø©∫Œ º±≈√ */
	CInitialTable *pInitialTable = pInitialTable->GetInstance();
	if (pInitialTable->GetLoadingImage())
		CSplashWnd::ShowSplashScreen(this);

	/* ææÓ √ ±‚»≠ «œ±‚ */
	CLanguage *pLanguage = pLanguage->GetInstance();
	pLanguage->SetLanguage(pInitialTable->GetLanguage());


	CWriteLog *log= NULL;;
	log->WriteString(_T("Start Program"));

	//SetTimer(AUTO_MARK_VIEW, 100, NULL);
	SetTimer(TM_CHECK_HARDSPACE, 1000, NULL);
	SetWindowText("KFlyCut-Cathode");
	
	return 0;
}

BOOL CMainFrame::PreCreateWindow(CREATESTRUCT& cs)
{
	if( !CFrameWnd::PreCreateWindow(cs) )
		return FALSE;
	// TODO: Modify the Window class or styles here by modifying
	//  the CREATESTRUCT cs
	/* √ ±‚ ∏ﬁ¥∫ æ¯æ÷±‚ - ææÓ∫∞ º±≈√ ∑Œµ˘Ω√ ¿Á∑Œµ˘ «ˆªÛ¿Ã æ¯µµ∑œ «œ±‚ ¿ß«ÿ */
	
	//CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
	
	//SetWindowText("¡¶∏Òæ¯¿Ω("+pUserCheckMng->GetCurUserName()+")");
	cs.hMenu = NULL;


	return TRUE;
}

/////////////////////////////////////////////////////////////////////////////
// CMainFrame diagnostics

#ifdef _DEBUG
void CMainFrame::AssertValid() const
{
	CFrameWnd::AssertValid();
}

void CMainFrame::Dump(CDumpContext& dc) const
{
	CFrameWnd::Dump(dc);
}

#endif //_DEBUG

/////////////////////////////////////////////////////////////////////////////
// CMainFrame message handlers
// 2003.11.03 ∏ﬁ¥∫ ∑Œµ˘«œ±‚
HMENU CMainFrame::LoadingMenu()
{
	// Load the menu from the resources
	/* Change Menu Loading */
	if (CInitialTable::GetInstance()->GetKindOfLaser() == 3) {
		m_menu.LoadMenu(IDR_MAINFRAME_CO2);
		m_menu.LoadToolbar(IDR_MAINFRAME_MENU);
	}
	else if (CInitialTable::GetInstance()->GetLaser() == LASER_ROFIN
		|| CInitialTable::GetInstance()->GetLaser() == LASER_FIBER)
	{
		//m_menu.LoadMenu(IDR_MAINFRAME_ROFIN);
		m_menu.LoadMenu(IDR_MAINFRAME);
		//m_menu.LoadToolbar(IDR_MAINFRAME_MENU);
	}
	else {
		m_menu.LoadMenu(IDR_MAINFRAME);
		//m_menu.LoadToolbar(IDR_MAINFRAME_MENU);
	}
	
	//  √ﬂ∞° ( ∆Àæ˜ ∏ﬁ¥∫ ∂ÁøÏ±‚ 2004.3.16 )
	SetContextMenu(IDR_MENU_POPUP);
	return(m_menu.Detach());
}


void CMainFrame::SetContextMenu(UINT nID)
{
	m_nMenuID = nID;
}

void CMainFrame::EnablePopMenu()
{
	CPoint point;
	GetCursorPos(&point);

	if (point.x == -1 && point.y == -1)
	{
		//keystroke invocation
		CRect rect;
		GetClientRect(rect);

		CPoint PtRect;

		/////////////////////////////////////
		PtRect.x	= rect.left;
		PtRect.y	= rect.top;
		ClientToScreen(&PtRect);
		rect.left	= PtRect.x;
		rect.top	= PtRect.y;
		/////////////////////////////////////
		point = rect.TopLeft();

		point.x += 5;
		point.y += 5;
	}

	if (m_nMenuID>0)
	{

		VERIFY(m_menuPop.LoadMenu(m_nMenuID));

		CMenu* pPopup = m_menuPop.GetSubMenu(0);

		CWnd* pWndPopupOwner = AfxGetMainWnd();

		while (pWndPopupOwner->GetStyle() & WS_CHILD)
			pWndPopupOwner = pWndPopupOwner->GetParent();

		pPopup->TrackPopupMenu(TPM_LEFTALIGN | TPM_RIGHTBUTTON, point.x, point.y,
			pWndPopupOwner);

	}
	
	return;
}
void CMainFrame::LoadToolbar()
{
	/* Separated Toolbar Start */
	/*
	if (CInitialTable::GetInstance()->GetKindOfLaser() == 1) {
		// STANDARD TOOL
		m_Tool[STANDARD].CreateEx(this, TBSTYLE_FLAT, WS_CHILD | WS_VISIBLE | CBRS_TOP 
			| CBRS_GRIPPER | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC );
		m_Tool[STANDARD].LoadToolBar(IDR_MAINFRAME1_CO2);
		m_Tool[STANDARD].EnableDocking(CBRS_ALIGN_ANY);
		EnableDocking(CBRS_ALIGN_ANY);
		DockControlBar(&m_Tool[STANDARD], AFX_IDW_DOCKBAR_TOP, CRect(0,15,10,30));
		m_bToolCheck[STANDARD] = TRUE;
		m_Tool[STANDARD].SetBarStyle( m_Tool[STANDARD].GetBarStyle() | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC );
	}
	else {
		// STANDARD TOOL
		m_Tool[STANDARD].CreateEx(this, TBSTYLE_FLAT, WS_CHILD | WS_VISIBLE | CBRS_TOP 
			| CBRS_GRIPPER | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC );
		m_Tool[STANDARD].LoadToolBar(IDR_MAINFRAME_MENU);
		//m_Tool[STANDARD].LoadToolBar(IDR_MAINFRAME_OLD);
		m_Tool[STANDARD].EnableDocking(CBRS_ALIGN_ANY);
		EnableDocking(CBRS_ALIGN_ANY);
		DockControlBar(&m_Tool[STANDARD], AFX_IDW_DOCKBAR_TOP, CRect(0,15,10,30));
		m_bToolCheck[STANDARD] = TRUE;
		m_Tool[STANDARD].SetBarStyle( m_Tool[STANDARD].GetBarStyle() | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC );
	}
	*/

	//m_ToolBarDrawTop.SetBorders(1, 1, 1, 1);
	//if (!m_ToolBarDrawTop.Create(this, WS_CHILD | WS_VISIBLE | CBRS_TOP
	//	| CBRS_GRIPPER | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC) ||
	//	!m_ToolBarDrawTop.LoadToolBar(IDR_TOOLBAR_DRAW))
	//	//!m_ToolBarDrawTop.LoadToolBar(IDR_MAINFRAME_MENU))
	//{
	//	TRACE0("Failed to create toolbar\n");
	//	return;      // fail to create
	//}
	//m_ToolBarDrawTop.ModifyStyle(0, TBSTYLE_FLAT);

	//m_ToolBarDrawTop.LoadTrueColorToolBar(TOOLBAR_DRAW_BUTTON_WIDTH,
	//								   IDB_TOOLBAR_DRAW,
	//	                               IDB_TOOLBAR_DRAW_HOT,
	//								   IDB_TOOLBAR_DRAW_DISABLED);

	//m_ToolBarDrawTop.EnableDocking(CBRS_ALIGN_ANY);
	//EnableDocking(CBRS_ALIGN_ANY);
	//DockControlBar(&m_ToolBarDrawTop);

	
	//// ADDED OBJECT TOOL
	//m_Tool[FIGURE].CreateEx(this, TBSTYLE_FLAT, WS_CHILD | WS_VISIBLE | CBRS_LEFT 
	//	  | CBRS_GRIPPER | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC );
	//m_Tool[FIGURE].LoadToolBar(IDR_MAINFRAME8);
	//m_Tool[FIGURE].EnableDocking(CBRS_ALIGN_ANY);
	//EnableDocking(CBRS_ALIGN_ANY);
	//m_bToolCheck[FIGURE] = TRUE;

	// EDIT TOOL
	//m_Tool[EDIT].CreateEx(this, TBSTYLE_FLAT, WS_CHILD | WS_VISIBLE | CBRS_LEFT 
	//	  | CBRS_GRIPPER | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC );
	//m_Tool[EDIT].LoadToolBar(IDR_MAINFRAME2);
	//m_Tool[EDIT].EnableDocking(CBRS_ALIGN_ANY);
	//EnableDocking(CBRS_ALIGN_ANY);
	//m_bToolCheck[EDIT] = TRUE;


	//// ALIGN TOOL
	//m_Tool[ALIGN].CreateEx(this, TBSTYLE_FLAT, WS_CHILD | WS_VISIBLE | CBRS_TOP 
	//	  | CBRS_GRIPPER | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC );
	//m_Tool[ALIGN].LoadToolBar(IDR_MAINFRAME3);
	//m_Tool[ALIGN].EnableDocking(CBRS_ALIGN_ANY);
	//EnableDocking(CBRS_ALIGN_ANY);
	//DockControlBar(&m_Tool[ALIGN]);
	//DockControlBar(&m_Tool[ALIGN], AFX_IDW_DOCKBAR_RIGHT, CRect(0,15,10,30));
	//m_bToolCheck[ALIGN] = TRUE;
	////

	//
	///////////////////// æÓ∂ª∞‘ «œ∏È ≈¯∆¡¿Ã ≥™≈∏≥™¥¬µ•±Ó¡ˆ µÙ∑π¿Ã≈∏¿”¿ª ¡Ÿ¿œºˆ ¿÷¿ª±Óø‰ /////
	//m_Tip.Create(&m_Tool[EDIT],TTS_ALWAYSTIP );
	//m_Tip.EnableToolTips();
	//m_Tip.SetDelayTime(0);
	//m_Tip.SendMessage(TTM_SETDELAYTIME, TTDT_INITIAL,MAKELONG(100,0));
	//m_Tip.SendMessage(TTM_SETDELAYTIME, TTDT_RESHOW, MAKELONG(100,0));
	//m_Tool[EDIT].SendMessage(TTM_SETDELAYTIME, TTDT_INITIAL,MAKELONG(100,0));
	//m_Tool[EDIT].SendMessage(TTM_SETDELAYTIME, TTDT_RESHOW,MAKELONG(100,0));
	//SendMessage(TTM_SETDELAYTIME, TTDT_INITIAL, MAKELONG(100,0) );
	//SendMessage(TTM_SETDELAYTIME, TTDT_RESHOW, MAKELONG(100,0) );
	////////////////////////////////////////////////////////////////////// ∫∞∞≈ ¥Ÿ«ÿ∫¡µµ æ»µ«≥◊.


	
	
//	pWnd->
	//¡¯ºÆ 12.22
//	m_Tip.Create(this,0);
	
//	CRect rtItem;
//	m_Tool[EDIT].GetToolBarCtrl().GetItemRect(2,rtItem);
//	m_Tip.AddTool(this,"MFC ≈¯∆¡ ≈◊Ω∫∆Æ", &rtItem, 1);
	//¡¯ºÆ 12.22

	

	//// MARKORDER TOOL
	//m_Tool[MARKORDER].CreateEx(this, TBSTYLE_FLAT , WS_CHILD | WS_VISIBLE | CBRS_LEFT 
	//	  | CBRS_GRIPPER | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC );
	//m_Tool[MARKORDER].LoadToolBar(IDR_MAINFRAME4);
	//m_Tool[MARKORDER].EnableDocking(CBRS_ALIGN_ANY);
	//EnableDocking(CBRS_ALIGN_ANY);
	//m_bToolCheck[MARKORDER]	= TRUE;
	//
	//// HELP TOOL
	//m_Tool[HELP].CreateEx(this, TBSTYLE_FLAT , WS_CHILD | WS_VISIBLE | CBRS_LEFT
	//	  | CBRS_GRIPPER | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC );
	//m_Tool[HELP].LoadToolBar(IDR_MAINFRAME5);
	//m_Tool[HELP].EnableDocking(CBRS_ALIGN_ANY);
	//EnableDocking(CBRS_ALIGN_ANY);
	//m_bToolCheck[HELP]	= TRUE;
	//
	//EkDockBarNextTo(&m_Tool[EDIT], &m_Tool[STANDARD]);

	//EkDockBarNextTo(&m_Tool[ALIGN], &m_Tool[EDIT]);
	//EkDockBarNextTo(&m_Tool[EDIT], &m_Tool[ALIGN]);


	//EkDockBarNextTo(&m_Tool[FIGURE],&m_Tool[ALIGN]);
	//EkDockBarNextTo(&m_Tool[MARKORDER], &m_Tool[FIGURE]);	
	//EkDockBarNextTo(&m_Tool[HELP], &m_Tool[MARKORDER]);
	//m_bToolCheck[BOOL_MAINTOOL] = TRUE;
	/* Separated Toolbar End */

    //ShowControlBar(&m_Tool[FIGURE], FALSE, FALSE);	

	/* Loading 24 Bit Image Start */
   // CBitmap bitmap;
	//CImageList imageList;
	
	//if (CInitialTable::GetInstance()->GetKindOfLaser() == 1) {
	//	// STANDARD TOOL
	//	bitmap.LoadBitmap(IDB_24BIT_CO2STANDARD/*IDB_GLCOLOR_TOOLBAR*/);
	//	imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
	//	imageList.Add(&bitmap, RGB(255,0,255));
	//	m_Tool[STANDARD].GetToolBarCtrl().SetDisabledImageList(&imageList);
	//	m_Tool[STANDARD].SendMessage(TB_SETIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
	//	imageList.Detach();
	//	bitmap.Detach();

	//	bitmap.LoadBitmap(IDB_24BIT_CO2STANDARD/*IDB_HICOLOR_TOOLBAR*/);
	//	imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
	//	imageList.Add(&bitmap, RGB(255,0,255));
	//	m_Tool[STANDARD].SendMessage(TB_SETHOTIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
	//	imageList.Detach();
	//	bitmap.Detach();
	//}
	//else {
	//	// STANDARD TOOL
	//	bitmap.LoadBitmap(IDB_24BIT_STANDARD/*IDB_GLCOLOR_TOOLBAR*/);
	//	imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
	//	imageList.Add(&bitmap, RGB(255,0,255));
	//	m_Tool[STANDARD].GetToolBarCtrl().SetDisabledImageList(&imageList);
	//	m_Tool[STANDARD].SendMessage(TB_SETIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
	//	imageList.Detach();
	//	bitmap.Detach();

	//	bitmap.LoadBitmap(IDB_24BIT_STANDARD/*IDB_HICOLOR_TOOLBAR*/);
	//	imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
	//	imageList.Add(&bitmap, RGB(255,0,255));
	//	m_Tool[STANDARD].SendMessage(TB_SETHOTIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
	//	imageList.Detach();
	//	bitmap.Detach();
	//}

	// FIGURE TOOL
	//bitmap.LoadBitmap(IDB_24BIT_FIGURE/*IDB_GLCOLOR_TOOLBAR*/);
 //   imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
 //   imageList.Add(&bitmap, RGB(255,0,255));
	//m_Tool[FIGURE].GetToolBarCtrl().SetDisabledImageList(&imageList);
 //   m_Tool[FIGURE].SendMessage(TB_SETIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
	//imageList.Detach();
 //   bitmap.Detach();

 //   bitmap.LoadBitmap(IDB_24BIT_FIGURE/*IDB_HICOLOR_TOOLBAR*/);
 //   imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
 //   imageList.Add(&bitmap, RGB(255,0,255));
 //   m_Tool[FIGURE].SendMessage(TB_SETHOTIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
 //   imageList.Detach();
 //   bitmap.Detach();

	//// EDIT TOOL
 //   bitmap.LoadBitmap(IDB_24BIT_EDIT/*IDB_HICOLOR_TOOLBAR*/);
 //   imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
 //   imageList.Add(&bitmap, RGB(255,0,255));
 //   m_Tool[EDIT].SendMessage(TB_SETHOTIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
 //   imageList.Detach();
 //   bitmap.Detach();

	//bitmap.LoadBitmap(IDB_24BIT_EDIT/*IDB_GLCOLOR_TOOLBAR*/);
 //   imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
 //   imageList.Add(&bitmap, RGB(255,0,255));
	//m_Tool[EDIT].GetToolBarCtrl().SetDisabledImageList(&imageList);
 //   m_Tool[EDIT].SendMessage(TB_SETIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
	//imageList.Detach();
 //   bitmap.Detach();

	////// ALIGN TOOL
 //   bitmap.LoadBitmap(IDB_24BIT_ALIGN/*IDB_HICOLOR_TOOLBAR*/);
 //   imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
 //   imageList.Add(&bitmap, RGB(255,0,255));
 //   m_Tool[ALIGN].SendMessage(TB_SETHOTIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
 //   imageList.Detach();
 //   bitmap.Detach();

	//bitmap.LoadBitmap(IDB_24BIT_ALIGN/*IDB_GLCOLOR_TOOLBAR*/);
 //   imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
 //   imageList.Add(&bitmap, RGB(255,0,255));
	//m_Tool[ALIGN].GetToolBarCtrl().SetDisabledImageList(&imageList);
 //   m_Tool[ALIGN].SendMessage(TB_SETIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
	//imageList.Detach();
 //   bitmap.Detach();

	//// HELP TOOL
 //   bitmap.LoadBitmap(IDB_24BIT_HELP/*IDB_HICOLOR_TOOLBAR*/);
 //   imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
 //   imageList.Add(&bitmap, RGB(255,0,255));
 //   m_Tool[HELP].SendMessage(TB_SETHOTIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
 //   imageList.Detach();
 //   bitmap.Detach();

	//bitmap.LoadBitmap(IDB_24BIT_HELP/*IDB_GLCOLOR_TOOLBAR*/);
 //   imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
 //   imageList.Add(&bitmap, RGB(255,0,255));
	//m_Tool[HELP].GetToolBarCtrl().SetDisabledImageList(&imageList);
 //   m_Tool[HELP].SendMessage(TB_SETIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
	//imageList.Detach();
 //   bitmap.Detach();

	//// MARKORDER TOOL
 //   bitmap.LoadBitmap(IDB_24BIT_MARKORDER/*IDB_HICOLOR_TOOLBAR*/);
 //   imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
 //   imageList.Add(&bitmap, RGB(255,0,255));
 //   m_Tool[MARKORDER].SendMessage(TB_SETHOTIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
 //   imageList.Detach();
 //   bitmap.Detach();

	//bitmap.LoadBitmap(IDB_24BIT_MARKORDER/*IDB_GLCOLOR_TOOLBAR*/);
 //   imageList.Create(26, 26, ILC_COLORDDB|ILC_MASK, 13, 1);
 //   imageList.Add(&bitmap, RGB(255,0,255));
	//m_Tool[MARKORDER].GetToolBarCtrl().SetDisabledImageList(&imageList);
 //   m_Tool[MARKORDER].SendMessage(TB_SETIMAGELIST, 0, (LPARAM)imageList.m_hImageList);
	//imageList.Detach();
 //   bitmap.Detach();

	

	/* Loading 24 Bit Image End */
}

void CMainFrame::OnNewTtf() 
{
	// TODO: Add your command handler code here

/*	CObjectTTFCreateFactory TTFCF;	
	CMKObject *pObject = TTFCF.Create();
	ASSERT(pObject != NULL);
	if( IDOK==pObject->DoModal() )
	{
		CPointerContainer::GetApproacher()->Add(pObject);
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	}
	else 
	{
		delete pObject;
	}
	Invalidate(FALSE);*/
/*
	CString A="abc«—", Find=_T("");

	for(int i=0; i<A.GetLength(); i++) 
	{
       if(IsDBCSLeadByte(A[i]))
	   {
             Find+=A[i++];
             Find+=A[i];
        }
	}

	AfxMessageBox(Find);
*/

	StdCmdCreator<CMDCreateTTF> pCmd;
	if( TRUE==CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		Invalidate(FALSE);
	}

//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();	
//	}

}

void CMainFrame::OnLaserCtr() 
{
	CUserCheckMng *pUserCheckMng = CUserCheckMng::Instance();
	if (pUserCheckMng->GetCurUserName() == "OPERATOR")
	{
		CMainFrame* pMainFrm = (CMainFrame*)AfxGetApp()->GetMainWnd();
		//pMainFrm->PostMessage(WM_HIDE_ALARM,ALARM_READY);
		pMainFrm->PostMessage(WM_SHOW_ERROR,ERROR_ADMIN);
		return;
	}

	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
	if(m_pDlgMark->m_hWnd  != NULL)
	{
		if(!m_pDlgMark->m_csTabMarking.m_AutoMarkFlag)
			OnShowLaserControl();
			
	}
	else
		OnShowLaserControl();


}

void CMainFrame::OnCommSetting() 
{
	// TODO: Add your command handler code here
	CPointerManager *m_pPointerManager = m_pPointerManager->GetInstance();
	m_pPointerManager->GetDlgComm()->DoModal();
}



void CMainFrame::OnMarkFrame() 
{
	// TODO: Add your command handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
	
	if(m_pDlgMark->GetDlgAlive() == FALSE)
	{
		m_pDlgMark->Create(IDD_DLG_MARK);
		m_pDlgMark->CenterWindow();
		m_pDlgMark->SetDlgAlive(TRUE);
	}
	//pFrame->ShowWindow(SW_HIDE);	//∏ﬁ¿Œ»≠∏È º˚±‚±‚.
	m_pDlgMark->ShowWindow(SW_SHOW);	
	pDoc->m_bDlgMarkFlag = TRUE;
	
}

void CMainFrame::OnSysCommand(UINT nID, LPARAM lParam) 
{
	CPointerManager *m_pPointerManager = m_pPointerManager->GetInstance();

	/* Close∞° æ∆¥œ∏È π´¡∂∞« Ω««‡ */
	if (nID != SC_CLOSE) {	
		CFrameWnd::OnSysCommand(nID, lParam);
	}
	/* Close¿Ã∏È ∞ÊøÏø° µ˚∂Û ¥ﬁ∏Æ¡¸ */
	else {

		if( m_bNoClose == TRUE )
		{
			return;
		}

		/*		CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();	
		if (pUserCheckMng->GetCurUserName() != "ADMINISTRATOR") 
		{
		AfxMessageBox("∞¸∏Æ¿⁄ ¿Ãø‹ø°¥¬ «¡∑Œ±◊∑•¿ª ¡æ∑·«“ ºˆ æ¯Ω¿¥œ¥Ÿ.");
		return;
		}	
		*/
		//		CDlgPassword pw;	
		//		if (pw.DoModal() != IDOK)
		//			return;	

		int result = AfxMessageBox(IDS_IS_SAVE, MB_YESNOCANCEL);
		if (result == IDYES) {
			/* øÏº± ¿¸ø¯¿Ã ƒ—¿÷¡ˆ æ ¿∫¡ˆ »Æ¿Œ«œø© ¿©µµøÏ DESTROY */ 
			if (m_pPointerManager->GetDlgLaserControl() != NULL)
				m_pPointerManager->GetDlgLaserControl()->SendMessage(WM_DESTROY);
			/* ¿¸ø¯¿Ã ≤®¿÷¿ª ∞ÊøÏ∏∏ ¥Ÿø≠∑Œ±◊∏¶ ≥Œ∑Œ ¡ˆ¡§«‘ */

			CBeamEditor6Doc *pDoc;
			pDoc = (CBeamEditor6Doc*)GetActiveDocument();
			DWORD wndmsg;
			wndmsg = wndmsg & 0x00000000;
			wndmsg = BN_CLICKED << 8;
			wndmsg |= ID_MARK_FILE_SAVE;
			SendMessage(WM_COMMAND, wndmsg);
			//if (m_pPointerManager->GetDlgLaserControl() == NULL)
			{	
				CFrameWnd::OnSysCommand(nID, lParam);
			}
		}
		else if (result == IDNO) {

			if (m_pPointerManager->GetDlgLaserControl() != NULL)
				m_pPointerManager->GetDlgLaserControl()->SendMessage(WM_DESTROY);

			//if (m_pPointerManager->GetDlgLaserControl() == NULL)
			//{
			//CFrameWnd::OnSysCommand(nID, lParam);
			//}
			//else
			//CFrameWnd::OnSysCommand(nID, lParam);

			ExixProcessName("BeamEditor6.exe");


		}
		else if (result == IDCANCEL){
			;
		}
	}
}

void CMainFrame::OnBinSetting() 
{
	// TODO: Add your command handler code here
	/* ±««— ÆG «‘ «ÿ¡÷∞Ì */
	StdCmdCreator<CMDEditBin> pCmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&pCmd))
		return;

	CDlgBin DlgBin;
	DlgBin.DoModal();
}

void CMainFrame::OnSetFieldSize() 
{
	// TODO: Add your command handler code here
	/* ±««— ÆG «‘ «ÿ¡÷∞Ì */
	StdCmdCreator<CMDEditField> pCmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&pCmd))
		return;

	CUserCheckMng *pUserCheckMng = CUserCheckMng::Instance();
	if (pUserCheckMng->GetCurUserName() == "OPERATOR")
	{
		CMainFrame* pMainFrm = (CMainFrame*)AfxGetApp()->GetMainWnd();
		//pMainFrm->PostMessage(WM_HIDE_ALARM,ALARM_READY);
		pMainFrm->PostMessage(WM_SHOW_ERROR,ERROR_ADMIN);
		return;
	}

	CDlgFieldParameter DlgFieldParameter;
	DlgFieldParameter.DoModal();

	CPointerContainer::GetGraphView()->UpdateCuttingSizeView();

}

void CMainFrame::OnViewAlign() 
{
	// TODO: Add your command handler code here
	if (m_bShowAlign == TRUE) {
		m_bShowAlign = FALSE;
	}
	else {
		m_bShowAlign = TRUE;
	}
    ShowControlBar(&m_Tool[ALIGN], !m_bShowAlign, FALSE);
	
}

void CMainFrame::OnUpdateViewAlign(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	pCmdUI->SetCheck(!m_bShowAlign);
}

void CMainFrame::OnViewEdit() 
{
	// TODO: Add your command handler code here
	if (m_bShowEdit == TRUE) {
		m_bShowEdit = FALSE;
	}
	else {
		m_bShowEdit = TRUE;
	}
    ShowControlBar(&m_Tool[EDIT], !m_bShowEdit, FALSE);	
}


void CMainFrame::OnUpdateViewEdit(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	pCmdUI->SetCheck(!m_bShowEdit);	
}

void CMainFrame::OnViewHelp() 
{
	// TODO: Add your command handler code here
	if (m_bShowHelp == TRUE) {
		m_bShowHelp = FALSE;
	}
	else {
		m_bShowHelp = TRUE;
	}
    ShowControlBar(&m_Tool[HELP], !m_bShowHelp, FALSE);	
}

void CMainFrame::OnUpdateViewHelp(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	pCmdUI->SetCheck(!m_bShowHelp);
}

void CMainFrame::OnViewMarkorder() 
{
	// TODO: Add your command handler code here
	if (m_bShowMarkOrder == TRUE) {
		m_bShowMarkOrder = FALSE;
	}
	else {
		m_bShowMarkOrder = TRUE;
	}
    ShowControlBar(&m_Tool[MARKORDER], !m_bShowMarkOrder, FALSE);	
}

void CMainFrame::OnUpdateViewMarkorder(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	pCmdUI->SetCheck(!m_bShowMarkOrder);
}

void CMainFrame::OnViewStandard() 
{
	// TODO: Add your command handler code here
	if (m_bShowStandard == TRUE) {
		m_bShowStandard = FALSE;
	}
	else {
		m_bShowStandard = TRUE;
	}
    ShowControlBar(&m_Tool[STANDARD], !m_bShowStandard, FALSE);	
}

void CMainFrame::OnUpdateViewStandard(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	pCmdUI->SetCheck(!m_bShowStandard);	
}

void CMainFrame::OnEditParameter() 
{
	// TODO: Add your command handler code here
	CPointerManager *pPointerManager = pPointerManager->GetInstance();
	CMDEditPara *pCmd= new CMDEditPara;
	CUserCheckMng *pUserCheckMng = CUserCheckMng::Instance();
	if (pUserCheckMng->GetCurUserName() == "OPERATOR")
	{
		CMainFrame* pMainFrm = (CMainFrame*)AfxGetApp()->GetMainWnd();
		//pMainFrm->PostMessage(WM_HIDE_ALARM,ALARM_READY);
		pMainFrm->PostMessage(WM_SHOW_ERROR,ERROR_ADMIN);
		return;
	}
	else if (pUserCheckMng->GetCurUserName() == "ENGINEER")
	{
		if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
		{
			;
		}
	}
	else if (pUserCheckMng->GetCurUserName() == "ADMINISTRATOR")
	{
		if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
		{
			;
		}
	}
}

/* Parameter List∏¶ √ ±‚»≠ */
void CMainFrame::InitItemList()
{
	CPointerManager *pPointerManager = pPointerManager->GetInstance();
	CInitialTable *pInitialTable = pInitialTable->GetInstance();

	for (int i = 0; i < MAX_PARAMETER; i++) {
		//pPointerManager->GetParameterList()->Append(new CParameter(i, "noname", 10, 15, 35, 1, 300, 150, 10, 50, 70, 400, 300, 40, 100, 20, 500,10), 0);
		if (pInitialTable->GetLaser() == LASER_LASERVALL)
			pPointerManager->GetParameterList()->Append(new CParameter(i, "noname", 10, 15, 2, 1, 300, 150, 25, 400, 70, 250, 300, 40, 100, 20, 500, 20, 0, 0,
																					0 ,0 ,0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), 0);
		else if (pInitialTable->GetLaser() == LASER_SPIFIBER)
			pPointerManager->GetParameterList()->Append(new CParameter(i, "noname", 10, 15, 2, 1, 300, 150, 25, 200, 70, 250, 300, 40, 100, 20, 500, 20, 0, 0,
																					0 ,0 ,0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), 0);
		else
			pPointerManager->GetParameterList()->Append(new CParameter(i, "noname", 10, 15, 2, 1, 300, 150, 25, 50, 70, 250, 300, 40, 100, 20, 500, 20, 0, 0,
																					0 ,0 ,0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), 0);
	}
}

/* ∫–«“ ¿©µµøÏ ∏∏µÈ±‚ */
BOOL CMainFrame::OnCreateClient(LPCREATESTRUCT /*lpcs*/,
	CCreateContext* pContext)
{
//    m_sizeDrawWindow.cx = ::GetSystemMetrics(SM_CXFULLSCREEN) - 255 + 25;//228 + 25;//335;//325; 
//    m_sizeDrawWindow.cy = ::GetSystemMetrics(SM_CYFULLSCREEN) - 142 - 16; 
//	m_sizeDialogWindow.cx = 325;
//	m_sizeDialogWindow.cy = m_sizeDrawWindow.cy;
    
	//m_sizeDrawWindow.cx = ::GetSystemMetrics(SM_CXFULLSCREEN) - 295;//228 + 25;//335;//325; 
	m_sizeDrawWindow.cx = ::GetSystemMetrics(SM_CXFULLSCREEN) - 300;//228 + 25;//335;//325; 
    m_sizeDrawWindow.cy = ::GetSystemMetrics(SM_CYFULLSCREEN) - 300; 

	m_sizeDialogWindow.cx = GetSystemMetrics(SM_CXFULLSCREEN) + 100;
	m_sizeDialogWindow.cy = m_sizeDrawWindow.cy + 300;

	m_sizeDrawGraph.cx = m_sizeDrawWindow.cx;
	m_sizeDrawGraph.cy =  m_sizeDrawWindow.cy - 300;

	


	//m_sizeDrawWindow.cx = ::GetSystemMetrics(SM_CXFULLSCREEN) - 400;//228 + 25;//335;//325; 
 //   m_sizeDrawWindow.cy = ::GetSystemMetrics(SM_CYFULLSCREEN) - 300; 

	//m_sizeDialogWindow.cx = GetSystemMetrics(SM_CXFULLSCREEN) + 320;
	//m_sizeDialogWindow.cy = m_sizeDrawWindow.cy + 300;

	//m_sizeDrawGraph.cx = m_sizeDrawWindow.cx;
	//m_sizeDrawGraph.cy =  m_sizeDialogWindow.cy-300;


	// ∫–«“ ¿©µµøÏ∏¶ ∏∏µÁ¥Ÿ 
	VERIFY(m_wndSplitterHor.CreateStatic(this,1,2));

	if (!m_wndSplitterVer.CreateStatic(&m_wndSplitterHor, 2, 1, WS_CHILD | WS_VISIBLE | WS_BORDER, m_wndSplitterHor.IdFromRowCol(0, 0)))
	{
		TRACE0("Fail to create splitter.\n");
		return FALSE;
	}




	CRuntimeClass *ptr = RUNTIME_CLASS(CInformationView);


	VERIFY(m_wndSplitterVer.CreateView(0,0,RUNTIME_CLASS(CBeamEditor6View),m_sizeDrawWindow,pContext));
	VERIFY(m_wndSplitterVer.CreateView(1,0,RUNTIME_CLASS(CGraphView),CSize(m_sizeDrawGraph),pContext));
	VERIFY(m_wndSplitterHor.CreateView(0,1,RUNTIME_CLASS(CInformationView),m_sizeDialogWindow,pContext));


	CRect rect;
	GetClientRect(&rect);
	//m_wndSplitterVer.SetRowInfo(0, MulDiv(rect.Height(), 50, 100), 10);

	m_wndSplitterVer.SetRowInfo(0, m_sizeDrawWindow.cy-200, 10);
	m_wndSplitterHor.SetColumnInfo(0, m_sizeDrawWindow.cx, 10);

	/*m_wndSplitterVer.SetRowInfo(0, m_sizeDrawWindow.cy-200, 10);
	m_wndSplitterHor.SetColumnInfo(0, m_sizeDrawWindow.cx, 10);*/

	
	

	m_Context.m_pCurrentDoc		= pContext->m_pCurrentDoc;
	m_Context.m_pCurrentFrame	= pContext->m_pCurrentFrame;
	m_Context.m_pLastView		= pContext->m_pLastView;
	m_Context.m_pNewDocTemplate = pContext->m_pNewDocTemplate;
	m_Context.m_pNewViewClass	= pContext->m_pNewViewClass;

	return TRUE;
}

/* Laser Control ClassøÕ Dialog Class∏¶ ª˝º∫ or Get */
void CMainFrame::CreateLaserControl()
{
	CPointerManager *m_pPointerManager = m_pPointerManager->GetInstance();
	CInitialTable *pInitialTable = pInitialTable->GetInstance();
	CLaserControl *pLaserControl = m_pPointerManager->GetLaserControl();

	if (pInitialTable->GetKindOfLaser() == 3)
		return;

	if (pInitialTable->GetLaser() == LASER_NOUSE)
		return;

	

	if (m_pDlgLaserControl == NULL) {
		switch(pInitialTable->GetLaser()) {
		case LASER_SPECTRON:
			m_pDlgLaserControl = new CDlgSpectron;
			pLaserControl =new CSpectron(m_pDlgLaserControl);
			m_pPointerManager->CreateLaserControl(new CSpectron(m_pDlgLaserControl));
			m_pDlgLaserControl->Create(IDD_DLG_SPECTRON, NULL);
			m_pPointerManager->SetDlgLaserControl(m_pDlgLaserControl);
			break;
		case LASER_QUANTRONIX:
			m_pDlg.Create(IDD_DLG_QUANTRONIX,this);
			m_pDlgLaserControl = new CQuntronixDlg;
			m_pPointerManager->CreateLaserControl(new CQuantronix());
			m_pDlgLaserControl->Create(IDD_DLG_QUANTRONIX, NULL);
			m_pPointerManager->SetDlgLaserControl(m_pDlgLaserControl);	
			break;
		case LASER_HANAMIA:
			m_pDlgLaserControl = new  CHanaLaser_DLG;
			pLaserControl =new CHanaLaser(m_pDlgLaserControl);
			m_pPointerManager->CreateLaserControl(pLaserControl);
			m_pDlgLaserControl->Create(IDD_HANA_LASER_DLG, this);
			m_pPointerManager->SetDlgLaserControl(m_pDlgLaserControl);
			break;
		case LASER_LEE:
			m_pDlgLaserControl = new EOLASERCON;// (IDD_DLG_LASER_IO,this);
			pLaserControl =new CHanaLaser(m_pDlgLaserControl);
			m_pPointerManager->CreateLaserControl(pLaserControl);
			m_pDlgLaserControl->Create(IDD_DLG_LASER_IO, this);
			m_pPointerManager->SetDlgLaserControl(m_pDlgLaserControl);
			break;

		// 2007.02.13  
		case LASER_FIBER:	// IPG Fiber
			m_pDlgLaserControl = new CDlgFiber;
			pLaserControl = new CFiberLaser(m_pDlgLaserControl);
			m_pPointerManager->CreateLaserControl(pLaserControl);
			m_pDlgLaserControl->Create(IDD_DLG_FIBER, this);
			m_pPointerManager->SetDlgLaserControl(m_pDlgLaserControl);
			break;

		// 2011.04.04 syhun START - Laser control √ﬂ∞°
		//case LASER_LASERVALL:	// LaserVall
		//	m_pDlgLaserControl = new CDlgLaservallAD;
		//	m_pPointerManager->CreateLaserControl(pLaserControl);
		//	m_pDlgLaserControl->Create(IDD_DLG_LASERVALL, this);
		//	m_pPointerManager->SetDlgLaserControl(m_pDlgLaserControl);
		//	break;

		case LASER_SPIFIBER:	// SPIFIBER
//			m_pDlgLaserControl = new CDlgFiberSpi;
//			m_pPointerManager->CreateLaserControl(pLaserControl);
//			m_pDlgLaserControl->Create(IDD_DLG_FIBER_SPI, this);
//			m_pPointerManager->SetDlgLaserControl(m_pDlgLaserControl);
			break;

		case LASER_BICRONIX:	// BICRONIX
			m_pDlgLaserControl = new CDlgBicronixLaser;
			m_pPointerManager->CreateLaserControl(pLaserControl);
			m_pDlgLaserControl->Create(IDD_DLG_POWER, this);
			m_pPointerManager->SetDlgLaserControl(m_pDlgLaserControl);
			break;

		case LASER_JDSU:	// BICRONIX
			m_pDlgLaserControl = new CDlgLaserJDSU;
			m_pPointerManager->CreateLaserControl(pLaserControl);
			m_pDlgLaserControl->Create(IDD_DLG_JDSU, this);
			m_pPointerManager->SetDlgLaserControl(m_pDlgLaserControl);
			break;

		case LASER_PLASMA:	// PLASMA
			m_pDlgLaserControl = new CDlgBavarian;
			m_pPointerManager->CreateLaserControl(pLaserControl);
			m_pDlgLaserControl->Create(IDD_DLG_BAVARIAN, this);
			m_pPointerManager->SetDlgLaserControl(m_pDlgLaserControl);
			break;
		// syhun END.

		default:
			m_pPointerManager->SetDlgLaserControl(new CDlgSpectron());
			m_pDlgLaserControl = m_pPointerManager->GetDlgLaserControl();
			m_pPointerManager->CreateLaserControl(new CSpectron(m_pDlgLaserControl));
			m_pDlgLaserControl->Create(IDD_DLG_SPECTRON, this);
			break;
		}

	}

//	double m_dPower;
//	m_dPower = pInitialTable->GetDefaultLaserPower();
//	pLaserControl->CurrentControl(m_dPower);
	//CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	//pFieldParameter->SetSetedPowerValue(m_dPower);
}


void CMainFrame::CreateProgressBar()
{
	CPointerManager *m_pPointerManager = m_pPointerManager->GetInstance();
//	
//	m_pDlgProgress = new CDlgProgressBar;
//	m_pDlgProgress->Create(IDD_DLG_PROGRESSBAR, this);
//	m_pPointerManager->SetDlgProgressBar(m_pDlgProgress);
	m_pPointerManager->CreateDlgProgressbar(this);
}

void CMainFrame::OnFileSave()
{
	/* ±««— ÆG «‘ «ÿ¡÷∞Ì */
	StdCmdCreator<CMDMrkFileSave> pCmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run	(&pCmd))
		return;
	
//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
//	if(m_pDlgMark->m_hWnd  != NULL)	
//	{
//		if(m_pDlgMark->m_csTabMarking.m_AutoMarkFlag)
//			return;
//	}
	CWriteLog *log= NULL;;
	log->WriteString("OnFileSave()");
	
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	
	
	CString strFileName;
	CString filepath;
	CFile File;
	CMKFile *pMKFile;
	CString strErrMsg;
	BOOL m_SaveAsFlag = FALSE;

	strFileName = pDoc->m_CurfileName;
	TCHAR lpszName[256];
	TCHAR lpszExt[256];
	_splitpath((LPCTSTR)strFileName, NULL, NULL, lpszName, lpszExt);
	strFileName.Format("%s%s", lpszName, lpszExt);

	if(strFileName.Find(".mrk") < 0){
	   strFileName.Format("%s%s", lpszName, ".mrk");
	   m_SaveAsFlag = TRUE;
	   }

	
    CString strSaveFileName;
	CString SaveFile;
	CInitialTable *pInitialTable = pInitialTable->GetInstance();
	SaveFile = pInitialTable->GetSpecImgFolder();
	strSaveFileName.Format("%s\\Mrk\\%s",SaveFile, strFileName);
	strFileName = strSaveFileName;

//	strFileName = pDoc->m_CurfileName;	

	if(strFileName == _T("")) strFileName = "noname.mrk";
	if( strFileName.Find("noname.mrk") >=0  || m_SaveAsFlag == TRUE /*|| pDoc->m_ParaUpdate == TRUE */)
	{	// »≠¿œ ¿Ã∏ßø° noname ¿Ã ¿÷¿∏∏È
		// ªı∑ŒøÓ »≠¿œ∏Ì º≥¡§
		CFileDialog dlgfileopen(FALSE, "mrk", SaveFile+"\\Mrk\\"+"*.mrk", OFN_OVERWRITEPROMPT, "MK File (*.mrk)", NULL);
		if (dlgfileopen.DoModal() == IDOK)
		{
			strFileName = dlgfileopen.GetFileName();
		    pMKFile = CPointerContainer::GetMKFile();
			strSaveFileName.Format("%s\\Mrk\\%s",SaveFile, strFileName);
			pDoc->m_CurfileName = strFileName;
		if (  pMKFile->Save(strSaveFileName)  == R_FAILED)
			AfxMessageBox(IDS_MESSAGE25);
		} 
		pDoc->m_ParaUpdate = FALSE;
	}
	else
	{
	    pMKFile = CPointerContainer::GetMKFile();
		if (  pMKFile->Save(strFileName)  == R_FAILED)
			AfxMessageBox(IDS_MESSAGE25);
	}

	_splitpath((LPCTSTR)strFileName, NULL, NULL, lpszName, lpszExt);
	strFileName.Format("%s%s", lpszName, lpszExt);
	pDoc->m_CurfileName = strFileName;

	CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
	SetWindowText("KFlyCut-Cathode");
	//	SetWindowText(strFileName + _T("- Beam Editor 6.0 "));

	CDisplay *pDisp = CPointerContainer::GetDisplay();
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);

}

void CMainFrame::OnFileOpen()
{
	// TODO: Add your command handler code here
	/* ±««— ÆG «‘ «ÿ¡÷∞Ì */
	StdCmdCreator<CMDMrkFileOpen> pCmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&pCmd))
		return;

//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
//	if(m_pDlgMark->m_hWnd  != NULL)	
//	{
//		if(m_pDlgMark->m_csTabMarking.m_AutoMarkFlag)
//			return;
//		else
//			m_pDlgMark->SendMessage(WM_CLOSE, NULL);	
//	}
	CWriteLog *log= NULL;;
	log->WriteString("OnFileOpen()");
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp();
	
	CDocTemplate* pDocTemplate;
	POSITION pos;
	pos = pApp->GetFirstDocTemplatePosition();
	pDocTemplate = pApp->GetNextDocTemplate(pos);
	
	CFile File;
	CString strFileName;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	
	static char BASED_CODE szFilters[] = "MRK File(*.mrk)|*.mrk|prj file(*.prj)|*.prj|sem file(*.sem)|*.sem|All files(*.*)|*.*|";
//	static char BASED_CODE szFilters[] = "sem file(*.sem)|*.sem|MRK File(*.mrk)|*.mrk|prj file(*.prj)|*.prj|All files(*.*)|*.*|";
	CFilePath  *pFilePath = pFilePath->GetInstance();
	CString dirName = pFilePath->GetMarkFilePath();
	CString newName = "";
	CFileDialog fileDlg(TRUE, NULL, dirName, OFN_OVERWRITEPROMPT, szFilters, NULL);
	
	CString m_strFileTitle[RESULT_INFO_ROW_ITEM];
	CString m_strFileName[RESULT_INFO_ROW_ITEM];
	CFileFind finder;
	BOOL bWorking = finder.FindFile(pApp->m_strCwd + "\\mrk" + "\\" + "*.mrk");
	int nMaxRow = 0;
	while (bWorking)
	{
		bWorking = finder.FindNextFile();
		m_strFileTitle[nMaxRow] = finder.GetFilePath();
		m_strFileName[nMaxRow] = finder.GetFileName();
		nMaxRow++;
	}	
	/*if (IDOK == fileDlg.DoModal())
	{
		newName = fileDlg.GetPathName();
		strFileName=fileDlg.GetFileName();
	}
	else
	{
		strFileName= _T("noname");
		return ;
	}*/
	int iRow;
	iRow = CPointerContainer::GetInformationView()->m_nTapSelectIndex;
	newName = m_strFileTitle[iRow-1];
	strFileName = m_strFileName[iRow-1];

	GetView()->m_pUI->ChangeState(CUserNormalState::Instance());
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	
	CString strLog = "";
	if(newName == "")
		strLog.Format("File : %s", strFileName);
	else
		strLog.Format("File : %s", newName);
	//log->WriteString(strLog);

	pApp->OpenDocumentFile(newName); 
	pDoc->m_CurfileName = strFileName; 
	//SetWindowText(strFileName + _T("- Beam Editor 6.0 "));
	CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
	SetWindowText("KFlyCut-Cathode");
//	CMKObjectManager *pMng = CMKObjectManager::Instance();
	pMng->UnselectAll(); 

//	CMKList *pList;
//	pList = pMng->GetCompositeList();
//	POSITION pd = pList->GetHeadPosition();
//	CMKObject *pObject;
//	while (pd != NULL)
//	{
//		pObject = (CMKObject *)pList->GetNext(pd);
//		pObject->Refresh();
//	}

	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	CPointerContainer::GetInformationView()->UpdateInfo();
	
	Invalidate(FALSE);
	m_OrgScaleFlag = FALSE;
	OnScreenZoomOrg();

	//pFieldParameter->GetLotNo();
	
	pFieldParameter->SetLotNo("");

// 	if(pDoc->m_bDlgMarkFlag == TRUE)
// 		pFrame->ShowWindow(SW_HIDE);
}


void CMainFrame::OnChangeUserLevel() 
{
	// TODO: Add your command handler code here
/*	CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
	if (pUserCheckMng->GetCurUser() == NULL) {
		CUserCheck *pUser = new CUserCheck("OPERATOR", "", 0, sizeof(int));
		pUserCheckMng->SetCurrentUser(pUser);
		
		pUserCheckMng->AddUser(pUser);
		pUser = new CUserCheck("ENGINEER", "", 0, sizeof(int));
		pUserCheckMng->AddUser(pUser);
		pUser = new CUserCh§ƒeck("ADMINISTRATOR", "", 0, sizeof(int));
		pUserCheckMng->AddUser(pUser);
	}*/

	CDlgChangeLevel dlgChangeLevel;
	dlgChangeLevel.DoModal();

	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc * pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument();  
	CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
	SetWindowText("KFlyCut-Cathode");


}

void CMainFrame::OnChangePassword() 
{
	// TODO: Add your command handler code here
	CBeamEditor6App *pApp = (CBeamEditor6App*) AfxGetApp();
	CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
	if (pUserCheckMng->GetCurUserName() == "ADMINISTRATOR") {
	CDlgChangePWD dlgChangePWD;
	dlgChangePWD.DoModal();
	pUserCheckMng->Save(pApp->m_strCwd + "\\AUTHORITY.usr");	
	}
	else
	{
	AfxMessageBox(IDS_MESSAGE50);
	return;
	}
}


void CMainFrame::OnSetAuthority() 
{
	// TODO: Add your command handler code here
	/* ±««— ÆG «‘ «ÿ¡÷∞Ì */
	StdCmdCreator<CMDEditAuthority> pCmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&pCmd))
		return;

	CUserCheckMng *pUserCheckMng = CUserCheckMng::Instance();
	if (pUserCheckMng->GetCurUserName() == "OPERATOR")
	{
		CMainFrame* pMainFrm = (CMainFrame*)AfxGetApp()->GetMainWnd();
		//pMainFrm->PostMessage(WM_HIDE_ALARM,ALARM_READY);
		pMainFrm->PostMessage(WM_SHOW_ERROR,ERROR_ADMIN);
		return;
	}

	CDlgChangeAuthority	dlgChangeAuthority;
	dlgChangeAuthority.DoModal();

	BOOL m_flag = TRUE;
	StdCmdCreator<CMDTextEdit> p_Cmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&p_Cmd))
	{
	 m_flag = FALSE;
	}
	

	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	CPointerContainer::GetInformationView()->GetDlgItem(IDC_EDIT_TEXT)->EnableWindow(m_flag);
	CPointerContainer::GetInformationView()->GetDlgItem(IDC_TEXT_CHANGE)->EnableWindow(m_flag);
}

/* ¿”Ω√ String Test */
void CMainFrame::OnNewHpgl() 
{
	// TODO: Add your command handler code here
/*
		CObjectLogoCreateFactory LCF;
		CMKObject *pObject = LCF.Create();
		ASSERT(pObject != NULL);
		if( IDOK==pObject->DoModal() )
		{
			CPointerContainer::GetApproacher()->Add(pObject);
			CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		}
		else 
		{
			delete pObject;
		}
		Invalidate(FALSE);
	
*/
//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
//	if(m_pDlgMark->m_hWnd  != NULL)	
//	{
//		if(m_pDlgMark->m_csTabMarking.m_AutoMarkFlag)
//			return;
//	}

	StdCmdCreator<CMDCreateLogo> pCmd;
	if( R_FAILED!=CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		CDisplay *pDisp = CPointerContainer::GetDisplay();
		pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
		Invalidate(FALSE);

		CPointerContainer::GetGraphView()->UpdatePatternView();
	}

		
//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}


	//CDlgHpgl dlgHpgl;
	//dlgHpgl.DoModal();
}

void CMainFrame::OnEditDevice() 
{
	// TODO: Add your command handler code here
	CPointerManager *pPointerManager = pPointerManager->GetInstance();
	CDeviceManager *pDeviceManager = pDeviceManager->Instance();

	CMDEditDevice *pCmd= new CMDEditDevice;

	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CDisplay *pDisp = CPointerContainer::GetDisplay();
		pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
		Invalidate(FALSE);
	}

	/* ±««— ÆG «‘ «ÿ¡÷∞Ì */
/*	StdCmdCreator<CMDEditDevice> pCmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&pCmd))
		return;
*/
//	pDeviceManager->DoModal(uiGetResultCode);

}

void CMainFrame::OnNewArc()
{
	StdCmdCreator<CMDCreateArc> pCmd; //  ¡÷ºÆ √≥∏Æ  ¿·Ω√ ƒƒ∆ƒ¿œ¿ß«ÿ 
	if( TRUE==CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		Invalidate(FALSE);
	}
}

void CMainFrame::OnNewLine()
{
	StdCmdCreator<CMDCreateLine> pCmd; //  ¡÷ºÆ √≥∏Æ  ¿·Ω√ ƒƒ∆ƒ¿œ¿ß«ÿ 
	if( TRUE==CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		Invalidate(FALSE);
	}
}

void CMainFrame::OnNewText() 
{
	// TODO: Add your command handler code here


	/*CObjectTextCreateFactory TCF;	
	CMKObject *pObject = TCF.Create();
	ASSERT(pObject != NULL);
	if( IDOK==pObject->DoModal() )
	{
		CPointerContainer::GetApproacher()->Add(pObject);
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	}
	else 
	{
		delete pObject;
	}*/
//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
//	if(m_pDlgMark->m_hWnd  != NULL)	
//	{
//		if(m_pDlgMark->m_csTabMarking.m_AutoMarkFlag)
//			return;
//	}
	
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CMKObject *pObject;
	if(pMng->GetSelectedCount()>0)
	{
	  pObject = pMng->GetSelected();
	  if(pObject == NULL) return;
	  if(pObject->GetObjectType() !=  ID_TEXT_OBJECT)
		  return;
	}

	StdCmdCreator<CMDCreateText> pCmd;
	if( TRUE==CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		Invalidate(FALSE);
	}
}

void CMainFrame::OnEditObjFrame() 
{
	// TODO: Add your command handler code here
	/*
	StdCmdCreator<CMDEdit> pCmd;
	CPointerContainer::GetCommandManager()->Run(&pCmd);
	
	//CPointerContainer::GetDisplay()->RefreshView();
	
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	*/
	OnNewHpgl();
}

void CMainFrame::OnUndo() 
{
	// TODO: Add your command handler code here
	


	////////////////////////////////

	CPointerContainer::GetCommandManager()->Undo();

	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_ALL);
	CMKObjectManager::Instance()->UnselectAll();
	
	CMKObjectHandler::Instance()->Clear();
	GetView()->m_pUI->ChangeState(CUserNormalState::Instance() );
	CPointerContainer::GetInformationView()->UpdateInfo();

	GetView()->Invalidate(FALSE);

	/* ∏∏æ‡ø° ∏Ì∑…æÓ ¡æ∑˘∞° µπŸ¿ÃΩ∫ ¿Ã∏È ¿¸√º ∫Ø∞Ê¿Œµ• ¬¡ §—§—;; */
/*	CDisplay *pDisp = CPointerContainer::GetDisplay();
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	Invalidate(FALSE);*/
}

void CMainFrame::OnRedo() 
{
	// TODO: Add your command handler code here
	CPointerContainer::GetCommandManager()->Redo();

	
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_ALL);
	
	CMKObjectManager::Instance()->UnselectAll();

	CMKObjectHandler::Instance()->Clear();
	GetView()->m_pUI->ChangeState(CUserNormalState::Instance() );
	CPointerContainer::GetInformationView()->UpdateInfo();
	
	GetView()->Invalidate(FALSE);
	
}

void CMainFrame::OnUpdateUndo(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable( CPointerContainer::GetCommandManager()->IsUndoAble() );		
	}
	else 
		pCmdUI->Enable( CPointerContainer::GetCommandManager()->IsUndoAble() );
}

void CMainFrame::OnUpdateRedo(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			pCmdUI->Enable( CPointerContainer::GetCommandManager()->IsRedoAble() );
			
			CString strTest;
			m_Tool[EDIT].GetButtonText(ID_UNDO,strTest);
		}
	}
	else 
	{
		pCmdUI->Enable( CPointerContainer::GetCommandManager()->IsRedoAble() );
		
		CString strTest;
		m_Tool[EDIT].GetButtonText(ID_UNDO,strTest);
	}
}

CBeamEditor6View * CMainFrame::GetView()
{
	///////////////////////////////////////////////////////////
	POSITION pd;
	
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc * pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	pd = pDoc->GetFirstViewPosition();
	
	CBeamEditor6View *pView;
	pView = (CBeamEditor6View*) pDoc->GetNextView(pd);
	
	return pView;
//////////////////////////////////////////////////////////////////////	
	
}

void CMainFrame::OnEditCopy() 
{
	// TODO: Add your command handler code here
	
}

void CMainFrame::OnObjCopyFrame() 
{
	// TODO: Add your command handler code here
	CMDCopyAll *pCmd = new CMDCopyAll;
	//pCmd->SetCopyPosition(0,0);

	CPointerContainer::GetCommandManager()->Run(pCmd);
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
}

void CMainFrame::OnAlignBottom() 
{
	// TODO: Add your command handler code here
	CMDAlignBottomAll *pCmd= new CMDAlignBottomAll;

	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}

//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
/*	CMDAlignBottom *pCmd;
	CMDCompositor *pCmdComp = new CMDCompositor;
	CMKObjectManager *pObjMng = CMKObjectManager::Instance();
	CMKList *pMKList = pObjMng->GetSelectedList(); // º±≈√µ» ø¿∫Í¡ß∆Æ ∏ÆΩ∫∆Æ∏¶ πﬁæ∆ø¬¥Ÿ.
	CMKObject *pMKObject;

	POSITION pd;

	pd = pMKList->GetHeadPosition();
	while( pd ) 
	{
		pMKObject = (CMKObject *)pMKList->GetNext(pd); 
		pCmd = new CMDAlignBottom;
		pCmd->SetObject(pMKObject); //AlignBottom∏Ì∑…¿Ã ºˆ«‡«“ ø¿∫Í¡ß∆Æ∏¶ º≥¡§«—¥Ÿ.
		pCmdComp->Add(pCmd);        //CommandCompositorø° √ﬂ∞°«—¥Ÿ
	}
	pCmdComp->SetCMDMsg("Align Bottom"); //≥™¡ﬂø° ªÁøÎµ… º≥∏Ì πÆ±∏∏¶ º¬∆√«—¥Ÿ
	CPointerContainer::GetCommandManager()->Run(pCmdComp);
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);

	delete pMKList;*/
}

void CMainFrame::OnAlignTop() 
{
	// TODO: Add your command handler code here
	CMDAlignTopAll *pCmd= new CMDAlignTopAll;

	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}

//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
/*	CMDAlignTop *pCmd;
	CMDCompositor *pCmdComp = new CMDCompositor;
	CMKObjectManager *pObjMng = CMKObjectManager::Instance();
	CMKList *pMKList = pObjMng->GetSelectedList(); // º±≈√µ» ø¿∫Í¡ß∆Æ ∏ÆΩ∫∆Æ∏¶ πﬁæ∆ø¬¥Ÿ.
	CMKObject *pMKObject;
	
	POSITION pd;
	
	pd = pMKList->GetHeadPosition();
	while( pd ) 
	{
		pMKObject = (CMKObject *)pMKList->GetNext(pd); 
		pCmd = new CMDAlignTop;
		pCmd->SetObject(pMKObject); //AlignBottom∏Ì∑…¿Ã ºˆ«‡«“ ø¿∫Í¡ß∆Æ∏¶ º≥¡§«—¥Ÿ.
		pCmdComp->Add(pCmd);        //CommandCompositorø° √ﬂ∞°«—¥Ÿ
	}
	pCmdComp->SetCMDMsg("Align Top"); //≥™¡ﬂø° ªÁøÎµ… º≥∏Ì πÆ±∏∏¶ º¬∆√«—¥Ÿ
	CPointerContainer::GetCommandManager()->Run(pCmdComp);
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	

	delete pMKList;*/
}

void CMainFrame::OnAlignRight() 
{
	// TODO: Add your command handler code here
	CMDAlignRightAll *pCmd= new CMDAlignRightAll;

	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}

	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
/*	CMDAlignRight *pCmd;
	CMDCompositor *pCmdComp = new CMDCompositor;
	CMKObjectManager *pObjMng = CMKObjectManager::Instance();
	CMKList *pMKList = pObjMng->GetSelectedList(); // º±≈√µ» ø¿∫Í¡ß∆Æ ∏ÆΩ∫∆Æ∏¶ πﬁæ∆ø¬¥Ÿ.
	CMKObject *pMKObject;
	
	POSITION pd;
	
	pd = pMKList->GetHeadPosition();
	while( pd ) 
	{
		pMKObject = (CMKObject *)pMKList->GetNext(pd); 
		pCmd = new CMDAlignRight;
		pCmd->SetObject(pMKObject); //AlignBottom∏Ì∑…¿Ã ºˆ«‡«“ ø¿∫Í¡ß∆Æ∏¶ º≥¡§«—¥Ÿ.
		pCmdComp->Add(pCmd);        //CommandCompositorø° √ﬂ∞°«—¥Ÿ
	}
	pCmdComp->SetCMDMsg("Align Right"); //≥™¡ﬂø° ªÁøÎµ… º≥∏Ì πÆ±∏∏¶ º¬∆√«—¥Ÿ
	CPointerContainer::GetCommandManager()->Run(pCmdComp);
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	delete pMKList;*/
}

void CMainFrame::OnAlignLeft() 
{
	// TODO: Add your command handler code here
	CMDAlignLeftAll *pCmd= new CMDAlignLeftAll;

	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}

	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
	if(m_pDlgMark->m_hWnd  != NULL)
	{
			m_pDlgMark->m_ctMarkPreview.SetTapPosionApply(FALSE);
			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
			m_pDlgMark->m_ctMarkPreview.Invalidate();
	}
/*	CMDAlignLeft *pCmd;
	CMDCompositor *pCmdComp = new CMDCompositor;
	CMKObjectManager *pObjMng = CMKObjectManager::Instance();
	CMKList *pMKList = pObjMng->GetSelectedList(); // º±≈√µ» ø¿∫Í¡ß∆Æ ∏ÆΩ∫∆Æ∏¶ πﬁæ∆ø¬¥Ÿ.
	CMKObject *pMKObject;
	
	POSITION pd;
	
	pd = pMKList->GetHeadPosition();
	while( pd ) 
	{
		pMKObject = (CMKObject *)pMKList->GetNext(pd); 
		pCmd = new CMDAlignLeft;
		pCmd->SetObject(pMKObject); //AlignBottom∏Ì∑…¿Ã ºˆ«‡«“ ø¿∫Í¡ß∆Æ∏¶ º≥¡§«—¥Ÿ.
		pCmdComp->Add(pCmd);        //CommandCompositorø° √ﬂ∞°«—¥Ÿ
	}
	pCmdComp->SetCMDMsg("Align Left"); //≥™¡ﬂø° ªÁøÎµ… º≥∏Ì πÆ±∏∏¶ º¬∆√«—¥Ÿ
	CPointerContainer::GetCommandManager()->Run(pCmdComp);
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	delete pMKList;*/
}

void CMainFrame::OnObjEraseFrame() 
{
	// TODO: Add your command handler code here
	CMDDeleteAll *pCmd = new CMDDeleteAll;

	
	CPointerContainer::GetCommandManager()->Run(pCmd);
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	GetView()->m_pUI->ChangeState(CUserNormalState::Instance());
}

void CMainFrame::OnSelectAll() 
{/*

	CMDGroupObject *pCmd = new CMDGroupObject;

	CPointerContainer::GetCommandManager()->Run(pCmd);

	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	return;
	*/
	
	CMKList *pList;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CMKObject *pObject;
//	pMng->GetAllList();
	pList = pMng->GetSelectedList();
	POSITION pd = pList->GetHeadPosition();
	if(pd == NULL) return;
	if (pList->GetCount() < 2) return;
	pObject = (CMKObject *)pList->GetNext(pd);

	double dAngle;
	dAngle = pObject->GetAngle(); 


//	if(pObject->GetObjectType() == ID_COMPOSITE_OBJECT) return;
//
//	while (pd)
//	{
//		pObject = (CMKObject *)pList->GetNext(pd);
//		if(pObject->GetObjectType() == ID_COMPOSITE_OBJECT) return;
//	}

	
	CMDGroupObject *pCmd = new CMDGroupObject;
//	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CPointerContainer::GetCommandManager()->Run(pCmd);

	pMng->SelectAll(); 
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);


	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	pDoc->m_GroupFlag = TRUE;
		/*
	/////
	pMng->SelectAll(); 
	
	CMKList *pList;
	CMKObject *pObject;
	pMng->GetAllList();
	pList = pMng->GetSelectedList();
	POSITION pd = pList->GetHeadPosition();
	if(pd == NULL) return;
	pObject = (CMKObject *)pList->GetNext(pd);

	double dAngle;
	dAngle = pObject->GetAngle(); 
	pFieldParameter->SetGroupFlag(TRUE);
	pDoc->m_GroupFlag = TRUE;
	if(pObject->GetObjectType() == ID_COMPOSITE_OBJECT) return;

	int iPos=0;
	CMKObjectApproacher *pMKObjectApproacher = CPointerContainer::GetApproacher();
	pObject = pMKObjectApproacher->GetFirst(iPos);
	double m_dAngle_Cmp, m_objAngle;
	BOOL m_SameAngleCheck = TRUE;
	m_dAngle_Cmp = pObject->GetAngle(); 
	pFieldParameter->SetGroupSameAngle(TRUE); 
	while(pObject != NULL)
	{
		m_objAngle = pObject->GetAngle(); 
		if(m_objAngle != m_dAngle_Cmp || pObject->GetLock() == TRUE )
		{
			if(pObject->GetLock() == TRUE){
				AfxMessageBox("Release Lock Object.");
			return; // ∞¢µµ¥¬ ∞∞∞‘..
			}
			//if(m_objAngle - m_dAngle_Cmp != 180 || m_dAngle_Cmp -m_objAngle != 180 )
			{
			m_SameAngleCheck = FALSE;
			pFieldParameter->SetGroupSameAngle(FALSE);
			}
		}
		pObject = pMKObjectApproacher->GetNext(iPos);
		
		
	}

	
	/////

	
	CMDGroupObject *pCmd = new CMDGroupObject;
	pFieldParameter->SetSelectAllFlag(TRUE); 

	CPointerContainer::GetCommandManager()->Run(pCmd);
	
	if(m_SameAngleCheck == TRUE)
	{
		if(dAngle >=360) dAngle = dAngle - 360;
		if(dAngle == 90 || dAngle == 270)
		{
			pMng->SelectAll(); 
			if(dAngle == 270)
				CPointerContainer::GetInformationView()->OnGroupRotation(1);
			else 
				CPointerContainer::GetInformationView()->OnGroupRotation(3);
			
			UnSellectInit();
			OnGroupAll();
			pMng->SelectAll();
			
			if(dAngle == 270)
				CPointerContainer::GetInformationView()->OnGroupRotation(3);
			else
				CPointerContainer::GetInformationView()->OnGroupRotation(1);
			
			POSITION pd =NULL;
			CPointerContainer::GetCommandManager()->RemoveAt(pd);
		}
		else 
		{
			pMng->SelectAll(); 
			if(dAngle == 0)
				CPointerContainer::GetInformationView()->OnGroupRotation(0);
			else 
				CPointerContainer::GetInformationView()->OnGroupRotation(2);
			
			UnSellectInit();
			OnGroupAll();
			pMng->SelectAll();
			
			if(dAngle == 180)
				CPointerContainer::GetInformationView()->OnGroupRotation(2);
			else
				CPointerContainer::GetInformationView()->OnGroupRotation(0);
			
			POSITION pd =NULL;
			CPointerContainer::GetCommandManager()->RemoveAt(pd);
		}
	}
	


	
	pMng->SelectAll(); 
	pObject = pMng->GetSelected();
	pMng->SetRealSelected(pObject);
	CMKObjectHandler *pHandler =  CMKObjectHandler::Instance();
	pHandler->SetObject(pObject);

	
	
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	CPointerContainer::GetInformationView()->UpdateInfo();
	*/
	
	
}

void CMainFrame::OnUnselectAllFrame() 
{
	// TODO: Add your command handler code here
	
	/*// TODO: Add your command handler code here
	CMDReleaseObject *pCmd = new CMDReleaseObject;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CMKObjectHandler *pHandler  = CMKObjectHandler::Instance();
	pCmd->SetReleaseObject(pMng->GetSelected() );
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 

	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		pHandler->Clear(); 
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
	}
	pDoc->m_GroupFlag = FALSE;

	
	*/
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CMDReleaseObject *pCmd = new CMDReleaseObject;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	pFieldParameter->SetSelectAllFlag(FALSE);
	CMKObjectHandler *pHandler  = CMKObjectHandler::Instance();
	pFieldParameter->SetGroupFlag(FALSE);

	CMKList *pList;
	CMKObject *pObject;
//	pMng->GetAllList();
//	pMng->SelectAll(); 
	pList = pMng->GetSelectedList();

	
	
	pCmd->SetReleaseObject(pMng->GetSelected() );
	
	POSITION pd = pList->GetHeadPosition();
	if(pd == NULL ) return;
	pObject = (CMKObject *)pList->GetNext(pd);
	double dAngle = pObject->GetAngle();
	
	if(pFieldParameter->GetGroupSameAngle() == TRUE && pObject->GetObjectType() == ID_COMPOSITE_OBJECT)
	{
		if(dAngle ==  0)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(0);
		}
		if(dAngle ==  180)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(180);
		}
		if(dAngle ==  90)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(90);
		}
		if(dAngle ==  270)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(270);
		}
	}
	pMng->UnselectAll(); 
	if(pObject->GetObjectType() == ID_COMPOSITE_OBJECT && pObject->GetLock() == TRUE) 
		pObject->SetLock(FALSE); 
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
		OnUndo();  //π´æ∞° ≤ø¿Œ∞Õ∞∞æ∆º≠ ¿”Ω√πÊ∆Ì¿∏∑Œ §–.§– 
		OnRedo();
	
	}
//	if(pFieldParameter->GetGroupSameAngle() == TRUE && pObject->GetObjectType() == ID_COMPOSITE_OBJECT)
//	{
//		if(dAngle ==  0)
//		{
//			CPointerContainer::GetInformationView()->OnGroupRotation(0);
//		}
//		if(dAngle ==  180)
//		{
//			CPointerContainer::GetInformationView()->OnGroupRotation(180);
//		}
//		if(dAngle ==  90)
//		{
//			CPointerContainer::GetInformationView()->OnGroupRotation(90);
//		}
//		if(dAngle ==  270)
//		{
//			CPointerContainer::GetInformationView()->OnGroupRotation(270);
//		}
//	}
	pDoc->m_GroupFlag = FALSE;

}

void CMainFrame::OnOrderUp() 
{
	// TODO: Add your command handler code here
	CMDOrderUp *pCmd = new CMDOrderUp;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CMKObject *pObject = pMng->GetSelected();
	pCmd->SetObject(pObject);
	
	CPointerContainer::GetCommandManager()->Run(pCmd);
	CPointerContainer::GetInformationView()->UpdateInfo();
}

void CMainFrame::OnOrderDown() 
{
	// TODO: Add your command handler code here
	CMDOrderDown *pCmd = new CMDOrderDown;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CMKObject *pObject = pMng->GetSelected();
	pCmd->SetObject(pObject);
	
	CPointerContainer::GetCommandManager()->Run(pCmd);
	CPointerContainer::GetInformationView()->UpdateInfo();
}

void CMainFrame::OnAlignHcenter() 
{
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	pMng->SelectAll(); 


	CMDAlignHorizontalCenterAll *pCmd= new CMDAlignHorizontalCenterAll;

	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}

	UnSellectAllFrame();

//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
}

void CMainFrame::OnAlignVcenter() 
{
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	pMng->SelectAll(); 
	// TODO: Add your command handler code here
	CMDAlignVerticalCenterAll *pCmd= new CMDAlignVerticalCenterAll;
	
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}

	UnSellectAllFrame();
//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
}

BOOL CMainFrame::PreTranslateMessage(MSG* pMsg) 
{
	// TODO: Add your specialized code here and/or call the base class

	return CFrameWnd::PreTranslateMessage(pMsg);
}

void CMainFrame::OnAlignObjLeft() 
{
	// TODO: Add your command handler code here

	CMKObjectManager *pMng = CMKObjectManager::Instance();
	pMng->SelectAll(); 

	CMDAlignLeftSame *pCmd = new CMDAlignLeftSame;
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}

	UnSellectAllFrame();

//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
}

void CMainFrame::OnAlighObjTop() 
{

	CMKObjectManager *pMng = CMKObjectManager::Instance();
	pMng->SelectAll(); 
	// TODO: Add your command handler code here
	CMDAlignUpSame *pCmd = new CMDAlignUpSame;
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}

	UnSellectAllFrame();
//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
}

void CMainFrame::OnAlignObjBottom() 
{

	CMKObjectManager *pMng = CMKObjectManager::Instance();
	pMng->SelectAll(); 
	// TODO: Add your command handler code here
	CMDAlignDownSame *pCmd = new CMDAlignDownSame;
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}


	UnSellectAllFrame();
//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
}

void CMainFrame::OnAlignObjRight() 
{

	CMKObjectManager *pMng = CMKObjectManager::Instance();
	pMng->SelectAll(); 

	// TODO: Add your command handler code here
	CMDAlignRightSame *pCmd = new CMDAlignRightSame;
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}



//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
}

void CMainFrame::OnSameWidth() 
{
	// TODO: Add your command handler code here
	CMDAlignSameWidth *pCmd = new CMDAlignSameWidth;
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
	}
}

void CMainFrame::OnSameHeight() 
{
	// TODO: Add your command handler code here
	CMDAlignSameHeight *pCmd = new CMDAlignSameHeight;
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
	}
}

void CMainFrame::OnSameBoth() 
{
	// TODO: Add your command handler code here
	CMDAlignSameBoth *pCmd = new CMDAlignSameBoth;
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
	}
}


void CMainFrame::OnOrderFirst() 
{
	// TODO: Add your command handler code here
	CMDOrderFirst *pCmd = new CMDOrderFirst;
	CPointerContainer::GetCommandManager()->Run(pCmd);
	CPointerContainer::GetInformationView()->UpdateInfo();
}

void CMainFrame::OnOrderLast() 
{
	// TODO: Add your command handler code here
	CMDOrderLast *pCmd = new CMDOrderLast;
	CPointerContainer::GetCommandManager()->Run(pCmd);
	CPointerContainer::GetInformationView()->UpdateInfo();
}

void CMainFrame::OnNewImg() 
{
	// TODO: Add your command handler code here

	/*CObjectImageCreateFactory LCF;
	CMKObject *pObject = LCF.Create();
	ASSERT(pObject != NULL);
	if( IDOK==pObject->DoModal() )
	{
		CPointerContainer::GetApproacher()->Add(pObject);
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	}
	else 
	{
		delete pObject;
	}*/

	StdCmdCreator<CMDCreateImage> pCmd;
	if( R_DEFAULT==CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		
		GetView()->Invalidate(FALSE);
	}

	
}

void CMainFrame::OnNewBar() 
{
	// TODO: Add your command handler code here
//CDlgBar Dlg;
//	Dlg.DoModal();

/*	CObjectBarcodeCreateFactory BCF;
	CMKObject *pObject = BCF.Create();
	ASSERT(pObject != NULL);
	if( IDOK==pObject->DoModal())
	{
		CPointerContainer::GetApproacher()->Add(pObject);
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	}
	else 
	{
		delete pObject;
	}
	Invalidate(FALSE);*/

	StdCmdCreator<CMDCreateBarcode> pCmd;
	if( R_DEFAULT==CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		
		GetView()->Invalidate(FALSE);
	}
	
}

void CMainFrame::OnObjectFix() 
{
	// TODO: Add your command handler code here


	CMKObjectManager *pMng = CMKObjectManager::Instance();

	

	CMKObject *pMKObject;
	
	pMKObject = pMng->GetSelected(); 
	if(pMKObject == NULL) return;
	
	if(pMKObject->GetObjectType() == ID_COMPOSITE_OBJECT && pMKObject->GetLock() == TRUE){
		pMKObject->SetLock(FALSE); 
	  return;
	}
	
	

	StdCmdCreator<CMDObjectFix> pCmd;
	if( R_DEFAULT==CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
	}

}

void CMainFrame::OnMainZoomIn2() 
{
	
	CDisplay *pDisp = CPointerContainer::GetDisplay();
	//pDisp->SetScreenZoom(pDisp->GetScreenZoom() * 1.1 );
	pDisp->ZoomIn();
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);

}

void CMainFrame::OnMainZoomOut() 
{
	
	CDisplay *pDisp = CPointerContainer::GetDisplay();

//	pDisp->ZoomOut();
	pDisp->SetScreenZoom(pDisp->GetScreenZoom() / 1.1 );
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);
	
}

void CMainFrame::OnScreenZoomOrg() 
{
	// TODO: Add your command handler code here
	//2018.08.09 ø¯∑°∞Õ ø¯ªÛ∫π±Õ
	//-------------------- «—ƒ®ø° «•«ˆ«œ¥¬ πÊΩƒ ºˆ¡§ 2004.10.25 ¡§¡æº∑
	/*
	CDisplay *pDisp = CPointerContainer::GetDisplay();
	CPointerManager *pPointerManager = pPointerManager->GetInstance();
	CDeviceManager *pDeviceManager = pDeviceManager->Instance();

	CRect client_rect;
	GetView()->GetClientRect(&client_rect);
	double tempzoom;
	tempzoom = (pDeviceManager->GetDevWidth() > pDeviceManager->GetDevHeight()) ? pDeviceManager->GetDevWidth():pDeviceManager->GetDevHeight();
	double screenzoom;
	screenzoom = 1 / (tempzoom /( client_rect.right /2 ));
	pDisp->SetScreenZoom(screenzoom) ;

	if(m_OrgScaleFlag == TRUE){
	pDisp->OriginalScale();
	m_OrgScaleFlag = FALSE;
	}
	else
	m_OrgScaleFlag = TRUE;
	

    pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
    GetView()->Invalidate(FALSE);
	*/


	CDisplay *pDisp = CPointerContainer::GetDisplay();
	pDisp->OriginalScale();
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);
}

void CMainFrame::OnSelectZoom() 
{
	// TODO: Add your command handler code here
	// ªÛ≈¬∏¶ ºø ¡‹¿∏∑Œ πŸ≤Ÿ±‚
	GetView()->m_pUI->ChangeState(CUserSelectZoomState::Instance());

/*	if (pView->m_iMode != SELECT_ZOOM) {
		pView->m_bSelectZoomDown = FALSE;
		pView->m_iMode = SELECT_ZOOM;	
	}
	else
		pView->m_iMode = NORMAL;*/
}

void CMainFrame::OnScreenZoomOrgFrame() 
{
	// TODO: Add your command handler code here
	CDisplay *pDisp = CPointerContainer::GetDisplay();
	pDisp->OriginalScale();
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);
}

void CMainFrame::OnUpdateEditParameter(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnFileNew() 
{
	// TODO: Add your command handler code here
	
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
//	if(m_pDlgMark->m_hWnd  != NULL)	
//	{
//		if(m_pDlgMark->m_csTabMarking.m_AutoMarkFlag)
//			return;
//	}

	StdCmdCreator<CMDFileNew> pCmd;
	
	CPointerContainer::GetCommandManager()->Run(&pCmd);
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	pMng->ClearAll();
	CPointerContainer::GetCommandManager()->RemoveAll();
	

	CMKObjectManager::Instance()->UnselectAll();
	CMKObjectHandler::Instance()->Clear();


	
	CDisplay *pDisp = CPointerContainer::GetDisplay();
	CString strFileName = _T("noname.mrk");
	
	//SetWindowText(strFileName + _T("- Beam Editor 6.0 "));
	CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
	SetWindowText("KFlyCut-Cathode");
	
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	pDoc->m_CurfileName = strFileName; 
	pDoc->m_SemName = ""; 

	// 2007.12.06  
	pDoc->m_MrkInfoDisp = "";
	pDoc->m_SemName = "";
	
	CPointerContainer::GetInformationView()->SetDlgItemText(IDC_STATIC_MRKINFO, "");

	GetView()->m_pUI->ChangeState(CUserNormalState::Instance() );
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	CPointerContainer::GetCommandManager()->RemoveAll();
	GetView()->Invalidate(FALSE);
//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
	if(m_pDlgMark->m_hWnd != NULL)	
	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
			m_pDlgMark->m_ctMarkPreview.SetTapPosionApply(false);
			m_pDlgMark->m_ctMarkPreview.Invalidate();	
	}

}

void CMainFrame::On2dbarcode() 
{
	// TODO: Add your command handler code here
	//CDlgSerial Dlg;
	//Dlg.DoModal();
	StdCmdCreator<CMDCreateDataMatrix> pCmd;
	if( R_DEFAULT==CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		Invalidate(FALSE);
	}
}

CStatusBar *CMainFrame::GetStatusBar()
{
	return &m_wndStatusBar;
}


BOOL CMainFrame::OnSetCursor(CWnd* pWnd, UINT nHitTest, UINT message) 
{
	// TODO: Add your message handler code here and/or call default
//	if (nHitTest == ID_UNDO)
//		AfxMessageBox("12");

	return CFrameWnd::OnSetCursor(pWnd, nHitTest, message);
}

void CMainFrame::OnUpdateObjectFix(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			CMKObjectManager *pMng = CMKObjectManager::Instance();
			CMKObject *pObject = pMng->GetSelected();
			
			if (pObject != NULL)
			{
				BOOL check = pObject->GetLock();
				if (check == TRUE || check == FALSE)
				{
					pCmdUI->SetCheck(pObject->GetLock());
				}
			}
		}
	}
	else 
	{
		CMKObjectManager *pMng = CMKObjectManager::Instance();
		CMKObject *pObject = pMng->GetSelected();
		
		if (pObject != NULL)
		{
			BOOL check = pObject->GetLock();
			if (check == TRUE || check == FALSE)
			{
				pCmdUI->SetCheck(pObject->GetLock());
			}
		}
	}
}

void CMainFrame::OnUpdateAlignObjBottom(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}
}

void CMainFrame::OnUpdateAlignObjLeft(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);	
	}
}

void CMainFrame::OnUpdateAlignObjRight(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);	
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);	
	}
}

void CMainFrame::OnUpdateAlignObjTop(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}
}

void CMainFrame::OnUpdateSameBoth(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}
}

void CMainFrame::OnUpdateSameHeight(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);	
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);	
	}
}

void CMainFrame::OnUpdateSameWidth(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 2)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}	
}

void CMainFrame::OnUpdateAlignBottom(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}
}

void CMainFrame::OnUpdateAlignHcenter(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}
}

void CMainFrame::OnUpdateAlignRight(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}
}

void CMainFrame::OnUpdateAlignLeft(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}
}

void CMainFrame::OnUpdateAlignTop(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}
}

void CMainFrame::OnUpdateAlignVcenter(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}	
}

void CMainFrame::OnUpdateOrderUp(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}		
}

void CMainFrame::OnUpdateOrderLast(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}		
}

void CMainFrame::OnUpdateOrderFirst(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
				pCmdUI->Enable(TRUE);
			else 
				pCmdUI->Enable(FALSE);
		}
	}
	else 
	{
		if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
			pCmdUI->Enable(TRUE);
		else 
			pCmdUI->Enable(FALSE);
	}		
}

void CMainFrame::OnUpdateOrderDown(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
	{
	}

	if( CMKObjectManager::Instance()->GetSelectedCount() >= 1)
		pCmdUI->Enable(TRUE);
	else 
		pCmdUI->Enable(FALSE);			
}

void CMainFrame::OnFileSaveAs() 
{
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument();
	StdCmdCreator<CMDMrkFileSave> pCmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&pCmd))
		return;

	CWriteLog *log= NULL;;
	log->WriteString("OnFileSaveAs()");

	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(m_pDlgMark->m_csTabMarking.m_AutoMarkFlag)
			return;
	}

	CString strFileName;
	CString filepath;
	CFile File;
	CMKFile *pMKFile;
	CString strErrMsg;

	CString strSaveFileName;
	CString SaveFile;
	CInitialTable *pInitialTable = pInitialTable->GetInstance();
	SaveFile = pInitialTable->GetSpecImgFolder();
	strSaveFileName.Format("%s\\Mrk\\%s",SaveFile, strFileName);
	strFileName = strSaveFileName;

	CFileDialog dlgfileopen(FALSE, "mrk", SaveFile+"\\Mrk\\"+"*.mrk", OFN_OVERWRITEPROMPT, "MK File (*.mrk)", NULL);
	if (dlgfileopen.DoModal() == IDOK)
	{
		strFileName = dlgfileopen.GetFileName();
		strSaveFileName.Format("%s\\Mrk\\%s",SaveFile, strFileName);
		pMKFile = CPointerContainer::GetMKFile();
		pDoc->m_CurfileName = strFileName; 
		if (  pMKFile->Save(strSaveFileName)  == R_FAILED)
			AfxMessageBox(IDS_MESSAGE25);
	}
    pDoc->m_CurfileName = strFileName; 

	//SetWindowText(strFileName + _T("- Beam Editor 6.0 "));
	CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
	SetWindowText("KFlyCut-Cathode");
	CDisplay *pDisp = CPointerContainer::GetDisplay();
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);
}

void CMainFrame::OnViewGrid() 
{
	// TODO: Add your command handler code here
	CDisplay *pDisp;
	CDisplayObject *pDispObj;
	
	pDisp = CPointerContainer::GetDisplay();
	if( pDisp != NULL)
	{
		pDispObj = pDisp->Find(BG_GRID);
		if( pDispObj != NULL)
		{
			BOOL bRes =(pDispObj->GetEnable());
			pDispObj->SetEnable( !bRes );
			CInitialTable::GetInstance()->SetViewGrid(!bRes);
		}
	}
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);

}

void CMainFrame::OnUpdateViewGrid(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			CDisplayObject *pDispObj;
			pDispObj = CPointerContainer::GetDisplay()->Find(BG_GRID);
			if( pDispObj != NULL)
			{
				
				pCmdUI->SetCheck(pDispObj->GetEnable());
			}
		}
	}
	else 
	{
		CDisplayObject *pDispObj;
		pDispObj = CPointerContainer::GetDisplay()->Find(BG_GRID);
		if( pDispObj != NULL)
		{
		
			pCmdUI->SetCheck(pDispObj->GetEnable());
		}
	}
}

void CMainFrame::OnViewRuler() 
{
	// TODO: Add your command handler code here
	CDisplay *pDisp;
	CDisplayObject *pDispObj;
	
	pDisp = CPointerContainer::GetDisplay();
	if( pDisp != NULL)
	{
		pDispObj = pDisp->Find(FG_RULER);
		if( pDispObj != NULL)
		{
			BOOL bRes;
			
			bRes = pDispObj->GetEnable();
			pDispObj->SetEnable( !bRes );
			CInitialTable::GetInstance()->SetViewRuler(!bRes);
			if( !bRes )
				pDisp->SetShiftScreen(RULER_SIZE, RULER_SIZE);
			else
				pDisp->SetShiftScreen(0,0);
		
			pDisp->RefreshScreenRegion();
			

			
		}
	}
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);

}

void CMainFrame::OnUpdateViewRuler(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			CDisplayObject *pDispObj;
			pDispObj = CPointerContainer::GetDisplay()->Find(FG_RULER);
			if( pDispObj != NULL)
				pCmdUI->SetCheck(pDispObj->GetEnable());
		}
	}
	else 
	{
		CDisplayObject *pDispObj;
		pDispObj = CPointerContainer::GetDisplay()->Find(FG_RULER);
		if( pDispObj != NULL)
			pCmdUI->SetCheck(pDispObj->GetEnable());
	}
}


void CMainFrame::OnViewOnlymark() 
{
	// TODO: Add your command handler code here
	CDisplay *pDisp;
	pDisp = CPointerContainer::GetDisplay();
	CInitialTable *pInitialTable =  CInitialTable::GetInstance();
	pInitialTable->SetViewOnlyMark( !pInitialTable->GetViewOnlyMark() );
	CMKObjectManager::Instance()->UnselectAll();
	
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);
}

void CMainFrame::OnUpdateViewOnlymark(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
		{
			CInitialTable *pInitialTable =  CInitialTable::GetInstance();
			pCmdUI->SetCheck( pInitialTable->GetViewOnlyMark() );		
		}
	}
	else 
	{
		CInitialTable *pInitialTable =  CInitialTable::GetInstance();
		pCmdUI->SetCheck( pInitialTable->GetViewOnlyMark() );
	}	
}

BOOL CMainFrame::OnToolTipNotify( UINT id, NMHDR * pNMHDR, LRESULT * pResult )
{
   ASSERT(pNMHDR->code == TTN_NEEDTEXTA || pNMHDR->code == TTN_NEEDTEXTW);

    TOOLTIPTEXTA* pTTTA = (TOOLTIPTEXTA*)pNMHDR;
    TOOLTIPTEXTW* pTTTW = (TOOLTIPTEXTW*)pNMHDR;
	
	CString strToolTip;
	CString strMsg;
	

    UINT nID =pNMHDR->idFrom;
	if( nID == ID_UNDO )
	{
		CString strMessage = CPointerContainer::GetCommandManager()->GetUndoMessage();

#ifndef _UNICODE
        if (pNMHDR->code == TTN_NEEDTEXTA)
            lstrcpyn(pTTTA->szText, strMessage, 80);
        else
            _mbstowcsz(pTTTW->szText, strMessage, 80);
#else
        if (pNMHDR->code == TTN_NEEDTEXTA)
            _wcstombsz(pTTTA->szText, strMessage, 80);
        else
            lstrcpyn(pTTTW->szText, strMessage, 80);
#endif
		
		
		return TRUE;

	}
	if( nID == ID_REDO )
	{
#ifndef _UNICODE
		CString strMessage = CPointerContainer::GetCommandManager()->GetRedoMessage();

        if (pNMHDR->code == TTN_NEEDTEXTA)
            lstrcpyn(pTTTA->szText,strMessage ,80);
        else
            _mbstowcsz(pTTTW->szText, strMessage, 80);
#else
        if (pNMHDR->code == TTN_NEEDTEXTA)
            _wcstombsz(pTTTA->szText, strMessage, 80);
        else
            lstrcpyn(pTTTW->szText, strMessage, 80);
#endif
		return TRUE;
	}
/*
    if (nID >= ID_MACRO_1 && nID <= ID_MACRO_0) {
        int n = (nID - ID_MACRO_1 + 1) % 10;
        CJTermDoc* pDoc = (CJTermDoc*)GetActiveDocument();
#ifndef _UNICODE
        if (pNMHDR->code == TTN_NEEDTEXTA)
            lstrcpyn(pTTTA->szText, pDoc->m_strMacroHead[n], _countof(pTTTA->szText));
        else
            _mbstowcsz(pTTTW->szText, pDoc->m_strMacroHead[n], _countof(pTTTW->szText));
#else
        if (pNMHDR->code == TTN_NEEDTEXTA)
            _wcstombsz(pTTTA->szText, pDoc->m_strMacroHead[n], _countof(pTTTA->szText));
        else
            lstrcpyn(pTTTW->szText, pDoc->m_strMacroHead[n], _countof(pTTTW->szText));
#endif
			*/

	
    return CFrameWnd::OnToolTipText(id, pNMHDR, pResult);
}

void CMainFrame::OnUpdateDrawArc(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
/*	CMKView *pView;
	POSITION pd;
	pd=GetFirstViewPosition();
	pView=(CMKView*)GetNextView(pd);

	// User State∞° æÓ∂≤∞≈≥ƒø° µ˚∂Û ±∏∫–«œ±‚
	if (pView->m_iMode == DRAW_ARC)
		pCmdUI->SetCheck(TRUE);          
	else
		pCmdUI->SetCheck(FALSE);*/
}


void CMainFrame::OnViewFigure() 
{
	// TODO: Add your command handler code here
	if (m_bShowFigure == TRUE) {
		m_bShowFigure = FALSE;
	}
	else {
		m_bShowFigure = TRUE;
	}
    ShowControlBar(&m_Tool[FIGURE], !m_bShowFigure, FALSE);	
}

void CMainFrame::OnUpdateViewFigure(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	pCmdUI->SetCheck(!m_bShowFigure);	
}

void CMainFrame::OnChangeMarkorder() 
{
	// TODO: Add your command handler code here
	StdCmdCreator<CMDChangeOrder> pCmd; //  ¡÷ºÆ √≥∏Æ  ¿·Ω√ ƒƒ∆ƒ¿œ¿ß«ÿ 
	if( TRUE==CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		Invalidate(FALSE);
	}
}


void CMainFrame::OnMenuAmkor() 
{
	
}

void CMainFrame::OnNewSem() 
{
	CBeamEditor6Doc *pDoc;
	pDoc = (CBeamEditor6Doc*)GetActiveDocument();

	
	CString m_RscFileName = _T("");
	CString m_PrjFileName = _T("");
	CString m_SemFileName = _T("");
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	CPointerManager *m_pPointerManager = m_pPointerManager->GetInstance();
	
	if(m_RscFileName != _T("")){
		OnFileNew(); 
	
		CMKFile *pFile = CPointerContainer::GetMKFile();
		pFile->LoadRsc(m_RscFileName,false);
		pFile->SemFileProc(m_PrjFileName,0);
		
	}
	//AfxMessageBox(pDoc->m_MrkInfoDisp); 
	if(pDoc->m_AmkorSQL == TRUE)
		{
			
			//pMng->SelectAll(); 
			
			/*int iPos=0;
			CMKObject *pObject;
			CMKObjectApproacher *pMKObjectApproacher = CPointerContainer::GetApproacher();
			pObject = pMKObjectApproacher->GetFirst(iPos);
			while(pObject != NULL)
			{
	
				pObject->SetSelect(TRUE); 
				pObject = pMKObjectApproacher->GetNext(iPos);
		
		
			}
			*/
			
			
			//OnSelectAll();
	//		pMng->UnselectAll(); 
			OnGroupAll();
			
			//SetDelayTime(300);
			//Sleep(10);
			
		//	OnGroupAll();
			
			if(pDoc->m_AutoHorizontalAlign)
		      OnAlignHcenter();
			//	Sleep(5);
			//	SetDelayTime(300);
			if(pDoc->m_AutoVerticalAlign) 
		  	  OnAlignVcenter();
			//SetDelayTime(300);
			
			//OnUnselectAllFrame();
			//pMng->UnselectAll(); 
			
			
			
		}
	
	pDoc->m_AmkorSQL = FALSE;

	
	
	
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	CPointerContainer::GetInformationView()->UpdateInfo();
	m_OrgScaleFlag = FALSE;
	OnScreenZoomOrg();

//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}

	
}

BOOL CMainFrame::DestroyWindow() 
{
	// TODO: Add your specialized code here and/or call the base class
	// 2007.01.04  
	CWriteLog *log= NULL;;
	log->WriteString("Destroy Program");


	delete CPointerManager::GetInstance();

	return CFrameWnd::DestroyWindow();
}

void CMainFrame::OnSampledbMenu() 
{
	CPointerManager *m_pPointerManager = m_pPointerManager->GetInstance();
	m_pPointerManager->GetDlgGuideEdit()->DoModal();
}

void CMainFrame::OnReLogin() 
{
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
	CDlgUserLogIn dlgLogIn;

	dlgLogIn.m_CurUser = pUserCheckMng->GetCurUserName();
	if (dlgLogIn.DoModal() == IDOK) {
		if (dlgLogIn.GetIsFail() == FALSE) {
			CString tempStr;
			tempStr.LoadString(IDS_MESSAGE7);
			tempStr = pUserCheckMng->GetCurUserName() + " " + tempStr;
			AfxMessageBox(tempStr);

//			SetTimer(0,300000,NULL);	
			
			//pFrame->Invalidate(); 
			//---------------------------------------------------------
			BOOL m_flag = TRUE;
			StdCmdCreator<CMDTextEdit> p_Cmd;
			if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&p_Cmd))
			{
				m_flag = FALSE;
			}
			CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
			GetView()->Invalidate(FALSE);
			CPointerContainer::GetInformationView()->GetDlgItem(IDC_EDIT_TEXT)->EnableWindow(m_flag);
			CPointerContainer::GetInformationView()->GetDlgItem(IDC_TEXT_CHANGE)->EnableWindow(m_flag);
			CPointerContainer::GetInformationView()->UpdateInfo();
			//--------------------------------------------------------------------
		}
		else {
			AfxMessageBox(IDS_MESSAGE8);
			//pUserCheckMng->ClearUserData(); // ∏ﬁ∏∏Æ∏Ø πÊ¡ˆ. 2004.3.16
			//delete pUserCheckMng;
			return ;
			
		}
	}
	else
	{
		return ;
	}
	
}

void CMainFrame::OnSemfileSave() 
{
	OnUnselectAllFrame();
	StdCmdCreator<CMDMrkFileSave> pCmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&pCmd))
		return;

	
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	
	
	CString strFileName;
	CString filepath;
	CFile File;
	CMKFile *pMKFile;
	CString strErrMsg;
	BOOL m_SaveAsFlag = FALSE;

	strFileName = pDoc->m_CurfileName;
	TCHAR lpszName[256];
	TCHAR lpszExt[256];
	_splitpath((LPCTSTR)strFileName, NULL, NULL, lpszName, lpszExt);
	strFileName.Format("%s%s", lpszName, lpszExt);

	//if(strFileName.Find(".sem") < 0)
	{
	   strFileName.Format("%s%s", lpszName, ".sem");
	   m_SaveAsFlag = TRUE;
	   }
//	pDoc->m_CurfileName.Format("%s%s", lpszName, ".mrk");
//	strFileName = pDoc->m_CurfileName; 

	CFileDialog dlgfileopen(FALSE, "sem", pApp->m_strCwd+"\\"+"*.sem", OFN_OVERWRITEPROMPT, "sem File (*.sem)", NULL);
	
	//if (dlgfileopen.DoModal() == IDOK)
	//{
	//	strFileName = dlgfileopen.GetFileName();
	//	pMKFile = CPointerContainer::GetMKFile();
	//	if (  pMKFile->Save(strFileName)  == R_FAILED)AfxMessageBox(IDS_MESSAGE25);
	//}
	if(strFileName == _T("")) strFileName = "noname.mrk";
	if( strFileName.Find("noname.mrk") >=0  || m_SaveAsFlag == TRUE )
	{	// »≠¿œ ¿Ã∏ßø° noname ¿Ã ¿÷¿∏∏È
		// ªı∑ŒøÓ »≠¿œ∏Ì º≥¡§
		CFileDialog dlgfileopen(FALSE, "sem", pApp->m_strCwd+"\\"+"*.sem", OFN_OVERWRITEPROMPT, "sem File (*.sem)", NULL);
		if (dlgfileopen.DoModal() == IDOK)
		{
			strFileName = dlgfileopen.GetFileName();
		    pMKFile = CPointerContainer::GetMKFile();
		if (  pMKFile->Save(strFileName)  == R_FAILED)
			AfxMessageBox(IDS_MESSAGE25);
		}
		else
			return ;
	}
	else
	{
		    pMKFile = CPointerContainer::GetMKFile();
		if (  pMKFile->Save(strFileName)  == R_FAILED)
			AfxMessageBox(IDS_MESSAGE25);
		 //else
		//	return ;
	}

	
	pDoc->m_CurfileName = strFileName;
	//SetWindowText(strFileName + _T("- Beam Editor 6.0 "));
	CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
	SetWindowText("KFlyCut-Cathode");

	CDisplay *pDisp = CPointerContainer::GetDisplay();
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);


	
}

void CMainFrame::OnRscfileSave() 
{
	ResourceSaveProc();
}

void CMainFrame::OnGroupAll()
{
	CMKList *pList;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CMKObject *pObject;
	pMng->GetAllList();
	pList = pMng->GetSelectedList();
	POSITION pd = pList->GetHeadPosition();
	if(pd == NULL) return;
	pObject = (CMKObject *)pList->GetNext(pd);

	double dAngle;
	dAngle = pObject->GetAngle(); 

	// 2011. 02. 21 syhun START - ∫π«’∞¥√º ∞¸∑√ ±‚¥… «Æ¿Ω.
	//if(pObject->GetObjectType() == ID_COMPOSITE_OBJECT) return;
	// syhun END.
	
	CMDGroupObject *pCmd = new CMDGroupObject;
//	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CPointerContainer::GetCommandManager()->Run(pCmd);

	pMng->SelectAll(); 
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);


	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	pDoc->m_GroupFlag = TRUE;
	/*CMDDeleteAll *pCmd = new CMDDeleteAll;

	
	CPointerContainer::GetCommandManager()->Run(pCmd);
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	GetView()->m_pUI->ChangeState(CUserNormalState::Instance());
	*/
	/*
	CMKList *pList;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CMKObject *pObject;
	pMng->GetAllList();
	pList = pMng->GetSelectedList();
	POSITION pd = pList->GetHeadPosition();
	if(pd == NULL) return;
	pObject = (CMKObject *)pList->GetNext(pd);

	double dAngle;
	dAngle = pObject->GetAngle(); 

	
	if(pObject->GetObjectType() == ID_COMPOSITE_OBJECT)
	{
		return;
	}

	
	CMDGroupObject *pCmd = new CMDGroupObject;
//	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CPointerContainer::GetCommandManager()->Run(pCmd);

	pMng->SelectAll(); 
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);


	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	pDoc->m_GroupFlag = TRUE;
	/////
	int iPos=0;
	
	CMKObjectApproacher *pMKObjectApproacher = CPointerContainer::GetApproacher();
	pObject = pMKObjectApproacher->GetFirst(iPos);
	while(pObject != NULL)
	{
	
		pObject->SetSelect(TRUE); 
		pObject = pMKObjectApproacher->GetNext(iPos);
		
		
	}



	pFieldParameter->SetSelectAllFlag(TRUE); 

	CDisplay *pDisp = CPointerContainer::GetDisplay();
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	Invalidate(FALSE);

	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);

	*/
}

void CMainFrame::UnSellectInit()
{
	CMDReleaseObject *pCmd = new CMDReleaseObject;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	pFieldParameter->SetSelectAllFlag(FALSE);
	CMKObjectHandler *pHandler  = CMKObjectHandler::Instance();
	pFieldParameter->SetGroupFlag(FALSE);

	CMKList *pList;
	CMKObject *pObject;
	pMng->GetAllList();
	pList = pMng->GetSelectedList();
	
	pCmd->SetReleaseObject(pMng->GetSelected() );
	pMng->UnselectAll(); 
	POSITION pd = pList->GetHeadPosition();
	if(pd == NULL ) return;
	pObject = (CMKObject *)pList->GetNext(pd);
	
	if(pObject->GetObjectType() == ID_COMPOSITE_OBJECT && pObject->GetLock() == TRUE) 
		pObject->SetLock(FALSE); 
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
		OnUndo();  //π´æ∞° ≤ø¿Œ∞Õ∞∞æ∆º≠ ¿”Ω√πÊ∆Ì¿∏∑Œ §–.§– 
		OnRedo();
	
	}
}

void CMainFrame::UnSellectAllFrame()
{
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CMDReleaseObject *pCmd = new CMDReleaseObject;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CMKObjectHandler *pHandler  = CMKObjectHandler::Instance();
	pMng->SelectAll(); 

	

/*	int iPos=0;
	CMKObject *pObject;
	CMKObjectApproacher *pMKObjectApproacher = CPointerContainer::GetApproacher();
	pObject = pMKObjectApproacher->GetFirst(iPos);
	while(pObject != NULL)
	{
	
		pObject->SetSelect(TRUE);
		pObject = pMKObjectApproacher->GetNext(iPos);
		
		
	}
	*/
	pCmd->SetReleaseObject(pMng->GetSelected() );
	//pHandler->Clear(); 
	//pHandler->SetObject(pMng->GetSelected());
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
	
	pFrame->m_bTempFileNew = FALSE;	
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		pHandler->Clear(); 
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
	}
	pDoc->m_GroupFlag = FALSE;
	return;
	/*
	CMDReleaseObject *pCmd = new CMDReleaseObject;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	pFieldParameter->SetSelectAllFlag(FALSE);
	CMKObjectHandler *pHandler  = CMKObjectHandler::Instance();
	pFieldParameter->SetGroupFlag(FALSE);

	CMKList *pList;
	CMKObject *pObject;
	pMng->GetAllList();
	pMng->SelectAll(); 
	pList = pMng->GetSelectedList();

	
	
	pCmd->SetReleaseObject(pMng->GetSelected() );
	
	POSITION pd = pList->GetHeadPosition();
	if(pd == NULL ) return;
	pObject = (CMKObject *)pList->GetNext(pd);
	double dAngle = pObject->GetAngle();
	
	if(pFieldParameter->GetGroupSameAngle() == TRUE && pObject->GetObjectType() == ID_COMPOSITE_OBJECT)
	{
		if(dAngle ==  0)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(0);
		}
		if(dAngle ==  180)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(180);
		}
		if(dAngle ==  90)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(90);
		}
		if(dAngle ==  270)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(270);
		}
	}
	pMng->UnselectAll(); 
	if(pObject->GetObjectType() == ID_COMPOSITE_OBJECT && pObject->GetLock() == TRUE) 
		pObject->SetLock(FALSE); 
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
		OnUndo();  //π´æ∞° ≤ø¿Œ∞Õ∞∞æ∆º≠ ¿”Ω√πÊ∆Ì¿∏∑Œ §–.§– 
		OnRedo();
	
	}
	if(pFieldParameter->GetGroupSameAngle() == TRUE && pObject->GetObjectType() == ID_COMPOSITE_OBJECT)
	{
		if(dAngle ==  0)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(0);
		}
		if(dAngle ==  180)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(180);
		}
		if(dAngle ==  90)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(90);
		}
		if(dAngle ==  270)
		{
			CPointerContainer::GetInformationView()->OnGroupRotation(270);
		}
	}
*/
}

void CMainFrame::SellectAllObj()
{
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	/////
	CMKList *pList;
	CMKObject *pObject;
	pMng->GetAllList();
	pList = pMng->GetSelectedList();
	POSITION pd = pList->GetHeadPosition();
	if (pd == NULL)
		return;
	
	pObject = (CMKObject *)pList->GetNext(pd); 

	
	double dAngle;
	dAngle = pObject->GetAngle(); 
	pFieldParameter->SetGroupFlag(TRUE);

	if(pObject->GetObjectType() == ID_COMPOSITE_OBJECT) return;

	int iPos=0;
	CMKObjectApproacher *pMKObjectApproacher = CPointerContainer::GetApproacher();
	pObject = pMKObjectApproacher->GetFirst(iPos);
	double m_dAngle_Cmp, m_objAngle;
	BOOL m_SameAngleCheck = TRUE;
	m_dAngle_Cmp = pObject->GetAngle(); 
	pFieldParameter->SetGroupSameAngle(TRUE); 
	while(/*pMKObjectApproacher*/pObject != NULL)
	{
		m_objAngle = pObject->GetAngle(); 
		if(m_objAngle != m_dAngle_Cmp || pObject->GetLock() == TRUE )
		{
			if(pObject->GetLock() == TRUE){
				AfxMessageBox("Release Lock Object.");
			return; // ∞¢µµ¥¬ ∞∞∞‘..
			}
			//if(m_objAngle - m_dAngle_Cmp != 180 || m_dAngle_Cmp -m_objAngle != 180 )
			{
			m_SameAngleCheck = FALSE;
			pFieldParameter->SetGroupSameAngle(FALSE);
			}
		}
		pObject = pMKObjectApproacher->GetNext(iPos);
		
		
	}

	
	/////

	
	CMDGroupObject *pCmd = new CMDGroupObject;
	pFieldParameter->SetSelectAllFlag(TRUE); 

	CPointerContainer::GetCommandManager()->Run(pCmd);
	
	if(m_SameAngleCheck == TRUE)
	{
		if(dAngle == 90 || dAngle == 270){
			pMng->SelectAll(); 
			if(dAngle == 270)
				CPointerContainer::GetInformationView()->OnGroupRotation(1);
			else 
				CPointerContainer::GetInformationView()->OnGroupRotation(3);
			
			UnSellectInit();
			OnGroupAll();
			pMng->SelectAll();
			
			if(dAngle == 270)
				CPointerContainer::GetInformationView()->OnGroupRotation(3);
			else
				CPointerContainer::GetInformationView()->OnGroupRotation(1);
			
			POSITION pd =NULL;
			CPointerContainer::GetCommandManager()->RemoveAt(pd);
		}
	}
	


	pFieldParameter->SetSelectAllFlag(TRUE); 

	CPointerContainer::GetCommandManager()->Run(pCmd);
	
	if(m_SameAngleCheck == TRUE)
	{
		if(dAngle >=360) dAngle = dAngle - 360;
		if(dAngle == 90 || dAngle == 270)
		{
			pMng->SelectAll(); 
			if(dAngle == 270)
				CPointerContainer::GetInformationView()->OnGroupRotation(1);
			else 
				CPointerContainer::GetInformationView()->OnGroupRotation(3);
			
			UnSellectInit();
			OnGroupAll();
			pMng->SelectAll();
			
			if(dAngle == 270)
				CPointerContainer::GetInformationView()->OnGroupRotation(3);
			else
				CPointerContainer::GetInformationView()->OnGroupRotation(1);
			
			POSITION pd =NULL;
			CPointerContainer::GetCommandManager()->RemoveAt(pd);
		}
		else 
		{
			pMng->SelectAll(); 
			if(dAngle == 0)
				CPointerContainer::GetInformationView()->OnGroupRotation(0);
			else 
				CPointerContainer::GetInformationView()->OnGroupRotation(2);
			
			UnSellectInit();
			OnGroupAll();
			pMng->SelectAll();
			
			if(dAngle == 180)
				CPointerContainer::GetInformationView()->OnGroupRotation(2);
			else
				CPointerContainer::GetInformationView()->OnGroupRotation(0);
			
			POSITION pd =NULL;
			CPointerContainer::GetCommandManager()->RemoveAt(pd);
		}
	}
	


	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);
}



void CMainFrame::AutoAlignment(BOOL m_flag)
{
	
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	CPointerManager *m_pPointerManager = m_pPointerManager->GetInstance();

	//OnGroupAll();
	//pMng->SelectAll();
	
	int iPos=0;
	CMKObject *pObject;
	CMKObjectApproacher *pMKObjectApproacher = CPointerContainer::GetApproacher();
	pObject = pMKObjectApproacher->GetFirst(iPos);
	while(pObject != NULL)
	{
		pObject->SetSelect(TRUE); 
		pObject = pMKObjectApproacher->GetNext(iPos);
	}
	

	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);
	//OnAlignHcenter();
	OnAlignVcenter();
//	OnUnselectAllFrame();
	UnSellectAllFrame();
	
	CPointerContainer::GetInformationView()->UpdateInfo();
	m_OrgScaleFlag = FALSE;
	OnScreenZoomOrg();

}

BOOL CMainFrame::CreateDBDSN(CString strMdbFilePath, CString strDsnName)
{
	 int     nRet;
    char    szAttrib[512];
    char    szSec[128];
    int     nPos;
    CString strFileName;
    CString strPathName;
	//strMdbFilePath = "D:\\HK.mdb";
    strFileName = strMdbFilePath.Mid( strMdbFilePath.ReverseFind('\\') + 1 );
    strPathName = strMdbFilePath.Mid( 0, strMdbFilePath.ReverseFind('\\') );
    strFileName.TrimRight( ".mdb" );

    memset( szAttrib, 0x00, 512 );
    memset( szSec, 0x00, 128 );
    sprintf( szAttrib, "REPAIR_DB=%s\0", (LPSTR)(LPCTSTR) strMdbFilePath );

    nPos    = strlen( szAttrib );
    nRet    = SQLConfigDataSource(NULL, ODBC_ADD_DSN, S_MS_ACCESS_DRIRVER, szAttrib);
   // if( !nRet )
  //      return FALSE;
    nPos    = 0;
    memset( szAttrib, 0x00, 512 );
    sprintf( szSec, "DSN=%s\0", (LPSTR)(LPCTSTR)strDsnName );
    memcpy( szAttrib + nPos, szSec, strlen( szSec ) +1 );
    nPos    += strlen( szSec )+1;
    sprintf( szSec, "FIL=MS Access\0" );
    memcpy( szAttrib + nPos, szSec, strlen( szSec ) +1 );
    nPos    += strlen( szSec )+1;
    sprintf( szSec, "JetIniPath=%s.ini\0", (LPSTR)(LPCTSTR)strFileName );
    memcpy( szAttrib + nPos, szSec, strlen( szSec ) +1);
    nPos    += strlen( szSec )+1;
    sprintf( szSec, "DBQ=%s\0", (LPSTR)(LPCTSTR)strMdbFilePath );
    memcpy( szAttrib + nPos, szSec, strlen( szSec ) +1);
    nPos    += strlen( szSec )+1;
    sprintf( szSec, "DefaultDir=d:\\\0\0", (LPSTR)(LPCTSTR)strMdbFilePath );
    memcpy( szAttrib + nPos, szSec, strlen( szSec ) +1);
    nPos    += strlen( szSec )+1;
    nRet    =SQLConfigDataSource(NULL, ODBC_ADD_DSN, S_MS_ACCESS_DRIRVER, szAttrib);
    return nRet;
	
}

void CMainFrame::EO_OffsetSave()
{
	CBeamEditor6Doc *pDoc;
	pDoc = (CBeamEditor6Doc*)GetActiveDocument();
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
	
	int iMmSize, iFieldSize;
 	TCHAR lpszName[256];
	TCHAR lpszExt[256];
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	pFieldParameter->GetSize(&iMmSize, &iFieldSize);
	CString m_strRscName;
	m_strRscName = pFieldParameter->GetAmkorRscFileName(); 
	_splitpath(m_strRscName, NULL, NULL, lpszName, lpszExt);
	m_strRscName.Format("%s", lpszName);

	int m_unit = MM; // mm
	double m_dmasterX,m_dmasterY,m_dslaveX,m_dslaveY;
	CTransUnit *pTransUnit = pTransUnit->GetInstance(iFieldSize, iMmSize);

	//int iUnit = pFieldParameter->GetUnit();
	pTransUnit->SetValue(pFieldParameter->GetMasterX() , FIELD);
	m_dmasterX = pTransUnit->GetValue(MM);

	pTransUnit->SetValue(pFieldParameter->GetMasterY() , FIELD);
	m_dmasterY = pTransUnit->GetValue(MM);

	pTransUnit->SetValue(pFieldParameter->GetSlaveX() , FIELD);
	m_dslaveX = pTransUnit->GetValue(MM);

	pTransUnit->SetValue(pFieldParameter->GetSlaveY() , FIELD);
	m_dslaveY = pTransUnit->GetValue(MM);

	pDoc->EOOffsetSave(m_strRscName, m_dmasterX, m_dmasterY, m_dslaveX, m_dslaveY);
}

void CMainFrame::ResourceSaveProc()
{
	
OnUnselectAllFrame();
StdCmdCreator<CMDMrkFileSave> pCmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&pCmd))
		return;

	
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	
	
	CString strFileName;
	CString filepath;
	CFile File;
	CMKFile *pMKFile;
	CString strErrMsg;
	BOOL m_SaveAsFlag = FALSE;

	strFileName = pDoc->m_CurfileName;
	TCHAR lpszName[256];
	TCHAR lpszExt[256];
	_splitpath((LPCTSTR)strFileName, NULL, NULL, lpszName, lpszExt);
	strFileName.Format("%s%s", lpszName, lpszExt);

	//if(strFileName.Find(".sem") < 0)
	{
	   strFileName.Format("%s%s", lpszName, ".rsc");
	   m_SaveAsFlag = TRUE;
	   }

	CFileDialog dlgfileopen(FALSE, "rsc", pApp->m_strCwd+"\\"+"*.rsc", OFN_OVERWRITEPROMPT, "rsc File (*.rsc)", NULL);
	
	if(strFileName == _T("")) strFileName = "noname.mrk";
	if( strFileName.Find("noname.mrk") >=0  || m_SaveAsFlag == TRUE )
	{	// ªı∑ŒøÓ »≠¿œ∏Ì º≥¡§
		CFileDialog dlgfileopen(FALSE, "rsc", pApp->m_strCwd+"\\"+"*.rsc", OFN_OVERWRITEPROMPT, "rsc File (*.rsc)", NULL);
		if (dlgfileopen.DoModal() == IDOK)
		{
			strFileName = dlgfileopen.GetFileName();
		    pMKFile = CPointerContainer::GetMKFile();
		if (  pMKFile->Save(strFileName)  == R_FAILED)
			AfxMessageBox(IDS_MESSAGE25);
		}
		else
			return;
	}
	else
	{
		    pMKFile = CPointerContainer::GetMKFile();
		if (  pMKFile->Save(strFileName)  == R_FAILED)
			AfxMessageBox(IDS_MESSAGE25);
	}

	CDisplay *pDisp = CPointerContainer::GetDisplay();
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	GetView()->Invalidate(FALSE);

}



void CMainFrame::OnShowLaserControl()
{
	CPointerManager *m_pPointerManager = m_pPointerManager->GetInstance();
	CInitialTable *pInitialTable = pInitialTable->GetInstance();
	if(pInitialTable->GetLaser() == 2)
	{//Quantronix¥¬ ¡ª ªÁøÎ¿Ã ∆≤∏≤
		CPointerManager *m_pPointerManager = m_pPointerManager->GetInstance();
		m_pDlgLaserControl = m_pPointerManager->GetDlgLaserControl();
		m_pDlg.ShowWindow(true);
	}
	else if(pInitialTable->GetLaser() == 4)
	{
		//m_pDlgLaserControl = m_pPointerManager->GetDlgLaserControl();
		m_pDlgLaserControl->ShowWindow(SW_SHOWNORMAL);
		m_pDlgLaserControl->BringWindowToTop();
	}
	else
	{
		//CreateLaserControl();
		// * Ω«¡¶ ¥Ÿ¿ÃæÛ∑Œ±◊∏¶ ∫∏ø©¡÷¥¬ ∞« LaserControl πˆ∆∞¿ª ¥≠∑∂¿ª ∞ÊøÏ∏∏ * /
		m_pDlgLaserControl = m_pPointerManager->GetDlgLaserControl();
		if (m_pDlgLaserControl != NULL)
		{
			m_pDlgLaserControl->ShowWindow(SW_SHOWNORMAL);
			m_pDlgLaserControl->BringWindowToTop();
		}
	}
}


BOOL CMainFrame::InitRTC()
{
	//return true;
	CDsp *pDsp = CDsp::GetInstance();
	//return TRUE;

	pDsp->InitDsp();
  
	return TRUE;
}

void CMainFrame::GrouopObj()
{
   OnSelectAll();
}

void CMainFrame::UnGroup()
{
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CMDReleaseObject *pCmd = new CMDReleaseObject;
	CMKObjectManager *pMng = CMKObjectManager::Instance();
	CMKObjectHandler *pHandler  = CMKObjectHandler::Instance();
	pMng->SelectAll(); 

/*	int iPos=0;
	CMKObject *pObject;
	CMKObjectApproacher *pMKObjectApproacher = CPointerContainer::GetApproacher();
	pObject = pMKObjectApproacher->GetFirst(iPos);
	while(pObject != NULL)
	{
	
		pObject->SetSelect(TRUE);
		pObject = pMKObjectApproacher->GetNext(iPos);
		
		
	}
	*/
	pCmd->SetReleaseObject(pMng->GetSelected() );
	//pHandler->Clear(); 
	//pHandler->SetObject(pMng->GetSelected());
	CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
	GetView()->Invalidate(FALSE);

	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		pHandler->Clear(); 
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
	}
	//	pDoc->m_GroupFlag = FALSE;
	return;
}

void CMainFrame::OnZoomOrg()
{
	OnScreenZoomOrg();
}

void CMainFrame::CopyObj()
{
	OnObjCopyFrame();
}

void CMainFrame::DeleteObj()
{
	OnObjEraseFrame();
}

void CMainFrame::SetDelayTime(unsigned int iSecond)
{
DWORD dwTick = GetTickCount();
	MSG msg;
	while(GetTickCount() - dwTick < iSecond)
	{					
		if(PeekMessage(&msg, NULL, NULL, NULL, PM_REMOVE))
		{
			TranslateMessage(&msg);
			DispatchMessage(&msg);
		}
	}
}

void CMainFrame::AlignVCenter()
{

CMDAlignVerticalCenterAll *pCmd= new CMDAlignVerticalCenterAll;
	
	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}

//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
}

void CMainFrame::AlignHCenter()
{
CMDAlignHorizontalCenterAll *pCmd= new CMDAlignHorizontalCenterAll;

	if( R_DEFAULT == CPointerContainer::GetCommandManager()->Run(pCmd) )
	{
		CPointerContainer::GetDisplay()->SetRefreshFlag(CDisplay::DRAW_SKIPBG);
		GetView()->Invalidate(FALSE);
		CPointerContainer::GetInformationView()->UpdateInfo();
	}

//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
//	if(m_pDlgMark->m_hWnd  != NULL)
//	{
//			m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
//			m_pDlgMark->m_ctMarkPreview.Invalidate();
//	}
}

void CMainFrame::Load_DeviceIndex()
{
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
	FILE *in;
	CString tmp;
	char ch;

	if ((in = fopen(pApp->m_strCwd+"\\DeviceIndex.ini", "rt")) != NULL) 
	{
		for(int  k = 0 ; k < 255 ; k++)
		{
			ch = fgetc(in);int j = 0;
			if(ch == -1 ) break;
			while(ch!=10) 
			{ 
				tmp +=ch;
				j++; 
				ch=fgetc(in); 
				if(ch == -1) break;
			}
			
			pApp->m_strDeviceIndex[k]=  tmp.Right(tmp.GetLength() - tmp.Find(':') -1 );
			int tt = tmp.Find(':');
			pApp->m_strDeviceName[k] = tmp.Left( tmp.Find(':')); 
			tmp = "";
			
			//	pApp->m_strDeviceIndex[index]='\0';
			//			m_strArray.Add((LPCTSTR)buf);
		}

		// 2007.01.22   - ∆ƒ¿œ ∆˜¿Œ≈Õ ¥›æ∆¡‹
		fclose(in);
	}
	else
	{
		AfxMessageBox("Can not found DeviceIndex.ini file!");
		for(int  k = 0 ; k < 30 ; k++)
		{
			
			
			pApp->m_strDeviceIndex[k]=  _T("");
		}
	}
}






void CMainFrame::Load_TapPosition()
{
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
	FILE *in;
	CString tmp;
	char ch;

	if ((in = fopen(pApp->m_strCwd+"\\Tap_Position.ini", "rt")) != NULL) 
	{
		for(int  k = 0 ; k < 255 ; k++)
		{
			ch = fgetc(in);int j = 0;
			if(ch == -1 ) break;
			while(ch!=10) 
			{ 
				tmp +=ch;
				j++; 
				ch=fgetc(in); 
				if(ch == -1) break;
			}

			pApp->m_strDeviceIndex[k]=  tmp.Right(tmp.GetLength() - tmp.Find(':') -1 );
			int tt = tmp.Find(':');
			pApp->m_strDeviceName[k] = tmp.Left( tmp.Find(':')); 
			tmp = "";

			//	pApp->m_strDeviceIndex[index]='\0';
			//			m_strArray.Add((LPCTSTR)buf);
		}

		// 2007.01.22   - ∆ƒ¿œ ∆˜¿Œ≈Õ ¥›æ∆¡‹
		fclose(in);
	}
	else
	{
		AfxMessageBox("Can not found Tap_Position.ini file!");
		for(int  k = 0 ; k < 30 ; k++)
		{


			pApp->m_strDeviceIndex[k]=  _T("");
		}
	}

}


void CMainFrame::OnCustomerCode() 
{
	CDlgCustomerCode dlg;

	StdCmdCreator<CMDMrkFileOpen> pCmd;
	if (R_AUTHORITY_DENIED == CPointerContainer::GetCommandManager()->Run(&pCmd))
		return;

	dlg.DoModal();
}

void CMainFrame::OnShutterDelay() 
{

	
}

void CMainFrame::OnTimer(UINT nIDEvent) 
{
	// TODO: Add your message handler code here and/or call default
	if (nIDEvent == AUTO_MARK_VIEW)
	{
		
		KillTimer(AUTO_MARK_VIEW);
		m_bTempFileNew = FALSE;
		// 2007.03.25  
		OnFileNew();


	CDlgMark *pDlgMark = pDlgMark->GetInstance();
		if(pDlgMark->GetDlgAlive() == FALSE)
		{
			pDlgMark->Create(IDD_DLG_MARK, NULL);
			pDlgMark->CenterWindow();
			pDlgMark->SetDlgAlive(TRUE);
		}
		pDlgMark->ShowWindow(SW_SHOW);

		this->ShowWindow(SW_HIDE);
		
		SetTimer(AUTO_MARK_START, 500, NULL);
	}
	else if(nIDEvent == AUTO_MARK_START)
	{
		return;
		
		CDlgMark *pDlgMark = pDlgMark->GetInstance();
		if(pDlgMark->m_csTabMarking.m_bEmissionCheck == TRUE)
		{
			KillTimer(AUTO_MARK_START);
			
			pDlgMark->ShowWindow(SW_SHOW);	
			CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
			CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
			CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument();
			pDoc->m_bDlgMarkFlag = TRUE;

			pDlgMark->m_csTabMarking.OnAutoMark();

			FILE *fp;
			fp = fopen(pApp->m_strCwd+"\\LastMrk.ini", "rt");
			if (fp != NULL)
			{
				char chMrk;
				CString strMrk = "";
				chMrk = fgetc(fp);
				while(chMrk!=10)
				{
					strMrk += chMrk;
					chMrk = fgetc(fp);
					if(chMrk == -1)
						break;
				}
				fclose(fp);

				CWriteLog *log;
				log->WriteString("Last Mrk File : " + strMrk);
				
				CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp();
				CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
				CBeamEditor6Doc * pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
				
				CString strPrjMarkFile_path = "", strPrjMarkFile = "";
				CString SaveFile;
				CInitialTable *pInitialTable = pInitialTable->GetInstance();
				SaveFile = pInitialTable->GetSpecImgFolder();
				strPrjMarkFile.Format("%s\\Mrk\\%s",SaveFile, strMrk);
				
				pDlgMark->m_csTabMarking.m_bDeviceChange = TRUE;
				
				CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
				CFileFind filefind;	
				CFilePath  *pFilePath = pFilePath->GetInstance();
				CMKFile *pFile = CPointerContainer::GetMKFile();
				CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
				
				if(strPrjMarkFile != _T("") && (FALSE != filefind.FindFile(strPrjMarkFile)))
				{
					pDoc->m_bDrawStop = TRUE;
					pFile->Load(strPrjMarkFile);
					pDoc->m_bDrawStop = FALSE;
					pFilePath->SetMarkFilePath(strPrjMarkFile); 
					pDoc->m_MrkInfoDisp.Format("%s",strPrjMarkFile ); 
					pDoc->m_CurfileName = strPrjMarkFile;
					m_pDlgMark->SetDlgItemText(IDC_STATIC_MRKINFO, pDoc->m_MrkInfoDisp);
					pDlgMark->m_csTabMarking.m_MarkingCnt=0;
					
					//m_pDlgMark->m_csTabSetting.LoadValue();
					//m_pDlgMark->m_csTabSetting.UpdateData();
					
					CDisplay *pDisp = CPointerContainer::GetDisplay();
					pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
					
					CString strName;
					strName = pDoc->m_CurfileName;
					pFrame->SetWindowText(strName);
					pFrame->Invalidate();
					
					m_pDlgMark->SetDlgItemText(IDC_STATIC_MRKINFO, pDoc->m_MrkInfoDisp);
					
					if(m_pDlgMark->m_hWnd  != NULL)
					{
						m_pDlgMark->m_ctMarkPreview.SetTapPosionApply(false);
						m_pDlgMark->m_ctMarkPreview.SetIsSimulation(FALSE);	
						m_pDlgMark->m_ctMarkPreview.Stop();  
						m_pDlgMark->m_ctMarkPreview.Invalidate();
						pFieldParameter->SetDBAccessFlag(FALSE); 
					}
					if (pInitialTable->GetLaser() == LASER_FIBER)
					{
						// 2007.03.25   - ∆ƒ¿œ open Ω√ power, freq∞° ¿⁄µø ºº∆√µ«µµ∑œ
						CPointerManager *pPointerManager = pPointerManager->GetInstance();
						
						Iterator<CParameter*> *iterator = pPointerManager->GetParameterList()->iterator();
						CParameter *pParameter = iterator->GetCurrentItem();
						CDlgFiber *fiber = (CDlgFiber *)pPointerManager->GetDlgLaserControl();
						
						fiber->SendPowerSet((int)(pParameter->GetLaserPowerSet()));
						fiber->SetDelayTime(1000);
						fiber->SendFreqSet(pParameter->GetFrequency());
						fiber->SetDelayTime(300);
					}
					pDlgMark->m_csTabMarking.LoadValue();
					pDlgMark->m_csTabMarking.SetTimer(1,10,NULL);
				}
				else
				{	
					if(strMrk != _T(""))
						pDoc->m_MrkInfoDisp.Format("%s/mrk Can't find!!",strPrjMarkFile ); 
					m_pDlgMark->SetDlgItemText(IDC_STATIC_MRKINFO, pDoc->m_MrkInfoDisp);
					//log->WriteString(pDoc->m_MrkInfoDisp);
				}
			}
		}
	}
/*
	else if(nIDEvent==0)	
	{
		CUserCheckMng *pUserCheckMng = pUserCheckMng->Instance();
		pUserCheckMng->SetCurUserWithName("OPERATOR");
		KillTimer(0);
	}
*/
	CFrameWnd::OnTimer(nIDEvent);
}

void CMainFrame::GetOperatorTime()
{
	CBeamEditor6App* pApp=(CBeamEditor6App*)AfxGetApp();
	FILE *pTime;
	CString strTmp;
	int strTime;
   	pTime = fopen(pApp->m_strCwd + "\\OperatorTime.ini","rt");	
	if(pTime)
	{
		fscanf(pTime , "%d", &strTime);
		fclose(pTime);
		strTmp.Format("%d",strTime);
		m_nOperatorTime=atoi(strTmp)*1000*60;
//		m_nOperatorTime=atoi(strTmp)*1000;
	}
}

void CMainFrame::OnOperatorMode() 
{
	// TODO: Add your command handler code here
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	
	CUserCheckMng *pUserCheckMng = CUserCheckMng::Instance();
	if (pUserCheckMng->GetCurUserName() == "ADMINISTRATOR") 
	{	
		CDlgOperatorMode dlg;
		if(dlg.DoModal() == IDOK)
		{
			return;
		}
	}
	else
	{
		AfxMessageBox(IDS_MESSAGE50);
		return;
	}
}

void CMainFrame::OnUpdateFileOpen(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);	
}

void CMainFrame::OnUpdateNewText(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
	if(m_pDlgMark->m_hWnd  != NULL)
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateLaserCtr(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateFileNew(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateNewHpgl(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}


//
//void CMainFrame::OnUpdateParameter(CCmdUI* pCmdUI) 
//{
//	// TODO: Add your command update UI handler code here
//	/*CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
//	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
//	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
//	if(m_pDlgMark->m_hWnd  != NULL)	
//	{
//		if(pDoc->m_bDlgMarkFlag == TRUE) 
//			pCmdUI->Enable(FALSE);
//		else
//			pCmdUI->Enable(TRUE);
//	}
//	else 
//		pCmdUI->Enable(TRUE);*/
//}
//
//

void CMainFrame::OnUpdateMarkFileSave(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnLotCompTime()	
{
	// TODO: Add your command handler code here
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp(); 
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	
	CUserCheckMng *pUserCheckMng = CUserCheckMng::Instance();
	if (pUserCheckMng->GetCurUserName() == "ADMINISTRATOR") 
	{	
		CDlgLotCompTime dlg;
		if(dlg.DoModal() == IDOK)
		{
			return;
		}
	}
	else
	{
		AfxMessageBox(IDS_MESSAGE50);
		return;
	}
}

void CMainFrame::OnUpdateObjCopyFrame(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateObjEraseFrame(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateSelectAll(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateUnselectAllFrame(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateMainZoomIn2(CCmdUI* pCmdUI) 
{
	//// TODO: Add your command update UI handler code here
	//CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	//CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	//CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	//if(m_pDlgMark->m_hWnd  != NULL)	
	//{
	//	if(pDoc->m_bDlgMarkFlag == TRUE) 
	//		pCmdUI->Enable(FALSE);
	//	else
	//		pCmdUI->Enable(TRUE);
	//}
	//else 
	//	pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateMainZoomOut(CCmdUI* pCmdUI) 
{
	//// TODO: Add your command update UI handler code here
	//CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	//CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	//CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();
	//if(m_pDlgMark->m_hWnd  != NULL)	
	//{
	//	if(pDoc->m_bDlgMarkFlag == TRUE) 
	//		pCmdUI->Enable(FALSE);
	//	else
	//		pCmdUI->Enable(TRUE);
	//}
	//else 
	//	pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateScreenZoom(CCmdUI* pCmdUI) 
{
	//// TODO: Add your command update UI handler code here
	//CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	//CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	//CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	//if(m_pDlgMark->m_hWnd  != NULL)	
	//{
	//	if(pDoc->m_bDlgMarkFlag == TRUE) 
	//		pCmdUI->Enable(FALSE);
	//	else
	//		pCmdUI->Enable(TRUE);
	//}
	//else 
	//	pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateScreenZoomOrg(CCmdUI* pCmdUI) 
{
	//// TODO: Add your command update UI handler code here
	//CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	//CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	//CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	//if(m_pDlgMark->m_hWnd  != NULL)	
	//{
	//	if(pDoc->m_bDlgMarkFlag == TRUE) 
	//		pCmdUI->Enable(FALSE);
	//	else
	//		pCmdUI->Enable(TRUE);
	//}
	//else 
	//	pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateNewImg(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateNewBar(CCmdUI* pCmdUI)
{
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdate2dbarcode(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnUpdateNewTtf(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::OnNewDxf() 
{
	// TODO: Add your command handler code here
	StdCmdCreator<CMDCreateDXF> pCmd;
	if( TRUE==CPointerContainer::GetCommandManager()->Run(&pCmd) )
	{
		Invalidate(FALSE);
	}
}

void CMainFrame::OnPaint() 
{
	CPaintDC dc(this); // device context for painting
	
	// TODO: Add your message handler code here
	if (CPointerContainer::GetDisplay()->GetRefreshFlag() == CDisplay::DRAW_ALL)
	{
		GetView()->Invalidate();
		m_wndSplitterHor.RecalcLayout();
		m_wndSplitterVer.RecalcLayout();
	}
	// Do not call CFrameWnd::OnPaint() for painting messages
}

void CMainFrame::OnUpdateNewDxf(CCmdUI* pCmdUI) 
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}

void CMainFrame::InitPsc()
{
	CBeamEditor6App *pApp = (CBeamEditor6App*) AfxGetApp();
	CInitialTable *pInitialTable = pInitialTable->GetInstance();
	CPsc140p* pPsc = CPsc140p::GetInstance();
	pPsc->PscOpenPsc();
	
	short   ErrorCode = 0;
	CString strError = "";
	
	if(pInitialTable->GetHead() == TRUE)
	{
		ErrorCode = pPsc->PscLoadProgramFile((LPSTR)(LPCTSTR)(pApp->m_strCwd+"\\PSC142P16.HEX"));
		if(ErrorCode)
		{
			strError.Format(_T("LoadProgramFile Fail!!  ecode=%d"), ErrorCode);
			AfxMessageBox(strError);
			return;
		}
		
		ErrorCode = pPsc->PscLoadCorrectionFile((LPSTR)(LPCTSTR)(pApp->m_strCwd+"\\default(257-16bit).pcf"),1,1/*scalex*/,1/*scaley*/,0/*rotate*/,0,0);
		if(ErrorCode)
		{
			strError.Format(_T("LoadCorrectionFile Fail!!  ecode=%d"), ErrorCode);
			AfxMessageBox(strError);
			return;
		}
		
		ErrorCode = pPsc->PscLoadCorrectionFile((LPSTR)(LPCTSTR)(pApp->m_strCwd+"\\default(257-16bit).pcf"),2,1/*scalex*/,1/*scaley*/,0/*rotate*/,0,0);
		if(ErrorCode)
		{
			strError.Format(_T("LoadCorrectionFile Fail!!  ecode=%d"), ErrorCode);
			AfxMessageBox(strError);
			return;
		}

		ErrorCode = pPsc->PscSelectCorTable(1,2);
		if(ErrorCode)
		{
			strError.Format(_T("LoadCorrectionFile Fail!!  ecode=%d"), ErrorCode);
			AfxMessageBox(strError);		
			return;
		}
	}
	else
	{
		ErrorCode = pPsc->PscLoadProgramFile((LPSTR)(LPCTSTR)(pApp->m_strCwd+"\\PSC141P16.HEX"));
		if(ErrorCode)
		{
			strError.Format(_T("LoadProgramFile Fail!!  ecode=%d"), ErrorCode);
			AfxMessageBox(strError);
			return;
		}
		
		ErrorCode = pPsc->PscLoadCorrectionFile((LPSTR)(LPCTSTR)(pApp->m_strCwd+"\\default(257-16bit).pcf"),1,1/*scalex*/,1/*scaley*/,0/*rotate*/,0,0);
		if(ErrorCode)
		{
			strError.Format(_T("LoadCorrectionFile Fail!!  ecode=%d"), ErrorCode);
			AfxMessageBox(strError);
			return;
		}
		
		ErrorCode = pPsc->PscSelectCorTable(1,0);
		if(ErrorCode)
		{
			strError.Format(_T("LoadCorrectionFile Fail!!  ecode=%d"), ErrorCode);
			AfxMessageBox(strError);		
			return;
		}
	}

	if (pInitialTable->GetKindOfLaser() == 3)	// CO2 mode selected
	{
		ErrorCode = pPsc->PscSetLaserMode(0,3);
		if(ErrorCode)
		{
			strError.Format(_T("SetLaserMode Fail!!  ecode=%d"), ErrorCode);
			AfxMessageBox(strError);		
			return;
		}
		
		ErrorCode = pPsc->PscSetStandby(2000,10);
		if(ErrorCode)
		{
			strError.Format(_T("SetStandby Fail!!  ecode=%d"), ErrorCode);
			AfxMessageBox(strError);		
			return;
		}
		ErrorCode = pPsc->PscSetFirstPulseKiller(0);
		if(ErrorCode)
		{
			strError.Format(_T("SetFirstPulseKiller Fail!!  ecode=%d"), ErrorCode);
			AfxMessageBox(strError);		
			return;
		}
	}
	else	// YAG1,YAG2,YAG3 mode selected
	{
		if(pInitialTable->GetLaser() != LASER_FIBER)
		{
			ErrorCode = pPsc->PscSetLaserMode(0,3);
			if(ErrorCode)
			{
				strError.Format(_T("SetLaserMode Fail!!  ecode=%d"), ErrorCode);
				AfxMessageBox(strError);		
				return;
			}
			
			ErrorCode = pPsc->PscSetStandby(0,0);
			if(ErrorCode)
			{
				strError.Format(_T("SetStandby Fail!!  ecode=%d"), ErrorCode);
				AfxMessageBox(strError);		
				return;
			}
			ErrorCode = pPsc->PscSetFirstPulseKiller(400);
			if(ErrorCode)
			{
				strError.Format(_T("SetFirstPulseKiller Fail!!  ecode=%d"), ErrorCode);
				AfxMessageBox(strError);		
				return;
			}
		}
		else	//IPG Fiber
		{
			ErrorCode = pPsc->PscSetLaserMode(0,2);
			if(ErrorCode)
			{
				strError.Format(_T("SetLaserMode Fail!!  ecode=%d"), ErrorCode);
				AfxMessageBox(strError);		
				return;
			}
			
			ErrorCode = pPsc->PscSetStandby(200,20);	//50KHz, 10%
			if(ErrorCode)
			{
				strError.Format(_T("SetStandby Fail!!  ecode=%d"), ErrorCode);
				AfxMessageBox(strError);		
				return;
			}
			ErrorCode = pPsc->PscSetFirstPulseKiller(0);
			if(ErrorCode)
			{
				strError.Format(_T("SetFirstPulseKiller Fail!!  ecode=%d"), ErrorCode);
				AfxMessageBox(strError);		
				return;
			}
		}
	}

	ErrorCode = pPsc->PscConfigList(MEM1,MEM2);
	if(ErrorCode)
	{
		strError.Format(_T("ConfigList Fail!!  ecode=%d"), ErrorCode);
		AfxMessageBox(strError);		
		return;
	}
	
	ErrorCode = pPsc->PscEnableExtSig(0,0,0);
	if(ErrorCode)
	{
		strError.Format(_T("EnableExtSig Fail!!  ecode=%d"), ErrorCode);
		AfxMessageBox(strError);		
		return;
	}
	
	ErrorCode = pPsc->PscEnableLaser(0,0,0);
	ErrorCode = pPsc->PscSetLaserDelays(2000,2500);	//unit = 100ns

	if (pInitialTable->GetKindOfLaser() == 3)	// CO2 mode selected
		ErrorCode = pPsc->PscSetLaserTiming(0,500,50);	//delay = 0, frequency = 20kHz, duty = 10%
	else if(pInitialTable->GetKindOfLaser() == 0)	// YAG1 mode selected
		ErrorCode = pPsc->PscSetLaserTiming(0,500,50);	//delay = 0, frequency = 20kHz, duty = 10%
	else if(pInitialTable->GetKindOfLaser() == 1)	// YAG2 mode selected
		ErrorCode = pPsc->PscSetLaserTiming(400,500,4);	//delay = 40us, frequency = 20kHz, duty = 400ns
	else if(pInitialTable->GetKindOfLaser() == 2)	// YAG3 mode selected
		ErrorCode = pPsc->PscSetLaserTiming(100,500,50);	//delay = 10us, frequency = 20kHz, duty = 10%
	
	ErrorCode = pPsc->PscSetMarkSpeed(100);
	ErrorCode = pPsc->PscSetJumpSpeed(100);
	ErrorCode = pPsc->PscSetScannerDelays(20,10,20);	//unit = 10us
	ErrorCode = pPsc->PscSetPosition(0,0);
	
	if (pInitialTable->GetKindOfLaser() == 3)	// CO2 mode selected	//Synard C02 10W ¿œ ∞ÊøÏ ∆º≈¨ ∂ßπÆø° 
		ErrorCode = pPsc->PscEnableLaser(0,1,0);

	if (pInitialTable->GetLaser() == LASER_FIBER)	// IPG selected	//PRR ∂ßπÆø° 
		ErrorCode = pPsc->PscEnableLaser(0,0,1);

	unsigned long OldValue,Value;
	pPsc->PscReadOutPort(1,&OldValue);
	Value = OldValue & PSC_PMU_SHUTTER_OFF;		
	pPsc->PscWriteOutPort(1,Value);

	CPointerManager *pPointerManager = pPointerManager->GetInstance();
	Iterator<CParameter*> *iterator = pPointerManager->GetParameterList()->iterator();
	iterator->SetFirst();
	
	while (iterator->HasNext()) {
		
		CParameter *pParameter = iterator->GetCurrentItem();
			if (pParameter->GetIndex()+1 < 10) {
			short ecode;
			float fJumpSpeed = (float)pParameter->GetJumpStep()*100/pParameter->GetStepPeriod();
			float fMarkSpeed = (float)pParameter->GetMarkStep()*100/pParameter->GetStepPeriod(); 
			unsigned long JumpDelay = (unsigned long)pParameter->GetJumpDelay()/10;
			unsigned long PolyDelay = (unsigned long)pParameter->GetStrokeDelay()/10;
			unsigned long MarkDelay = (unsigned long)pParameter->GetMarkDelay()/10 ;
			long OnDelay = (long)pParameter->GetLaserOnDelay()*10;
			unsigned long OffDelay = (unsigned long)pParameter->GetLaserOffDelay()*10;
			unsigned short LaserDelay = 0;
			unsigned long LaserPeriod = (unsigned long)10000/pParameter->GetFrequency();
			unsigned long LaserWidth = (unsigned long)(((10000/pParameter->GetFrequency()) * pParameter->GetPulseWidth())/100);
			
			if(pInitialTable->GetKindOfLaser() == 1)
				LaserDelay = (unsigned short)(pParameter->GetFPS()*10);
			else if(pInitialTable->GetKindOfLaser() == 2)
				LaserDelay = 100;
			
			if(pInitialTable->GetLaser() == 7)	//Laservall
				LaserWidth = (unsigned long)(pParameter->GetPulseWidth()/100);
			
			ecode = pPsc->PscSetMarkParamData(pParameter->GetIndex()+1, fMarkSpeed, fJumpSpeed
				, JumpDelay, PolyDelay, MarkDelay
				, OnDelay, OffDelay
				, LaserDelay, LaserPeriod, LaserWidth);
			
			iterator->SetNext();
		}
		else {
			break;
		}
	}
}

void CMainFrame::OnMenuFontcad()
{
	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp();

	ExixProcessName("HKFontCAD2008.exe");	
	
	TCHAR tcPath[4096];
	
	// «ˆ¿Á ∞Ê∑Œ∏¶ æÚ¥¬¥Ÿ
	GetModuleFileName(NULL, tcPath, 4096);
	
	// µ⁄¬ ¿« ∆ƒ¿œ∏Ì¿ª ªË¡¶«œ∞Ì ∫“∑Øø√ ∆ƒ¿œ∏Ì¿ª ∫Ÿ¿Œ¥Ÿ
	*strrchr(tcPath, '\\') = '\0';
	strcat(tcPath, "\\");
	strcat(tcPath, "HKFontCAD2008.exe");
	
	CString str = tcPath;
	str.Format("%s%s", pApp->m_strCwd, "\\HKFontCAD2008.exe");
	HINSTANCE hi = ShellExecute(NULL/*this->GetSafeHwnd()*/, "open", str, NULL, NULL, SW_SHOW);
	if (int(hi) < 32)
	{
		AfxMessageBox("Can not find HKFontCAD2008");
	}
}

void CMainFrame::ExixProcessName(CString strProcessName)
{
	DWORD aProcesses[1024], cbNeeded, cProcesses;
    unsigned int i;
	
    if( !EnumProcesses( aProcesses, sizeof(aProcesses), &cbNeeded ))
        return;
	
    cProcesses = cbNeeded / sizeof(DWORD);
	
    for ( i = 0; i < cProcesses; i++ )
    {
        char szProcessName[MAX_PATH] = "unknown";
		
        HANDLE hProcess = OpenProcess( PROCESS_QUERY_INFORMATION | PROCESS_VM_READ,
            FALSE, aProcesses[i] );
		
        if (NULL != hProcess )
        {
            HMODULE hMod;
            DWORD cbNeeded;
			
            if ( EnumProcessModules( hProcess, &hMod, sizeof(hMod), &cbNeeded) )

            {
                GetModuleBaseName( hProcess, hMod, szProcessName, sizeof(szProcessName) );
            }
        }
		
        bool bRet;
        if(strcmp(szProcessName,(LPSTR)(LPCTSTR)strProcessName)==0)
        {
			HANDLE hProcess = NULL;
			
			hProcess = ::OpenProcess(PROCESS_ALL_ACCESS, FALSE, aProcesses[i]);
			if(hProcess != NULL)
			{        
				DWORD    ExitCode = 0;
				GetExitCodeProcess( hProcess, &ExitCode );
				bRet = ::TerminateProcess(hProcess, ExitCode );                
				if( bRet )
				{
					::WaitForSingleObject(hProcess, INFINITE);
				} 
				
				::CloseHandle(hProcess);
			}
		}
		CloseHandle( hProcess );
    }
}

void CMainFrame::OnHatch()
{
	if(dlgMsg == NULL)
	{
		dlgMsg = new CDlgMsgDC;
		dlgMsg->Create(this);
	}
	dlgMsg->ShowWindow(SW_SHOW);
	dlgMsg->SetMessage("Device Change...");
	
	CMKObjectApproacher *pMKObjectApproacher = CPointerContainer::GetApproacher();
	CMKObject *pObject;
	int pos = 0;
	pObject = pMKObjectApproacher->GetFirst(pos);	
	while( pObject != NULL)
	{
		pObject->Refresh();
		pObject = pMKObjectApproacher->GetNext(pos);
	}
	
	dlgMsg->ClearMessage();
	dlgMsg->ShowWindow(SW_HIDE);
	delete dlgMsg;
	dlgMsg = NULL;
}

void CMainFrame::OnHardwareTest() 
{
	// TODO: Add your command handler code here
	CDlgHardwareTest hardwareTest;

	hardwareTest.DoModal();
}

void CMainFrame::ExitApp()
{
	ASSERT(AfxGetApp()->m_pMainWnd != NULL);
	AfxGetApp()->m_pMainWnd->SendMessage(WM_CLOSE);
}


BOOL CMainFrame::ProcessKill(void)
{
	
	return 0;
}


void CMainFrame::OnSize(UINT nType, int cx, int cy)
{
	CFrameWnd::OnSize(nType, cx, cy);
	CRect cr;
	GetWindowRect(&cr);
	if(m_wndSplitterVer && nType != SIZE_MINIMIZED)
	{
		//m_wndSplitterHor.SetRowInfo(0, cy, 0);
		//m_wndSplitterHor.SetColumnInfo(0, cr.Width()/2, 50);
		//m_wndSplitterVer.SetColumnInfo(1, cr.Width()/2, 50);
		

		//∫–«“¿©µµøÏ ªÁ¿Ã¡Ó ∫Ø∞Ê«œ¥¬∞˜
		//CRect rect;
		//GetClientRect(&rect);
		//m_wndSplitterVer.SetRowInfo(0, MulDiv(rect.Height(), 50, 100), 10);

		m_wndSplitterHor.SetColumnInfo(0, cx - 400 , 10);//ø¿∏•¬  ¿©µµøÏ ≥–¿Ã¡∂¿˝
		m_wndSplitterHor.SetColumnInfo(1, cx , 10);// «œ¿ß ¿©µµøÏ ≥–¿Ã ¡∂¿˝
		//m_wndSplitterVer.SetRowInfo(0, cy - 400, 10);
		//m_wndSplitterVer.SetRowInfo(0, cy - 509, 10); //«œ¿ß ¿©µµøÏ ≥Ù¿Ã ¡∂¿˝ 
		//m_wndSplitterVer.SetRowInfo(0, cy - 383, 10); // -----------2019-07-11 ¿ÂπŒ±π------------
		m_wndSplitterVer.SetRowInfo(0, cy - 500, 10); // -----------2020 12 4 jjsjong ------------
		m_wndSplitterVer.SetRowInfo(1, cy, 10);
		


		m_wndSplitterHor.RecalcLayout();
		m_wndSplitterVer.RecalcLayout();

	}




}


void CMainFrame::OnNewData()
{
	// TODO: ø©±‚ø° ∏Ì∑… √≥∏Æ±‚ ƒ⁄µÂ∏¶ √ﬂ∞°«’¥œ¥Ÿ.
	CDlgKoemData dlg;

	dlg.DoModal();
}


void CMainFrame::OnUpdateNewData(CCmdUI *pCmdUI)
{
	// TODO: ø©±‚ø° ∏Ì∑… æ˜µ•¿Ã∆Æ UI √≥∏Æ±‚ ƒ⁄µÂ∏¶ √ﬂ∞°«’¥œ¥Ÿ.
}


void CMainFrame::UpdateSplitterWindow(void)
{
	//m_wndSplitterHor.SetColumnInfo(0, cx - 400 , 10);// «œ¿ß ¿©µµøÏ ≥Ù¿Ã ¡∂¿˝
	//m_wndSplitterHor.SetColumnInfo(1, cx , 10);
	//m_wndSplitterVer.SetRowInfo(0, cy - 400, 10);
	//m_wndSplitterVer.SetRowInfo(1, cy, 10);



	/*	m_wndSplitterHor.SetColumnInfo(0, cx - 400 , 10);
	m_wndSplitterHor.SetColumnInfo(1, cx , 10);
	m_wndSplitterVer.SetRowInfo(0, cy - 300, 10);
	m_wndSplitterVer.SetRowInfo(1, cy, 10);
	*/

	//m_wndSplitterHor.RecalcLayout();
	//m_wndSplitterVer.RecalcLayout();
	//GetActiveView()->SendMessage(WM_UPDATE_PATTERN_VIEW, 100,100);
	CPointerContainer::GetGraphView()->UpdatePatternView();
	//CPointerContainer::GetGraphView()->SendMessage(WM_UPDATE_PATTERN_VIEW, 100,100);
}


void CMainFrame::UpdateScannerPos()
{
	CPointerContainer::GetGraphView()->UpdateScannerPos();
}

void CMainFrame::SavePatternCycleImageLog()
{
	//CPointerContainer::GetGraphView()->m_csTabPatternView.m_Patternview.SavePatternImage();
}


void CMainFrame::DisplayMessage(CString strMessage)
{

	if(dlgMsg == NULL)
	{
		dlgMsg = new CDlgMsgDC;
		dlgMsg->Create(this);
	}
	dlgMsg->ShowWindow(SW_SHOW);
	dlgMsg->SetMessage(strMessage);
	//SetDelayTime(1000);
	//dlgMsg->ClearMessage();
	//dlgMsg->ShowWindow(SW_HIDE);
	//delete dlgMsg;
	//dlgMsg = NULL;
}


void CMainFrame::HideMessage(void)
{
	if(dlgMsg == NULL)
	{
		dlgMsg = new CDlgMsgDC;
		dlgMsg->Create(this);
	}
	dlgMsg->ClearMessage();
	dlgMsg->ShowWindow(SW_HIDE);
	delete dlgMsg;
	dlgMsg = NULL;
}

//
//void CMainFrame::OnMenuIo()
//{
//	CDlgRTC Dlg;
//	Dlg.DoModal();
//}


void CMainFrame::OnMenuIo()
{
	// TODO: ø©±‚ø° ∏Ì∑… √≥∏Æ±‚ ƒ⁄µÂ∏¶ √ﬂ∞°«’¥œ¥Ÿ.
	CDlgRTC Dlg;
	Dlg.DoModal();
}


void CMainFrame::MakePattern(void)
{
	//20180906 jjsjont Int«¸¿ª Double∑Œ ∞ËªÍ«œµµ∑œ ºˆ¡§.
	CMKObjectApproacher *pApprocher = CPointerContainer::GetApproacher();
	CMKObjectManager *pObjMng = CMKObjectManager::Instance();
	CMKObjectHandler::Instance()->Clear();
	pObjMng->ClearAll();


	CBeamEditor6App* pApp = (CBeamEditor6App *)AfxGetApp();
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CFieldParameter *pFieldParameter = pFieldParameter->GetInstance();
	int iMmSize, iFieldSize;
	pFieldParameter->GetSize(&iMmSize, &iFieldSize);
	double m_dMaxField;
	double m_dMaxMM;

	m_dMaxField = (double)iFieldSize;
	m_dMaxMM    = (double)iMmSize;

	CStdioFile File;
	CString OutStr;
	CString PltFile;
	CString strTemp;
	static char BASED_CODE szFilter[] = "Plt Files (*.plt)|*.plt|All Files (*.*)|*.*||";
	CFileDialog dlg(
		FALSE,
		"plt",
		PltFile,
		OFN_HIDEREADONLY|OFN_OVERWRITEPROMPT,
		szFilter,
		NULL);
	CString SaveFile;
	CInitialTable *pInitialTable = pInitialTable->GetInstance();
	SaveFile = pInitialTable->GetSpecImgFolder();
	//PltFile = "D:\\KOEM.PLT";
	TCHAR lpszName[256];
	TCHAR lpszExt[256];
	char drive[_MAX_DRIVE], dir[_MAX_DIR];
	_splitpath((LPCTSTR)pDoc->m_CurfileName, drive, dir, lpszName, lpszExt);
	PltFile.Format(_T("%s\\Logo\\%s.PLT "), SaveFile, lpszName);

	if (!File.Open(PltFile, CFile::modeCreate|CFile::modeWrite|CFile::typeText))
	{
		AfxMessageBox("Unable To Open Image File!");
		return;
	}


	OutStr.Format("KOEM;");
	File.WriteString(OutStr);

	CDPoint p0, p1, p, p2,p3,p4,p5, p6;
	int tempx,tempy, tempx2,tempy2;
	int nheightField = 20; /* Device Hight */
	int nWidthField  = 80;
	int nBaseCutWidthField = 0;
	int nStartOffset = 100;
	float m_Angle = 0;
	float angle = (m_Angle  / 180.0f) * M_PI;
	float dx,dy;
	float fradius_LT,fradius_LB,fradius_RT,fradius_RB,fExpendDist,fLeftCtrlPoint1,fLeftCtrlPoint2,fRightCtrlPoint1,fRightCtrlPoint2;
	float fLeft_sloop_angle,fRight_sloop_angle,fLeft_sloop_angle_degree,fRight_sloop_angle_degree,fBaserCutWidth,fWidth,fHeight;
	
	m_stPatternDataOfKoem = pFieldParameter->GetPatternDataOfKoem();

	/*
	GetDlgItemText(IDC_EDIT_WIDTH, strTemp); fWidth = atof(strTemp);
	GetDlgItemText(IDC_EDIT_HEIGHT, strTemp); fHeight = atof(strTemp);
	GetDlgItemText(IDC_EDIT_CUTWIDTH_BASE, strTemp); fBaserCutWidth = atof(strTemp);

	// 2019.01.29  LEFT PARA RIGHT PARA πŸ≤ﬁ. ƒø∆√∆–≈œ¿∏∑Œ ¡¬/øÏ∑Œ ¿˚øÎµ«π«∑Œ ºø∏æﬂ¿∫ ¡¬/øÏ∞° πŸ≤Óπ«∑Œ......
	// Org /
	GetDlgItemText(IDC_EDIT_RADIUS_LT, strTemp); fradius_LT = atof(strTemp);
	GetDlgItemText(IDC_EDIT_RADIUS_LB, strTemp); fradius_LB = atof(strTemp);
	GetDlgItemText(IDC_EDIT_RADIUS_RT, strTemp); fradius_RT = atof(strTemp);
	GetDlgItemText(IDC_EDIT_RADIUS_RB, strTemp); fradius_RB = atof(strTemp);

	GetDlgItemText(IDC_EDIT_EXPEND_DIS, strTemp); fExpendDist = atof(strTemp);

	GetDlgItemText(IDC_EDIT_LEFT_CTRLPOINT1, strTemp); fLeftCtrlPoint1 = atof(strTemp);
	GetDlgItemText(IDC_EDIT_LEFT_CTRLPOINT2, strTemp); fLeftCtrlPoint2 = atof(strTemp);
	GetDlgItemText(IDC_EDIT_RIGHT_CTRLPOINT1, strTemp); fRightCtrlPoint1 = atof(strTemp);
	GetDlgItemText(IDC_EDIT_RIGHT_CTRLPOINT2, strTemp); fRightCtrlPoint2 = atof(strTemp);
	*/
	fBaserCutWidth = m_stPatternDataOfKoem.dBaseCutWidth;
	fHeight = m_stPatternDataOfKoem.dHeight;
	fWidth = m_stPatternDataOfKoem.dWidth;
	fradius_LT = m_stPatternDataOfKoem.dLT_Radius;
	fradius_LB = m_stPatternDataOfKoem.dLB_Radius;
	fradius_RT = m_stPatternDataOfKoem.dRT_Radius;
	fradius_RB = m_stPatternDataOfKoem.dRB_Radius;
	fExpendDist = m_stPatternDataOfKoem.dExpendDist;
	fLeft_sloop_angle = m_stPatternDataOfKoem.dLeftSloopAngle;
	fRight_sloop_angle = m_stPatternDataOfKoem.dRightSloopAngle;
	fLeftCtrlPoint1 = m_stPatternDataOfKoem.dLeftCtrlPoint1;
	fLeftCtrlPoint2 = m_stPatternDataOfKoem.dLeftCtrlPoint2;
	fRightCtrlPoint1 = m_stPatternDataOfKoem.dRightCtrlPoint1;
	fRightCtrlPoint2 = m_stPatternDataOfKoem.dRightCtrlPoint2;



	nBaseCutWidthField = fBaserCutWidth * m_dMaxField / m_dMaxMM;
	nheightField = fHeight * m_dMaxField / m_dMaxMM;
	nWidthField  = fWidth  * m_dMaxField / m_dMaxMM;
	nStartOffset = nStartOffset * m_dMaxField / m_dMaxMM;
	fradius_LT  = fradius_LT  * m_dMaxField / m_dMaxMM;
	fradius_LB  = fradius_LB  * m_dMaxField / m_dMaxMM;
	fradius_RT  = fradius_RT  * m_dMaxField / m_dMaxMM;
	fradius_RB  = fradius_RB  * m_dMaxField / m_dMaxMM;

	fExpendDist = fExpendDist * m_dMaxField / m_dMaxMM;

	//fradius_LT = floor(fradius_LT);
	//fradius_LB = floor(fradius_LB);
	//fradius_RT = floor(fradius_RT);
	//fradius_RB = floor(fradius_RB);

	fradius_LT = (fradius_LT);
	fradius_LB = (fradius_LB);
	fradius_RT = (fradius_RT);
	fradius_RB = (fradius_RB);

	if(m_stPatternDataOfKoem.dRightCtrlPoint1 > 0 || m_stPatternDataOfKoem.dRightCtrlPoint2 > 0)
		fradius_RT = 0;
	if(m_stPatternDataOfKoem.dLeftCtrlPoint1 > 0 || m_stPatternDataOfKoem.dLeftCtrlPoint2 > 0)
		fradius_LT = 0;

	float fBtweenOfAngle1 = 0; //µŒº±∫–¿« ∞¢µµ
	float fBtweenOfAngle2 = 0; //µŒº±∫–¿« ∞¢µµ
	float fBtweenOfAngle3 = 0; //µŒº±∫–¿« ∞¢µµ
	float fBtweenOfAngle4 = 0; //µŒº±∫–¿« ∞¢µµ

	float segment1 = 0;
	float segment2 = 0;
	float segment3 = 0;
	float segment4 = 0;


	//2019.01.03 jjsjong test HPGL DATAª˝º∫ ±‚∫ª¿ª BaserCutWidth∑Œ ¿˚øÎ«ÿ∫∏±‚
	nWidthField = nBaseCutWidthField;


	
	//GetDlgItemText(IDC_EDIT_SLOOP_ANGLE_L, strTemp);
	//2018.09.06 jjsjong 
	//if(atof(strTemp) > 0)
	//	fLeft_sloop_angle = atof(strTemp);
	//else 
	//	fLeft_sloop_angle = 0;

	fLeft_sloop_angle = 90 - fLeft_sloop_angle;

	//GetDlgItemText(IDC_EDIT_SLOOP_ANGLE_R, strTemp);
	//if(atof(strTemp) > 0)
	//	fRight_sloop_angle = atof(strTemp);
	//else 
	//	fRight_sloop_angle = 0;

	fRight_sloop_angle = 90 - fRight_sloop_angle;



	fLeft_sloop_angle = (fLeft_sloop_angle  / 180.0f) * M_PI;// ∞¢µµ∏¶ ∂Ûµæ»¿∏∑Œ »ØªÍ
	fLeft_sloop_angle_degree = fLeft_sloop_angle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	angle = fLeft_sloop_angle;

	fRight_sloop_angle = (fRight_sloop_angle  / 180.0f) * M_PI;// ∞¢µµ∏¶ ∂Ûµæ»¿∏∑Œ »ØªÍ
	fRight_sloop_angle_degree = fRight_sloop_angle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	angle = fRight_sloop_angle;


	POINT centerPoint;
	centerPoint.x = 0; centerPoint.y = 0;

	tempx = nheightField * tan(fLeft_sloop_angle);
	tempx2 = nheightField * tan(fRight_sloop_angle);



	p.x = fradius_LT;
	p.y = nheightField;

	p1.x = p.x - fradius_LT;
	p1.y = p.y ;

	p2.x = p.x + tempx;
	p2.y = p.y - nheightField;

	//2018.12.26 jjsjong 
	//if(fradius_RB==0)
	//	p3.x = p2.x + (nWidth - tempx2/4) ;
	//else
	//	p3.x = p2.x + (nWidth - tempx2/4);


	if(fradius_RB==0)
		p3.x = p2.x + nWidthField;
	else
	{
		p3.x = p2.x + nWidthField;
	}

	//if(fradius_LT <= 0)
	//	p3.x = p2.x + nWidth;
	//else
	//	p3.x = p2.x + (nWidth - (tempx1/2));

	p3.y = p2.y;

	//tempx = nheight * tan(fLeft_sloop_angle);
	p4.x = p3.x + tempx2;
	p4.y = p3.y + nheightField;

	p5.x = p4.x + fradius_RT;
	p5.y = p4.y ;
	


//--------------------------- R∞™ π◊ Sloop ∞¢µµ º≥¡§ø° µ˚∏• ±‚∫ª ƒø∆√∂Û¿Œ ±Ê¿Ã ¿Á∞ËªÍ ¿˚øÎ ----------------------------------//

	fBtweenOfAngle1 = -(atan2f (p.y - p1.y, p.x - p1.x) - atan2f (p.y - p2.y, p.x - p2.x));
	fBtweenOfAngle2 = -(atan2f (p2.y - p.y, p2.x - p.x) - atan2f (p2.y - p3.y, p2.x - p3.x));
	fBtweenOfAngle3 = -(atan2f (p3.y - p4.y, p3.x - p4.x) - atan2f (p3.y - p2.y, p3.x - p2.x));
	fBtweenOfAngle4 = -(atan2f (p4.y - p3.y, p4.x - p3.x) - atan2f (p4.y - p5.y, p4.x - p5.x));

	segment1 = fradius_LT / fabsf (tanf (fBtweenOfAngle1 / 2));
	segment2 = fradius_LB / fabsf (tanf (fBtweenOfAngle2 / 2));
	segment3 = fradius_RB / fabsf (tanf (fBtweenOfAngle3 / 2));
	segment4 = fradius_RT / fabsf (tanf (fBtweenOfAngle4 / 2));


	if(fradius_RB==0)
		p3.x = p2.x + nWidthField;
	else
	{
		p3.x = (p2.x + segment2) + nWidthField + segment3;
	}


	p4.x = p3.x + tempx2;
	p4.y = p3.y + nheightField;

	p5.x = p4.x + fradius_RT;
	p5.y = p4.y ;


//-------------------------------------------------------------------------------------------------------------------------------//

	
	//--------------------------------------------- Left Sloop Angle ¿˚øÎ -----------------------------------------------------

	

	// ****  2 ***************************
	// 2.get vectors from points and angle between vectors: ******
	fBtweenOfAngle1 = -(atan2f (p.y - p1.y, p.x - p1.x) - atan2f (p.y - p2.y, p.x - p2.x));
	fBtweenOfAngle2 = -(atan2f (p2.y - p.y, p2.x - p.x) - atan2f (p2.y - p3.y, p2.x - p3.x));
	fBtweenOfAngle3 = -(atan2f (p3.y - p4.y, p3.x - p4.x) - atan2f (p3.y - p2.y, p3.x - p2.x));
	fBtweenOfAngle4 = -(atan2f (p4.y - p3.y, p4.x - p3.x) - atan2f (p4.y - p5.y, p4.x - p5.x));

	segment1 = fradius_LT / fabsf (tanf (fBtweenOfAngle1 / 2));
	segment2 = fradius_LB / fabsf (tanf (fBtweenOfAngle2 / 2));
	segment3 = fradius_RB / fabsf (tanf (fBtweenOfAngle3 / 2));
	segment4 = fradius_RT / fabsf (tanf (fBtweenOfAngle4 / 2));

	float tempangle =  fBtweenOfAngle1 * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	// Distance ±∏«œ±‚ ¬¸¡∂	
	//m_fDegree = atan2f( (float)B.y - A.y, (float)B.x - A.x ) * 180 / 3.1415f;
	//m_iXDist = cos( m_fDegree ) * 10;//πÿ∫Ø¿Ã 10¿œãö
	//m_iYDist = sin( m_fDegree ) * 10;

	// ********** 3 ~ 4  *********
	//3. Get the length of segment between angular point and the points of intersection with the circle.
	//4. Here you need to check the length of segment and the minimal length from PP1 and PP2:
	//segment = PC1 = PC2 = radius / |tan(angle / 2)|
	//Length of PP1:
	//PP1 = sqrt((PX - P1X)2 + (PY - P1Y)2)
	//Length of PP2:
	//PP2 = sqrt((PX - P2X)2 + (PY - P2Y)2)

	float distance = sqrt(pow((double)p1.x - (double)p2.x, 2) + pow((double)p1.y - (double)p2.y, 2));


	// ≈´¡¬«•ø°º≠ ¿€¿∫¡¬«•∏¶ ª©æﬂ«“∞ÊøÏ∏∏ ø¯«œ¥¬ ∞™ ≥™ø≈
	//float p_p1 = sqrtf (sqrt (p.x - p1.x) + sqrt(p.y - p1.y));
	//float p_p2 = sqrtf (sqrt (p.x - p2.x) + sqrt (p.y - p2.y));

	// ªÛ∞¸æ¯¿Ã ∞≈∏Æ ∞ËªÍµ .
	//Length of p_p1 & p_p2
	float p_p1 = sqrt(pow((double)p1.x - (double)p.x, 2) + pow((double)p1.y - (double)p.y, 2));
	float p_p2 = sqrt(pow((double)p.x - (double)p2.x, 2) + pow((double)p.y - (double)p2.y, 2));
	float p2_p3 = sqrt(pow((double)p2.x - (double)p3.x, 2) + pow((double)p2.y - (double)p3.y, 2));
	float p3_p4 = sqrt(pow((double)p3.x - (double)p4.x, 2) + pow((double)p3.y - (double)p4.y, 2));
	float p4_p5 = sqrt(pow((double)p4.x - (double)p5.x, 2) + pow((double)p4.y - (double)p5.y, 2));


	//float segment1 = fradius_LT / fabsf (tanf (fBtweenOfAngle1 / 2));
	//float segment2 = fradius_LB / fabsf (tanf (fBtweenOfAngle2 / 2));
	//float segment3 = fradius_RB / fabsf (tanf (fBtweenOfAngle3 / 2));
	//float segment4 = fradius_RT / fabsf (tanf (fBtweenOfAngle4 / 2));

	float p_c1 = segment1;
	float p_c2 = segment1;


	float p2_c3 = segment2;
	float p2_c4 = segment2;
	
	
	float p3_c5 = segment3;
	float p3_c6 = segment3;


	float p4_c7 = segment4;
	float p4_c8 = segment4;

	//If segment > PP1 or segment > PP2 then you need to decrease the radius:
	float min = MIN(p_p1, p_p2);
	if (segment1 > min) {
		segment1 = min;
		fradius_LT = segment1 * fabsf (tanf (fBtweenOfAngle1 / 2));
	}

	/*
	5. Get the length of PO:
	PO = sqrt(radius^ + segment^)
	*/
	float p_o = sqrtf (sqrt (fradius_LT) + sqrt (segment1));
	/*
	6. Get the C1X and C1Y by the proportion between the coordinates of the vector, length of vector and the length 
	of the segment.

	Proportion:
	(PX - C1X) / (PX - P1X) = PC1 / PP1
	So:
	C1X = PX - (PX - P1X) * PC1 / PP1
	The same for C1Y:
	C1Y = PY - (PY - P1Y) * PC1 / PP1
	*/
	CPoint c1;
	c1.x =  p.x - (p.x - p1.x) * p_c1 / p_p1;
	c1.y =  p.y - (p.y - p1.y) * p_c1 / p_p1;

	CPoint c_temp1;
	c_temp1.x = cos( (double)-90 ) * fradius_LT;//πÿ∫Ø¿Ã radius ¿œãö
	c_temp1.y = sin( (double)-90 ) * fradius_LT;//πÿ∫Ø¿Ã radius ¿œãö
	// m_iYDist = sin( m_fDegree ) * 10;
	c_temp1.x = p.x + cos((double)-90) * fradius_LT;
	c_temp1.y = p.y + sin((double)-90) * fradius_LT;



	CPoint *points_circle = new CPoint[360]; 
	CPoint c_temp3;
	int i = -90;

	CPoint c2;
	c2.x = p.x - (p.x - p2.x) * p_c2 / p_p2;
	c2.y = p.y - (p.y - p2.y) * p_c2 / p_p2;

	CPoint c_temp2;
	c_temp2.x = c2.x + cos((double)-90) * fradius_LT;
	c_temp2.y = c2.y + sin((double)-90) * fradius_LT;


	/*
	8. Now you can use the addition of vectors PC1 and PC2 to find the centre of circle by the same way by proportion.
	*/

	dx = p.x * 2 - c1.x - c2.x;
	dy = p.y * 2 - c1.y - c2.y;

	float p_c = sqrtf (sqrt (dx) + sqrt (dy));

	/*********************** ±‚øÔ±‚øÕ «—¡°¿Ã ¡÷æÓ¡≥¿ª∂ß µø¿œ«— ∞≈∏Æ∏∏≈≠ ∂≥æÓ¡¯ µŒ¡° ±∏«œ±‚  **************************************
	1. øÏº± ±‚øÔ±‚∞° M¿Ã∞Ì ¿”¿«¿« ¡° P(PX, PY)∏¶ ¡ˆ≥™¥¬ ¡˜º±¿« πÊ¡§Ωƒ
	¡˜º±¿« πÊ¡§Ωƒ¿ª y=ax + b ∂Û∞Ì «œ∏È,
	PY = M * PX + b
	b = PY - (M * PX)
	°≈ y = Mx + (PY - (M * PX)) ........ (∞°)

	2. ¿ÃæÓº≠ ¡°∞˙ ¡˜º±ªÁ¿Ã¿« ∞≈∏Æ
	æÓ∂≤ ¡° N(x,y)øÕ P(PX, PY) ªÁ¿Ã¿« ∞≈∏Æ∏¶ T∂Û «œ∏È 
	T = °Ó(PX-x)©˜ + (PY-y)©˜
	T©˜ = (PX-x)©˜ + (PY-y)©˜ ............(≥™)

	3. N¿∫ (∞°)¿« ¡˜º±ø° º”«œ¥¬ ¡°¿Ã¥Ÿ. ±◊∑°º≠ (≥™)Ωƒ¿ª «Æ∏È
	T©˜ = PX©˜ - 2PXx + x©˜ + PY©˜ - 2PYy + y©˜ (¥ÎπÆ¿⁄∞° ø¨¿ÃæÓ ¿÷¥¬∞Õ¿∫ ∞ˆº¿¿Ã æ∆¥œ∂Û «œ≥™¿« ªÛºˆ¿‘¥œ¥Ÿ.)
	(∞°)Ωƒ¿« y∏¶ «ÆæÓ¡¯ (≥™)ø° ¥Î¿‘«œ∏È..

	T©˜ = PX©˜ - 2PXx + x©˜ + PY©˜ - 2PY * (Mx + (PY - (M * PX))) + (Mx + (PY - (M * PX)))©˜

	æÀæ∆ ∫∏±‚ Ω±∞‘ ªÛºˆ∏¶ ¡§∏Æ«ÿ ∫∏∞⁄¥Ÿ.

	a = T©˜
	b = PX
	c = PY
	d = PY - (M * PX)

	±◊∑Ø∏È

	a©˜ = b©˜ - 2bx + x©˜ + c©˜ - 2c * (Mx + d) + (Mx + d)©˜

	a©˜ = b©˜ - 2bx + x©˜ + c©˜ - 2cMx - 2cd + (Mx)©˜ + 2dMx + d©˜

	¿ß Ωƒø°º≠ øÏ∫Ø¿ª 0¿∏∑Œ ∏∏µÈ∏È..

	(M©˜+1)x©˜ + (2dM - 2b - 2cM)x + (b©˜ + c©˜ - 2cd + d©˜ - a©˜) = 0

	¿Ã∑∏∞‘ «ÿº≠ Ax©˜ + Bx + C = 0 ¿« «¸≈¬∏¶ ∏∏µÈ∞Ì, 
	±Ÿ¿« ∞¯Ωƒ¿Œ

	x = -B °æ °ÓB©˜ - 4AC / 2A

	ø° ≥÷æÓ x∏¶ ±∏«œ∞Ì ¿Ã x∏¶ (∞°)Ωƒø° ≥÷æÓ y∏¶ ±∏«—¥Ÿ. */

	float M,A,B,C,D,x1,x2,y1,y2,T;
	int PX,PY;
	//M = ±‚øÔ±‚
	//PX = ¡÷æÓ¡¯ ¡°¿« X¡¬«•
	//PY = ¡÷æÓ¡¯ ¡°¿« Y¡¬«•
	//T = ¡÷æÓ¡¯ ¡°¿∏∑Œ ∫Œ≈Õ ∂≥æÓ¡¯ ∞≈∏Æ

	//-------------------------------------c1, c2------------------------------------------------------------------------------------------
	PX = p.x; 
	PY = p.y;
	T = segment1;


	dx = segment1 * sin(fLeft_sloop_angle);
	dy = segment1 * cos(fLeft_sloop_angle);

	c1.x = p.x - segment1;
	c1.y = p.y;

	c2.x = p.x +  dx;
	c2.y = p.y -  dy;




	//--------------------------------------c3, c4------------------------------------------------------------------------------------------
	CPoint c3,c4;

	PX = p2.x; 
	PY = p2.y;
	T = segment2;
	M = (p.y - p2.y) / (p.x - p2.x);//±‚øÔ±‚ : Y¡ı∞°∑Æ / X¡ı∞°∑Æ

	dx = (p_p2 - segment2) * sin(fLeft_sloop_angle);
	dy = (p_p2 - segment2) * cos(fLeft_sloop_angle);

	c3.x = p.x +  dx;
	c3.y = p.y -  dy;

	c4.x = PX + segment2;
	c4.y = PY;


	//--------------------------------------c5, c6 ------------------------------------------------------------------------------------------------------
	CPoint c5,c6;

	PX = p3.x; 
	PY = p3.y;
	T = segment3;

	dx = segment3 * sin(fRight_sloop_angle);
	dy = segment3 * cos(fRight_sloop_angle);

	c5.x = p3.x - segment3;
	c5.y = p3.y;

	c6.x = p3.x + dx;
	c6.y = p3.y + dy;
	

	//--------------------------------------c7, c8 ------------------------------------------------------------------------------------------------------
	CPoint c7,c8;

	//float dx,dy;

	PX = p4.x; 
	PY = p4.y;
	T = segment4;

	dx = (p3_p4 - segment4) * sin(fRight_sloop_angle);
	dy = (p3_p4 - segment4) * cos(fRight_sloop_angle);

	c7.x = p3.x + dx;
	c7.y = p3.y + dy;

	c8.x = p4.x + segment4;
	c8.y = p4.y;
	//----------------------------------------------------------------------------------------------------------------------------------------------------

	CPoint o,o2,o3,o4;
	o.x = c1.x;
	o.y = c1.y - fradius_LT;

	o2.x = c4.x;
	o2.y = c4.y + fradius_LB;

	o3.x = c5.x;
	o3.y = c5.y + fradius_RB;
	
	o4.x = c8.x;
	o4.y = c8.y - fradius_RT;


	//2018.10.04 jjsjong
	//-------------------------------------------------------------------------------------------------------------------------------------------------------
	if(fExpendDist > 0)
	{
		if(fradius_LT >0 && fradius_RT >0)
		{
			/*p0.x = p1.x - fExpendDist;
			p0.y = p1.y + fExpendDist*0.05;

			p6.x = p5.x + fExpendDist;
			p6.y = p5.y + fExpendDist*0.05;*/

			p0.x = c1.x - fExpendDist;
			p0.y = c1.y + fExpendDist;

			p6.x = c8.x + fExpendDist;
			p6.y = c8.y + fExpendDist;
		}
		else if(fradius_LT >0 && fradius_RT <=0)
		{
			p0.x = c1.x - fExpendDist;
			//p0.x = p1.x - fExpendDist;
			p0.y = p1.y + fExpendDist;

			dx = fExpendDist * sin(fRight_sloop_angle);
			dy = fExpendDist * cos(fRight_sloop_angle);


			p6.x = p4.x + dx;
			p6.y = p4.y + dy;
		}
		else if(fradius_LT <=0 && fradius_RT >0)
		{
			dx = fExpendDist * sin(fLeft_sloop_angle);
			dy = fExpendDist * cos(fLeft_sloop_angle);

			p0.x = p.x - dx;
			p0.y = p.y + dy;

			p6.x = p5.x + fExpendDist;
			p6.y = p5.y + fExpendDist;
			/*p6.x = c8.x + fExpendDist;
			p6.y = c8.y + fExpendDist*0.05;*/
		}
		else if(fradius_LT <=0 && fradius_RT <=0)
		{
			dx = fExpendDist * sin(fLeft_sloop_angle);
			dy = fExpendDist * cos(fLeft_sloop_angle);

			p0.x = p.x - dx;
			p0.y = p.y + dy;
			
			dx = fExpendDist * sin(fRight_sloop_angle);
			dy = fExpendDist * cos(fRight_sloop_angle);


			p6.x = p4.x + dx;
			p6.y = p4.y + dy;

		}

		//---------2019.02.07 Extended Position Y ¿ßƒ°∏¶ ∏¬√Á¡‹.
		//if(p0.y > p6) p6

	}
	else
	{
		p0.x = p1.x = o.x;
		p0.y = p1.y;



		p6.x = p5.x = o4.x;
		p6.y = p5.y;

	}


	//--------------------------------------------------------------------------------------------------------------------------------------------------------


	/*
	9.Here you can draw an arc. For this you need to get start angle and end angle of arc:
	*/
	//float start_angle = Positive_angle (atan2f ((c1.y - o.y), (c1.x - o.x)));
	//float end_angle = Positive_angle (atan2f ((c2.y - o.y), (c2.x - o.x)));
	float start_angle =  (atan2f ((c2.y - o.y), (c2.x - o.x)));
	float end_angle =  (atan2f ((c1.y - o.y), (c1.x - o.x)));

	/*
	10.At last you need to get a sweep angle and make some checks for it:
	*/

	//Sweep angle
	float sweepAngle = end_angle - start_angle;

	//Some additional checks
	//if (sweepAngle < 0)
	{
		start_angle = end_angle;
		sweepAngle = -sweepAngle;
	}

	if (sweepAngle > M_PI) //sweepAngle > 180 ?    
		sweepAngle = M_PI - sweepAngle; //sweepAngle = 180 - sweepAngle

	///Point µ•¿Ã≈Õ ª˝º∫ ----------------------------------------------------------


	float start_angle2 =  start_angle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	float end_angle2 =  end_angle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	float sweepAngle2 =  sweepAngle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ


	float degreeFactor = 0.5;
	int pointsCount = (int)abs(sweepAngle2 * degreeFactor);
	//CDPoint *points = new CDPoint[pointsCount]; 
	CDPoint *points = new CDPoint[100000]; 
	CDPoint circleRadius;
	
	//memset(points,NULL, sizeof(CDPoint)*pointsCount;

double d_x, d_y, d_x1, d_y1;
	circleRadius.x = o.x;
	circleRadius.y = o.y;
	
	points[0].x = p1.x;
	points[0].y = p1.y;

	
	//------------------------------ LEFT Control Point 1-----------------------------------------//
	C_POINT controlP[4]={
	10,10,	200, 100,	400,400,	500,500};

	if(fradius_LB > 0) 
	{
		controlP[3].x = c2.x;
		controlP[3].y = c2.y;

		controlP[2].x = c2.x;
		controlP[2].y = c2.y - (c2.y * fLeftCtrlPoint2/100.0);

		controlP[1].x = c3.x - (p_p2 * fLeftCtrlPoint1/500.0);
		controlP[1].y = c3.y;

		controlP[0].x = c3.x;
		controlP[0].y = c3.y;

	
	}
	else
	{
		controlP[3].x = p.x;
		controlP[3].y = p.y;

		controlP[2].x = p.x;
		controlP[2].y = p.y - (p.y * fLeftCtrlPoint2/100.0);

		controlP[1].x = p2.x - (p_p2 * fLeftCtrlPoint1/500.0);
		controlP[1].y = p2.y;

		controlP[0].x = p2.x;
		controlP[0].y = p2.y;
	}
	//---------------------------------------------------------------------------------------------------------------------

	double count = 0.0;
	
	if(fExpendDist > 0)
	{
		if(fLeftCtrlPoint1 <= 0 && fLeftCtrlPoint2 <= 0)
		{
			d_x = p0.x; 
			d_y = p0.y;

			OutStr.Format("PU;PA%05d,%05d;",(int)d_x , (int)d_y );
			File.WriteString(OutStr);

			d_x = p1.x;
			d_y = p1.y;

			OutStr.Format("PD;PA%05d,%05d;",(int)d_x, (int)d_y);
			File.WriteString(OutStr);
		}
		else
		{
			i = 0;
			count = i/100.0;
			double dx1,dy1,dx2,dy2;
			
			

			dx1 = controlP[0].x*C0(count) + controlP[1].x*C1(count) + controlP[2].x*C2(count) + controlP[3].x*C3(count);
			dy1 = controlP[0].y*C0(count) + controlP[1].y*C1(count) + controlP[2].y*C2(count) + controlP[3].y*C3(count);

			i++;
			count = i/100.0;
			dx2 = controlP[0].x*C0(count) + controlP[1].x*C1(count) + controlP[2].x*C2(count) + controlP[3].x*C3(count);
			dy2 = controlP[0].y*C0(count) + controlP[1].y*C1(count) + controlP[2].y*C2(count) + controlP[3].y*C3(count);

			double a,b,c,rad;

			a = dy1 - dy2;
			b = dx1 - dx2;

			rad = atan2f(a,b);

			dx = fExpendDist * cos(rad);
			dy = fExpendDist * sin(rad);

			d_x = p.x + dx;
			d_y = p.y + dy;

			p0.x = d_x;
			p0.y = d_y;

			OutStr.Format("PU;PA%d,%d;",(int)d_x , (int)d_y );
			File.WriteString(OutStr);

			d_x = p.x;
			d_y = p.y;

			OutStr.Format("PD;PA%d,%d;",(int)d_x, (int)d_y);
			File.WriteString(OutStr);
		}

	}
	else
	{
		d_x = p1.x;
		d_y = p1.y;

		OutStr.Format("PU;PA%d,%d;",(int)d_x, (int)d_y);
		File.WriteString(OutStr);
	}


	/*if(fradius_LT <= 0 && (fLeftCtrlPoint1 <= 0 && fLeftCtrlPoint2 <= 0))
	{
		d_x = p2.x;
		d_y = p2.y;

		OutStr.Format("PD;PA%d,%d;",(int)d_x, (int)d_y);
		File.WriteString(OutStr);
	}
*/
	CMathUtil mathUtil;
	double dStep;
	dStep = sweepAngle / pointsCount;
	dStep = mathUtil.Round(dStep, 5);

	start_angle = mathUtil.Round(start_angle, 5);

	for( i=1; i<pointsCount; i++)
	{
		points[i].x = circleRadius.x + cos(start_angle + i * sweepAngle / pointsCount) * fradius_LT;
		points[i].y = circleRadius.y + sin(start_angle + i * sweepAngle / pointsCount) * fradius_LT;
		d_x = circleRadius.x + cos(start_angle + i * dStep) * fradius_LT;
		d_y = circleRadius.y + sin(start_angle + i * dStep) * fradius_LT;

		//d_x = floor(d_x + 0.005);
		//d_y = floor(d_y + 0.005);
		

		if(i==1 && fExpendDist <= 0)
			OutStr.Format("PD;PA%d,%d;",(int)d_x , (int)d_y );
		else if(i==1 && fExpendDist > 0)
			OutStr.Format("PA%d,%d;",(int)d_x , (int)d_y );
		else
			OutStr.Format("PA%d,%d;",(int)d_x  , (int)d_y );

		File.WriteString(OutStr);

	}


//jjsjong 20180920 test
//	if(radius <= 0)
//	{
//		d_x = p.x;
//		d_y = p.y;
//
//		OutStr.Format("PU;PA%d,%d;",(int)d_x, (int)d_y);
//		File.WriteString(OutStr);
//	}

	//--------------------------------- Beizeir Curve Create -------------------------------------------------
	if(fLeftCtrlPoint1 > 0 || fLeftCtrlPoint2 > 0)
	{
		for(i=0;i<100;i++)
		{
			count = i/100.0;
			d_x = controlP[0].x*C0(count) + controlP[1].x*C1(count) + controlP[2].x*C2(count) + controlP[3].x*C3(count);
			d_y = controlP[0].y*C0(count) + controlP[1].y*C1(count) + controlP[2].y*C2(count) + controlP[3].y*C3(count);
			OutStr.Format("PD;PA%d,%d;",(int)d_x, (int)d_y);
			File.WriteString(OutStr);
		}
	}

	//---------------------------------------------------------------------------------------------


	//-------------------------------------------------------------------------------------------------------------------------------------------

	start_angle =  (atan2f ((c4.y - o2.y), (c4.x - o2.x)));
	end_angle =  (atan2f ((c3.y - o2.y), (c3.x - o2.x)));

	/*
	10.At last you need to get a sweep angle and make some checks for it:
	*/

	//Sweep angle
	sweepAngle = end_angle - start_angle;

	//Some additional checks
	if (sweepAngle < 0)
	{
		start_angle = end_angle;
		sweepAngle = -sweepAngle;
	}

	if (sweepAngle > M_PI) //sweepAngle > 180 ?    
		sweepAngle = M_PI - sweepAngle; //sweepAngle = 180 - sweepAngle
		//  sweepAngle = -(2 * M_PI - sweepAngle);
	
	///Point µ•¿Ã≈Õ ª˝º∫ ----------------------------------------------------------

	start_angle2 =  start_angle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	end_angle2 =  end_angle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	sweepAngle2 =  sweepAngle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ

	circleRadius.x = o2.x;
	circleRadius.y = o2.y;
	points[0].x = p2.x;
	points[0].y = p2.y;

	degreeFactor = 0.5;
	pointsCount = (int)abs(sweepAngle2 * degreeFactor);
/*
	if(radius <= 0)
	{
		d_x = p3.x;
		d_y = p3.y;

		OutStr.Format("PD;PA%d,%d;",(int)d_x, (int)d_y);
		File.WriteString(OutStr);
	}
*/
	if(fradius_LB <= 0)
	{
		d_x = p2.x;
		d_y = p2.y;
		OutStr.Format("PD;PA%d,%d;",(int)d_x, (int)d_y);
		File.WriteString(OutStr);
	}
	else
	{
		d_x = c3.x;
		d_y = c3.y;
		OutStr.Format("PD;PA%d,%d;",(int)d_x, (int)d_y);
		File.WriteString(OutStr);
	}

	CString strTemp2;
	for( i=1; i<pointsCount; i++)
	{
		if(i == 0)
		{
			points[i].x = circleRadius.x + sin(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
			points[i].y = circleRadius.y + cos(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
			d_x = circleRadius.x + sin(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
			d_y = circleRadius.y + cos(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
		}
		else
		{
			if(sweepAngle <0)
			{
				points[i].x = circleRadius.x + sin(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
				points[i].y = circleRadius.y + cos(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
				d_x = circleRadius.x + sin(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
				d_y = circleRadius.y + cos(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
			}
			else
			{
				points[i].x = circleRadius.x + cos(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
				points[i].y = circleRadius.y + sin(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
				d_x = circleRadius.x + cos(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
				d_y = circleRadius.y + sin(start_angle + i * sweepAngle / pointsCount) * fradius_LB;
			}

		}

		//d_x = floor(d_x + 0.005);
		//d_y = floor(d_y + 0.005);

		strTemp2.Format("PA%d,%d;",(int)d_x  , (int)d_y );
		File.WriteString(strTemp2);

	}
	
	//------------------------------------------------------------------------------------------------------------------------------------------



//**************************************************************** ExtendPattern + ø¿∏•¬  ∆–≈œ ª˝º∫ Ω√¿€**********************************************************************/

	start_angle =  (atan2f ((c6.y - o3.y), (c6.x - o3.x)));
	end_angle =  (atan2f ((c5.y - o3.y), (c5.x - o3.x)));

	/*
	10.At last you need to get a sweep angle and make some checks for it:
	*/

	//Sweep angle
	sweepAngle = end_angle - start_angle;
	
	//Some additional checks
	//if (sweepAngle <= 0)
	{
		start_angle = end_angle;
		sweepAngle = -sweepAngle;
	}

	if (sweepAngle > M_PI) //sweepAngle > 180 ?    
		sweepAngle = M_PI - sweepAngle; //sweepAngle = 180 - sweepAngle

	///Point µ•¿Ã≈Õ ª˝º∫ ----------------------------------------------------------


	start_angle2 =  start_angle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	end_angle2 =  end_angle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	sweepAngle2 =  sweepAngle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ

	degreeFactor = 0.5;
	pointsCount = (int)abs(sweepAngle2 * degreeFactor);

	circleRadius.x = o3.x;
	circleRadius.y = o3.y;
	
	CString strTemp3;
	if(fradius_RB <= 0)
	{
		d_x1 = p3.x;
		d_y1 = p3.y;

		//OutStr.Format("PD;PA%d,%d;",(int)d_x, (int)d_y);
		// 20180921 jjsjong ø¿∏•¬  ∆–≈œ Ω√¿€¿Ã∂Û¥¬ ¿«πÃ √ﬂ∞° 'PE'
		strTemp3.Format("PE;PA%d,%d;",(int)d_x1, (int)d_y1);
		File.WriteString(strTemp3);
	}
	else
	{

		tempx = nheightField * tan(fLeft_sloop_angle);
		tempx2 = nheightField * tan(fRight_sloop_angle);
		
		
		d_x1 = c5.x;
		d_y1 = p3.y;
		
		strTemp3.Format("PE;PA%d,%d;",(int)d_x1, (int)d_y1);
		File.WriteString(strTemp3);

		points[0].x = p3.x;
		points[0].y = p3.y;

		for( i=1; i<pointsCount; i++)
		{
			points[i].x = circleRadius.x + cos(start_angle + i * sweepAngle / pointsCount) * fradius_RB;
			points[i].y = circleRadius.y + sin(start_angle + i * sweepAngle / pointsCount) * fradius_RB;

			d_x1 = circleRadius.x + cos(start_angle + i * sweepAngle / pointsCount) * fradius_RB;
			d_y1 = circleRadius.y + sin(start_angle + i * sweepAngle / pointsCount) * fradius_RB;


			//d_x = floor(d_x + 0.005);
			//d_y = floor(d_y + 0.005);

			//if(i == 1 && fradius_RB > 0)
			//	strTemp3.Format(_T("PD;PA%d,%d;"),(int)d_x  , (int)d_y );
			//else
				strTemp3.Format(_T("PD;PA%d,%d;"),(int)d_x1  , (int)d_y1 );
			File.WriteString(strTemp3);

		}

	}


	//------------------------------ RIGHT Control Point 1-----------------------------------------//
//	C_POINT controlP[4]={
//	10,10,	200, 100,	400,400,	500,500};
	if(fradius_RB > 0) 
	{
		controlP[0].x = c7.x;
		controlP[0].y = c7.y;

		controlP[1].x = c7.x ;
		controlP[1].y = c7.y - (c7.y * fRightCtrlPoint2/100.0);

		controlP[2].x = c6.x + (p_p2 * fRightCtrlPoint1/500.0);
		controlP[2].y = c6.y;

		controlP[3].x = c6.x;
		controlP[3].y = c6.y;

		/*d_x1 = p4.x;
		d_y1 = p4.y;*/
	}
	else
	{
		controlP[0].x = p4.x;
		controlP[0].y = p4.y;

		controlP[1].x = p4.x;
		controlP[1].y = p4.y - (p4.y * fRightCtrlPoint2/100);
		
		controlP[2].x = p3.x + (p_p2 * fRightCtrlPoint1/500);
		//controlP[1].y = p4.y - p_p2/2;
		controlP[2].y = p3.y;

		controlP[3].x = p3.x;
		controlP[3].y = p3.y;

		/*d_x1 = p4.x;
		d_y1 = p4.y;*/

	}

	//OutStr.Format("PU;PA%d,%d;",(int)d_x, (int)d_y);
	//File.WriteString(OutStr);

	count = 0.0;
	//double x,y; //ƒ⁄µÂ¿« ∞°µ∂º∫¿ª ≥Ù¿Ã±‚¿ß«— ∫Øºˆ
	//int i;

	//--------------------------------- Beizeir Curve Create -------------------------------------------------

	if(fRightCtrlPoint1 > 0 || fRightCtrlPoint2 > 0)
	{
		for(i=0;i<100;i++)
		{
			count = i/100.0;
			d_x1 = controlP[0].x*C0(count) + controlP[1].x*C1(count) + controlP[2].x*C2(count) + controlP[3].x*C3(count);
			d_y1 = controlP[0].y*C0(count) + controlP[1].y*C1(count) + controlP[2].y*C2(count) + controlP[3].y*C3(count);
			//SetPixelV(hdc,x,y,RGB(255,i,0));
			OutStr.Format("PD;PA%d,%d;",(int)d_x1, (int)d_y1);
			File.WriteString(OutStr);
		}
	}

	//---------------------------------------------------------------------------------------------
	//-------------------------------------------------------------------------------------------------------------------------------------------

	//------------------------------------------------------------------------------------------------------------------------------------------
//	start_angle =  (atan2f ((c7.y - o4.y), (c7.x - o4.x)));
//	end_angle =  (atan2f ((c8.y - o4.y), (c8.x - o4.x)));
	start_angle =  (atan2f ((c8.y - o4.y), (c8.x - o4.x)));
	end_angle =  (atan2f ((c7.y - o4.y), (c7.x - o4.x)));

	/*
	10.At last you need to get a sweep angle and make some checks for it:
	*/
	//Sweep angle
	sweepAngle = end_angle - start_angle;

	//Some additional checks
	//if (sweepAngle < 0)
	{
		start_angle = end_angle;
		sweepAngle = -sweepAngle;
	}

	if (sweepAngle > M_PI) //sweepAngle > 180 ?    
		sweepAngle = M_PI - sweepAngle; //sweepAngle = 180 - sweepAngle

	start_angle2 =  start_angle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	end_angle2 =  end_angle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ
	sweepAngle2 =  sweepAngle * ( 180.0f / M_PI); // ∂Ûµæ»¿ª ∞¢µµ∑Œ

	

	degreeFactor = 0.5;
	pointsCount = (int)abs(sweepAngle2 * degreeFactor);

	///Point µ•¿Ã≈Õ ª˝º∫ ----------------------------------------------------------

	circleRadius.x = o4.x;
	circleRadius.y = o4.y;
	points[0].x = p4.x;
	points[0].y = p4.y;

	if(fradius_RT <= 0)
	{
		d_x1 = p4.x;
		d_y1 = p4.y;

		OutStr.Format(_T("PD;PA%d,%d;"),(int)d_x1, (int)d_y1);
		File.WriteString(OutStr);
	}
	else
	{
		d_x1 = c7.x;
		d_y1 = c7.y;
		OutStr.Format(_T("PD;PA%d,%d;"),(int)d_x1, (int)d_y1);
		File.WriteString(OutStr);
	}

	//d_x = c7.x;
	//d_y = c7.y;

	for( i=1; i<pointsCount; i++)
	{
		points[i].x = circleRadius.x + cos(start_angle + i * sweepAngle / pointsCount) * fradius_RT;
		points[i].y = circleRadius.y + sin(start_angle + i * sweepAngle / pointsCount) * fradius_RT;


		d_x1 = circleRadius.x + cos(start_angle + i * sweepAngle / pointsCount) * fradius_RT;
		d_y1 = circleRadius.y + sin(start_angle + i * sweepAngle / pointsCount) * fradius_RT;


		//d_x = floor(d_x + 0.005);
		//d_y = floor(d_y + 0.005);

		OutStr.Format(_T("PD;PA%d,%d;"),(int)d_x1  , (int)d_y1 );
		File.WriteString(OutStr);

	}

	d_x1 = p5.x;
	d_y1 = p5.y;


	OutStr.Format(_T("PA%d,%d;"),(int)d_x1  , (int)d_y1 );
	File.WriteString(OutStr);


/*
	if(fExpendDist > 0)
	{
		d_x = p6.x; 
		d_y = p6.y;
		OutStr.Format("PA%d,%d;",(int)d_x , (int)d_y );
		File.WriteString(OutStr);

	}
*/

	if(fExpendDist > 0)
	{
		if(fRightCtrlPoint1 <= 0 && fRightCtrlPoint2 <= 0)
		{
			d_x1 = p6.x; 
			d_y1 = p6.y;

			OutStr.Format("PA%d,%d;",(int)d_x1 , (int)d_y1 );
			File.WriteString(OutStr);
		}
		else
		{
			i = 98;
			count = i/100.0;
			double dx1,dy1,dx2,dy2;

			dx1 = controlP[0].x*C0(count) + controlP[1].x*C1(count) + controlP[2].x*C2(count) + controlP[3].x*C3(count);
			dy1 = controlP[0].y*C0(count) + controlP[1].y*C1(count) + controlP[2].y*C2(count) + controlP[3].y*C3(count);

			i++;
			count = i/100.0;
			dx2 = controlP[0].x*C0(count) + controlP[1].x*C1(count) + controlP[2].x*C2(count) + controlP[3].x*C3(count);
			dy2 = controlP[0].y*C0(count) + controlP[1].y*C1(count) + controlP[2].y*C2(count) + controlP[3].y*C3(count);

			double a,b,c,rad;

			a = dy2 - dy1;
			b = dx2 - dx1;


			rad = atan2f(a,b);

			dx = fExpendDist * cos(rad);
			dy = fExpendDist * sin(rad);

			d_x1 = p4.x + dx;
			d_y1 = p4.y + dy;

			p6.x = d_x1;
			p6.y = d_y1;

			OutStr.Format("PA%d,%d;",(int)d_x1, (int)d_y1);
			File.WriteString(OutStr);

		}
		
	}
	else
	{
		d_x1 = p6.x;
		d_y1 = p6.y;

		OutStr.Format("PA%05d,%05d;",(int)d_x1, (int)d_y1);
		File.WriteString(OutStr);
	}
	
	File.Close();

	double dSloopWidth,dSloopWidthLeft,dSloopWidthRight,dSloopSegment_LT,dSloopSegment_LB,dSloopSegment_RT,dSloopSegment_RB,dSloopExtendXwidth_L,dSloopExtendXwidth_R,dSloopExtendYheight_L,dSloopExtendYheight_R,dTempValue;
	//dSloopWidth = (p2.x - p0.x) + (p6.x - p3.x);
	dSloopWidth = (c4.x - c1.x) + (c8.x - c5.x);
	
	dSloopSegment_LT=0;dSloopSegment_LB=0;dSloopSegment_RT=0;dSloopSegment_RB=0;
	/*fradius_LT = floor(fradius_LT);
	fradius_LB = floor(fradius_LB);
	fradius_RT = floor(fradius_RT);
	fradius_RB = floor(fradius_RB);*/
	/*if(fLeftCtrlPoint1 > 0 || fLeftCtrlPoint2 > 0)
	{
		if(fradius_LB <= 0){
			dSloopWidthLeft = p2.x - p.x;
		}
		else 
		{
			dSloopWidthLeft = c4.x - p.x;
			dSloopSegment_LB = c4.x - p2.x;
			dSloopSegment_LT = p.x - c1.x;
		}

	}
	else*/
	{
		if(fradius_LB <= 0 && fradius_LT <=0){       
			dTempValue = /*Radius¡¶ø‹«— ≥Ù¿Ã*/ (p.y - p2.y) * tan(fLeft_sloop_angle);
			dSloopWidthLeft = p2.x - p.x;
			//dSloopWidthLeft = dTempValue + fradius_LB + fradius_LT;
			dSloopSegment_LB = 0; dSloopSegment_LT=0;
		}
		else if(fradius_LB > 0 && fradius_LT > 0){
			dTempValue = /*Radius¡¶ø‹«— ≥Ù¿Ã*/ (c2.y - c3.y) * tan(fLeft_sloop_angle);
			dSloopWidthLeft = c4.x - c1.x;
			//dSloopWidthLeft = dTempValue + fradius_LB + fradius_LT;
			
			dSloopSegment_LB = c4.x - p2.x;
			dSloopSegment_LT = p.x - c1.x;
		}
		else if(fradius_LB > 0 && fradius_LT <= 0){
			dTempValue = /*Radius¡¶ø‹«— ≥Ù¿Ã*/ (p.y - c3.y) * tan(fLeft_sloop_angle);
			dSloopWidthLeft = c4.x - p.x;
			//dSloopWidthLeft = dTempValue + fradius_LB + fradius_LT;

			dSloopSegment_LB = c4.x - p2.x;
			dSloopSegment_LT = 0;
		}
		else if(fradius_LB <= 0 && fradius_LT > 0){
			dTempValue = /*Radius¡¶ø‹«— ≥Ù¿Ã*/ (c2.y - p2.y) * tan(fLeft_sloop_angle);
			dSloopWidthLeft = p2.x - c1.x;
			//dSloopWidthLeft = dTempValue + fradius_LB + fradius_LT;

			dSloopSegment_LB = 0;
			dSloopSegment_LT = p.x - c1.x;
		}
		
	}

	/*if(fRightCtrlPoint1 > 0 || fRightCtrlPoint2 > 0)
	{

		if(fradius_RB <= 0)	{
			dSloopWidthRight = p4.x - p3.x;
		}
		else {
			dSloopWidthRight = p6.x - c5.x;
			dSloopSegment_RB = p3.x - c5.x;
			dSloopSegment_RT = c8.x - p4.x;
		}
	}
	else*/
	{
		/*if(fradius_RB <= 0)	{
			dSloopWidthRight = p6.x - p3.x;
		}
		else {
			dSloopWidthRight = p6.x - c5.x;
			dSloopSegment_R = p3.x - c5.x;
		}*/
		if(fradius_RB <= 0 && fradius_RT <=0){       
			dTempValue = /*Radius¡¶ø‹«— ≥Ù¿Ã*/ (p4.y - p3.y) * tan(fRight_sloop_angle);
			dSloopWidthRight = c8.x - p3.x;
			//dSloopWidthRight = dTempValue + fradius_RB + fradius_RT;

			dSloopSegment_RB = 0;
			dSloopSegment_RT = 0;
		}
		else if(fradius_RB > 0 && fradius_RT > 0){
			dTempValue = /*Radius¡¶ø‹«— ≥Ù¿Ã*/ (c7.y - c6.y) * tan(fRight_sloop_angle);
			dSloopWidthRight = c8.x - c5.x;
			//dSloopWidthRight = dTempValue + fradius_RB + fradius_RT;

			dSloopSegment_RB = p3.x - c5.x;
			dSloopSegment_RT = c8.x - p4.x;
		}
		else if(fradius_RB > 0 && fradius_RT <= 0){
			dTempValue = /*Radius¡¶ø‹«— ≥Ù¿Ã*/ (p4.y - c6.y) * tan(fRight_sloop_angle);
			dSloopWidthRight = p4.x - c5.x;
			//dSloopWidthRight = dTempValue + fradius_RB + fradius_RT;

			dSloopSegment_RB = p3.x - c5.x;
			dSloopSegment_RT = 0;
		}
		else if(fradius_RB <= 0 && fradius_RT > 0){
			dTempValue = /*Radius¡¶ø‹«— ≥Ù¿Ã*/ (c7.y - p3.y) * tan(fRight_sloop_angle);
			dSloopWidthRight = c8.x - p3.x;
			//dSloopWidthRight = dTempValue + fradius_RB + fradius_RT;

			dSloopSegment_RB = 0;
			dSloopSegment_RT = c8.x - p4.x;
		}

	}

	//dSloopExtendXwidth_L = p.x - p0.x;
	//dSloopExtendXwidth_R = p6.x - p4.x;
	dSloopExtendXwidth_L = c1.x - p0.x;
	dSloopExtendXwidth_R = p6.x - c8.x;


	dSloopExtendYheight_L = p0.y - p.y;
	dSloopExtendYheight_R = p6.y - p4.y;

	pFieldParameter->SetSloopWidth(dSloopWidth);
	pFieldParameter->SetSloopWidthOfLeft(dSloopWidthLeft);
	pFieldParameter->SetSloopWidthOfRight(dSloopWidthRight);
	pFieldParameter->SetSloopSegment(dSloopSegment_LT, dSloopSegment_LB,dSloopSegment_RT,dSloopSegment_RB);
	
	/*if(fExpendDist > 0)
	{
		if(fLeftCtrlPoint1 > 0 || fLeftCtrlPoint2 > 0)
			dSloopExtendXwidth_L = 0.0;

		if(fRightCtrlPoint1 > 0 ||  fRightCtrlPoint1 > 0)
			dSloopExtendXwidth_R = 0.0;
	}*/
	
	pFieldParameter->SetExtendLine_Xwidth(dSloopExtendXwidth_L,dSloopExtendXwidth_R);
	pFieldParameter->SetExtendLine_Yheight(dSloopExtendYheight_L,dSloopExtendYheight_R);
	pFieldParameter->SetPatternFileName(PltFile);

	
	CMKObject *pObject;
	pObject = pObjMng->CreateObject(ID_LOGO_OBJECT);//±◊ø° «ÿ¥Á«œ¥¬ ø¿∫Í¡ß∆Æ∏¶ ∏∏µÈ∞Ì.

	((CMKLogoObject *)pObject)->SetFileName(PltFile);
	pObject->Refresh();
	pApprocher->Add(pObject);

	CDisplay *pDisp = CPointerContainer::GetDisplay(); 
	pDisp->SetRefreshFlag(CDisplay::DRAW_ALL);
	

	CBeamEditor6View *pView = (CBeamEditor6View *)GetView();
	pView->Invalidate(FALSE);
	
	pView->RedrawWindow();
	
}


void CMainFrame::OnUpdateSetFieldSize(CCmdUI *pCmdUI)
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}


void CMainFrame::OnUpdateSetAuthority(CCmdUI *pCmdUI)
{
	// TODO: Add your command update UI handler code here
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CDlgMark *m_pDlgMark = m_pDlgMark->GetInstance();	
	if(m_pDlgMark->m_hWnd  != NULL)	
	{
		if(pDoc->m_bDlgMarkFlag == TRUE) 
			pCmdUI->Enable(FALSE);
		else
			pCmdUI->Enable(TRUE);
	}
	else 
		pCmdUI->Enable(TRUE);
}


void CMainFrame::CheckHardDiskSpace(void)
{
	CMainFrame *pFrame = (CMainFrame*)AfxGetMainWnd();
	CBeamEditor6Doc *pDoc = (CBeamEditor6Doc*)pFrame->GetActiveDocument(); 
	CTime Time = CTime::GetCurrentTime();                  // Ω√∞£ ∞¸∏Æ 
	CFile File;                  // »≠¿œ ∞¸∏Æ 
	CString strFileName,m_strSavingDir,strTotalLogData;         // »≠¿œ ¿Ã∏ß ¿˙¿Â ∞¯∞£
	CFileFind FileFind;          // »≠¿œ ¡∏¿Á ø©∫Œ∏¶ æÀ±‚ ¿ß«ÿ
	m_strSavingDir = pDoc->m_cwd+"\\Log\\";
	
	BOOL  fResult;
	char  *pszDrive  = NULL;
		//	szDrive[4];
		
	char arRoot[100];
	::GetCurrentDirectory(100, arRoot);
	
	TCHAR szDir[255], szDrive[255], szFileName[255], szFileExt[20];
	
	_tsplitpath((LPCTSTR)m_strSavingDir, szDrive, szDir,szFileName, szFileExt);	
	
	CString strDrive = szDrive;
	CString strDir = szDir;
	
	pszDrive = szDrive;
	
	DWORD dwSectPerClust,
		dwBytesPerSect,
		dwFreeClusters,
		dwTotalClusters;
	
	P_GDFSE pGetDiskFreeSpaceEx = NULL;
	
	unsigned __int64 i64FreeBytesToCaller,
		i64TotalBytes,
		i64FreeBytes;
	
	pGetDiskFreeSpaceEx = (P_GDFSE)GetProcAddress (
		GetModuleHandle ("kernel32.dll"),
		"GetDiskFreeSpaceExA");
	if (pGetDiskFreeSpaceEx)
	{
		fResult = GetDiskFreeSpaceEx (pszDrive,
			(PULARGE_INTEGER)&i64FreeBytesToCaller,
			(PULARGE_INTEGER)&i64TotalBytes,
			(PULARGE_INTEGER)&i64FreeBytes);
		if (fResult)
		{
			TRACE("GetDiskFreeSpaceEx reports\n\n");
			TRACE ("Available space to caller = %I64u MB (%I64u bytes)\n",
				i64FreeBytesToCaller / (1024*1024), i64FreeBytesToCaller);
            TRACE ("Total space               = %I64u MB (%I64u bytes)\n",
				i64TotalBytes / (1024*1024), i64TotalBytes);
            TRACE ("Free space on drive       = %I64u MB (%I64u bytes)\n",
				i64FreeBytes / (1024*1024), i64FreeBytes);
			

			BOOL bFlag = TRUE;
			int nYear = Time.GetYear();
			int nMonth = Time.GetMonth();
			int nDay = Time.GetDay();
			int nMonthOfRecent = 3; // √÷±Ÿ 3∞≥ø˘ ƒ°∏∏ ∑Œ±◊≥≤±Ë
			int nLastYearMonthlimit = 10; // ¿¸≥‚µµ 10ø˘ ¿Ã»ƒ∏∏ ≥≤±Ë
 			
			
			HANDLE hSrch;
			WIN32_FIND_DATA wfd;
			TCHAR fname[MAX_PATH];
			BOOL bResult=TRUE;
			TCHAR Path[MAX_PATH];
			
			//sprintf( txBuffer,"PEON=%d\r\n", TRUE);
			//wsprintf(fname,"[ %s ]",wfd.cFileName);
			lstrcat(szDir,"\\*.*");
			hSrch=FindFirstFile(szDir,&wfd);
			if (hSrch==INVALID_HANDLE_VALUE) return;
			while (bResult) {
				if (wfd.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY) {
					wsprintf(fname,"[ %s ]",wfd.cFileName);
				} else {
					wsprintf(fname,"%s",wfd.cFileName);
					
					//SendMessage(hList,LB_ADDSTRING,0,(LPARAM)fname);
					strFileName.Format("%s%s",m_strSavingDir,fname);
					
					HANDLE h_file = CreateFile(strFileName, GENERIC_READ, FILE_SHARE_READ, NULL, 
						OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);
					if(h_file != INVALID_HANDLE_VALUE){
						FILETIME create_time, access_time, write_time;
						GetFileTime(h_file, &create_time, &access_time, &write_time);
						SYSTEMTIME write_system_time, write_local_time;
						FileTimeToSystemTime(&write_time, &write_system_time);
						SystemTimeToTzSpecificLocalTime(NULL, &write_system_time, &write_local_time);
						CloseHandle(h_file);
						

						if((int)write_local_time.wYear == nYear ){
							if(write_local_time.wMonth <= nMonth - nMonthOfRecent)
								DeleteFile(strFileName);
								
						}

						if((int)write_local_time.wYear < nYear )
						{
							if(nMonth <= 4)
							{ //4ø˘¥ﬁ¿¸≤®∏È ¿¸≥‚ø° ¿÷¥¬∞≈ ≥≤∞‹µ“
								if((int)write_local_time.wMonth < nLastYearMonthlimit ) // ¿¸≥‚¿Ã∏È 10ø˘ ¿¸ø°≤® ªË¡¶
									DeleteFile(strFileName);
							}
							else{
									DeleteFile(strFileName);
							//	(write_local_time.wYear < nYear || write_local_time.wMonth  < nMonth - 3)
							}
								
						}
					}
				}
				
				bResult=FindNextFile(hSrch,&wfd);
			}
			FindClose(hSrch);
		
			//if(i64FreeBytes / (1024*1024) < i64TotalBytes / (1024*1024*4) ) // µ∑∫≈‰∏Æ µΩ∫≈© øÎ∑Æ¿« 4G ∫∏¥Ÿ ¿€¿∏∏È µΩ∫≈© ¡§∏Æ«œ∂Û¥¬ ∏ﬁºº¡ˆ ∫∏ø©¡‹
			if(i64FreeBytes / (1024*1024) < 4000 ) // µ∑∫≈‰∏Æ µΩ∫≈© øÎ∑Æ¿« 4G ∫∏¥Ÿ ¿€¿∏∏È µΩ∫≈© ¡§∏Æ«œ∂Û¥¬ ∏ﬁºº¡ˆ ∫∏ø©¡‹
			{
					//pDoc->ShowMessageWindow(Msg_Code_CheckDiskSpase);
				DisplayMessage("«œµÂøÎ∑Æ¿ª »Æ¿Œ«œººø‰.");
			}
		}
	}
	else
	{
		fResult = GetDiskFreeSpace (pszDrive, 
			&dwSectPerClust,
			&dwBytesPerSect, 
			&dwFreeClusters,
			&dwTotalClusters);
		if (fResult)
		{
            /* force 64-bit math */ 
            i64TotalBytes = (__int64)dwTotalClusters * dwSectPerClust *
				dwBytesPerSect;
            i64FreeBytes = (__int64)dwFreeClusters * dwSectPerClust *
				dwBytesPerSect;
			
            TRACE ("GetDiskFreeSpace reports\n\n");
            TRACE ("Free space  = %I64u MB (%I64u bytes)\n", 
				i64FreeBytes / (1024*1024), i64FreeBytes);
            TRACE ("Total space = %I64u MB (%I64u bytes)\n", 
				i64TotalBytes / (1024*1024), i64TotalBytes);
		}
	}

}

void CMainFrame::AddLogData(CString strLogData)
{
	CheckHardDiskSpace();
	CPointerContainer::GetGraphView()->AddLogData(strLogData);
}


void CMainFrame::UpdateInfomationView(void)
{
	GetView()->m_pUI->ChangeState(CUserNormalState::Instance() );
	CPointerContainer::GetInformationView()->UpdateInfo();
}


LRESULT CMainFrame::WindowProc(UINT message, WPARAM wParam, LPARAM lParam)
{
	switch(message)
	{
	default: break;
	case WM_KEYDOWN:
		switch (wParam)
		{
		case VK_ESCAPE:
		case VK_RETURN:
			wParam = 0;
			break;
		}

	case WM_SHOW_ALARM:
		if(GuiAlarm->IsWindowVisible()) GuiAlarm->ShowWindow(SW_HIDE);
		if(GuiError->IsWindowVisible()) GuiError->ShowWindow(SW_HIDE);
		GuiAlarm->SetAlarmNumber((int)wParam);
		GuiAlarm->ShowWindow(SW_SHOW);
		break;

	case WM_HIDE_ALARM:
		if(GuiAlarm->IsWindowVisible()) GuiAlarm->ShowWindow(SW_HIDE);
		break;

	case WM_SHOW_ERROR:
		if(GuiAlarm->IsWindowVisible()) GuiAlarm->ShowWindow(SW_HIDE);
		if(GuiError->IsWindowVisible()) GuiError->ShowWindow(SW_HIDE);
		GuiError->SetErrorNumber((int)wParam);
		GuiError->ShowWindow(SW_SHOW);
		break;
	case WM_HIDE_ERROR:
		if(GuiError->IsWindowVisible()) GuiError->ShowWindow(SW_HIDE);
		break;

	case WM__MINIMIZE_WINDOW:
		ShowWindow(SW_MINIMIZE);
		break;

	}

	return CFrameWnd::WindowProc(message, wParam, lParam);
}
